{"ast":null,"code":"import { isNullOrUndefined, addClass, createElement, append, EventHandler, extend, remove } from '@syncfusion/ej2-base';\nimport { ListBase } from '@syncfusion/ej2-lists';\nimport { ViewBase } from '../renderer/view-base';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n\nvar AgendaBase =\n/** @class */\nfunction () {\n  /**\r\n   * Constructor for AgendaBase\r\n   */\n  function AgendaBase(parent) {\n    this.parent = parent;\n    this.viewBase = new ViewBase(parent);\n  }\n\n  AgendaBase.prototype.createAgendaContentElement = function (type, listData, aTd, groupOrder, groupIndex) {\n    var listElement;\n    var fieldMapping = this.parent.eventFields;\n\n    if (type === 'noEvents') {\n      var noEvents = [{\n        'subject': this.parent.localeObj.getConstant('noEvents')\n      }];\n      listElement = ListBase.createList(this.parent.createElement, noEvents, {\n        moduleName: 'agenda',\n        listClass: this.parent.activeView.viewClass,\n        itemClass: this.parent.activeView.viewClass,\n        template: '<div class=' + cls.AGENDA_NO_EVENT_CLASS + '>${subject}</div>'\n      });\n    } else {\n      listElement = ListBase.createList(this.parent.createElement, listData, {\n        moduleName: 'agenda',\n        listClass: this.parent.activeView.viewClass,\n        itemClass: this.parent.activeView.viewClass\n      });\n\n      var _loop_1 = function (li, length_1) {\n        var appWrapper = createElement('div', {\n          className: cls.APPOINTMENT_CLASS,\n          attrs: {\n            'data-id': 'Appointment_' + listData[li][this_1.parent.eventFields.id],\n            'data-guid': listData[li].Guid,\n            'role': 'button',\n            'tabindex': '0',\n            'aria-readonly': this_1.parent.eventBase.getReadonlyAttribute(listData[li]),\n            'aria-selected': 'false',\n            'aria-grabbed': 'true',\n            'aria-label': this_1.parent.getAnnocementString(listData[li])\n          }\n        });\n\n        if (!isNullOrUndefined(groupIndex)) {\n          appWrapper.setAttribute('data-group-index', groupIndex.toString());\n        }\n\n        this_1.parent.eventBase.applyResourceColor(appWrapper, listData[li], 'borderColor', groupOrder);\n        var templateEle = void 0;\n\n        if (!isNullOrUndefined(this_1.parent.activeViewOptions.eventTemplate)) {\n          addClass([appWrapper], cls.EVENT_TEMPLATE);\n          var scheduleId = this_1.parent.element.id + '_';\n          var viewName = this_1.parent.activeViewOptions.eventTemplateName;\n          var templateId = scheduleId + viewName + 'eventTemplate';\n          var templateArgs = util.addLocalOffsetToEvent(listData[li], this_1.parent.eventFields);\n          templateEle = this_1.parent.getAppointmentTemplate()(templateArgs, this_1.parent, 'eventTemplate', templateId, false);\n\n          if (!isNullOrUndefined(listData[li][fieldMapping.recurrenceRule])) {\n            var iconClass = listData[li][fieldMapping.id] === listData[li][fieldMapping.recurrenceID] ? cls.EVENT_RECURRENCE_ICON_CLASS : cls.EVENT_RECURRENCE_EDIT_ICON_CLASS;\n            appWrapper.appendChild(createElement('div', {\n              className: cls.ICON + ' ' + iconClass\n            }));\n          }\n        } else {\n          templateEle = this_1.createAppointment(listData[li]);\n        }\n\n        append([].slice.call(templateEle), appWrapper);\n        util.removeChildren(listElement.children[li]);\n        listElement.children[li].appendChild(appWrapper);\n        var args = {\n          data: extend({}, listData[li], null, true),\n          element: listElement.children[li],\n          cancel: false\n        };\n        this_1.parent.trigger(event.eventRendered, args, function (eventArgs) {\n          if (eventArgs.cancel) {\n            remove(listElement.children[li]);\n          }\n        });\n      };\n\n      var this_1 = this;\n\n      for (var li = 0, length_1 = listData.length; li < length_1; li++) {\n        _loop_1(li, length_1);\n      }\n    }\n\n    aTd.appendChild(listElement);\n\n    if (this.parent.currentView === 'MonthAgenda' && this.parent.activeViewOptions.group.resources.length > 0 || this.parent.currentView === 'Agenda') {\n      addClass([aTd], cls.AGENDA_DAY_BORDER_CLASS);\n    }\n\n    this.parent.renderTemplates();\n    return aTd;\n  };\n\n  AgendaBase.prototype.createAppointment = function (event) {\n    var fieldMapping = this.parent.eventFields;\n    var eventSubject = event[fieldMapping.subject] || this.parent.eventSettings.fields.subject.default;\n    var eventLocation = event[fieldMapping.location] || this.parent.eventSettings.fields.location.default;\n    var appSubjectWrap = createElement('div', {\n      className: cls.SUBJECT_WRAP\n    });\n\n    if (!isNullOrUndefined(eventLocation) && eventLocation !== '') {\n      eventSubject += ',';\n    }\n\n    appSubjectWrap.appendChild(createElement('div', {\n      className: cls.SUBJECT_CLASS,\n      innerHTML: eventSubject\n    }));\n\n    if (!isNullOrUndefined(eventLocation) && eventLocation !== '') {\n      appSubjectWrap.appendChild(createElement('div', {\n        className: cls.LOCATION_CLASS,\n        innerHTML: eventLocation\n      }));\n    }\n\n    if (!isNullOrUndefined(event[fieldMapping.recurrenceRule])) {\n      var iconClass = event[fieldMapping.id] === event[fieldMapping.recurrenceID] ? cls.EVENT_RECURRENCE_ICON_CLASS : cls.EVENT_RECURRENCE_EDIT_ICON_CLASS;\n      appSubjectWrap.appendChild(createElement('div', {\n        className: cls.ICON + ' ' + iconClass\n      }));\n    }\n\n    var strDate = event[fieldMapping.startTime];\n    var endDate = event[fieldMapping.endTime];\n    var isAllDay = event[fieldMapping.isAllDay];\n    var allDayStr = this.parent.localeObj.getConstant('allDay');\n    var timeStr = this.parent.getTimeString(strDate) + ' - ' + this.parent.getTimeString(endDate);\n\n    if (!isNullOrUndefined(event.data)) {\n      var milliSeconds = endDate.getTimezoneOffset() !== strDate.getTimezoneOffset() ? endDate.getTime() - strDate.getTime() + 3600000 : endDate.getTime() - strDate.getTime();\n      var eventString = milliSeconds / util.MS_PER_DAY >= 1 ? allDayStr : timeStr;\n      allDayStr = eventString + ' (' + this.parent.localeObj.getConstant('day') + ' ' + event.data.index + '/' + event.data.count + ')';\n    }\n\n    var displayStr = !isNullOrUndefined(event.data) || isAllDay ? allDayStr : timeStr;\n    var appDateTime = createElement('div', {\n      className: cls.DATE_TIME_CLASS,\n      innerHTML: displayStr\n    });\n    return [appSubjectWrap, appDateTime];\n  };\n\n  AgendaBase.prototype.processAgendaEvents = function (events) {\n    var eventsProcessed = [];\n\n    if (isNullOrUndefined(events)) {\n      return eventsProcessed;\n    }\n\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n      var splited = this.parent.eventBase.splitEventByDay(event_1);\n      eventsProcessed = eventsProcessed.concat(splited.length > 1 ? splited : event_1);\n    }\n\n    return eventsProcessed;\n  };\n\n  AgendaBase.prototype.wireEventActions = function () {\n    var eventElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n\n    for (var _i = 0, eventElement_1 = eventElement; _i < eventElement_1.length; _i++) {\n      var element = eventElement_1[_i];\n      this.parent.eventBase.wireAppointmentEvents(element, null, true);\n    }\n\n    var dateHeaderElement = [].slice.call(this.parent.element.querySelectorAll('.e-m-date'));\n\n    for (var _a = 0, dateHeaderElement_1 = dateHeaderElement; _a < dateHeaderElement_1.length; _a++) {\n      var element = dateHeaderElement_1[_a];\n      EventHandler.add(element, 'click', this.parent.agendaModule.dayNavigationClick, this);\n    }\n  };\n\n  AgendaBase.prototype.calculateResourceTableElement = function (tBody, noOfDays, agendaDate) {\n    if (isNullOrUndefined(this.parent.resourceBase.lastResourceLevel)) {\n      var level = this.viewBase.getDateSlots(this.viewBase.renderDates, this.parent.activeViewOptions.workDays);\n      this.parent.resourceBase.generateResourceLevels(level);\n    }\n\n    var agendaLastDate = util.addDays(new Date(agendaDate.getTime()), noOfDays);\n    var days = this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda' ? noOfDays : 1;\n    var resColl = this.parent.resourceBase.resourceCollection;\n    var resData = this.parent.resourceBase.lastResourceLevel;\n    var initialDate = agendaDate;\n\n    for (var i = 0; i < days; i++) {\n      var lastLevelInfo = [];\n      var tempLastLevelInfo = [];\n      var tempIndex = 0;\n      var eventObj = void 0;\n      var dateObj = void 0;\n      var firstDate = util.addDays(initialDate, i);\n      var finalDate = this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda' ? util.addDays(firstDate, 1) : agendaLastDate;\n      var agendaCollection = this.parent.eventBase.filterEvents(firstDate, finalDate);\n\n      if (agendaCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\n        for (var res = 0; res < resData.length; res++) {\n          noOfDays = !this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda' ? noOfDays : 1;\n          var data = [];\n          agendaDate = firstDate;\n          var resDataCollection = this.parent.eventBase.filterEvents(agendaDate, agendaLastDate, agendaCollection, resData[res]);\n\n          if (resDataCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\n            for (var r = 0; r < noOfDays; r++) {\n              var resDayCollection = this.parent.eventBase.filterEvents(agendaDate, util.addDays(agendaDate, 1), resDataCollection, undefined);\n\n              if (resDayCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\n                data.push(resDayCollection[0]);\n                eventObj = {\n                  rowSpan: 1,\n                  type: 'eventColumn',\n                  resource: resColl[resColl.length - 1],\n                  groupIndex: resData[res].groupIndex,\n                  groupOrder: resData[res].groupOrder,\n                  resourceData: resData[res].resourceData,\n                  eventData: resDayCollection,\n                  date: agendaDate\n                };\n                dateObj = {\n                  rowSpan: 1,\n                  type: 'dateColumn',\n                  resource: resColl[resColl.length - 1],\n                  groupOrder: resData[res].groupOrder,\n                  resourceData: resData[res].resourceData,\n                  date: agendaDate\n                };\n\n                if (!lastLevelInfo[tempIndex]) {\n                  lastLevelInfo[tempIndex] = [];\n                }\n\n                lastLevelInfo[tempIndex].push(eventObj);\n                lastLevelInfo[tempIndex].push(dateObj);\n                tempIndex++;\n              }\n\n              agendaDate = util.addDays(agendaDate, 1);\n\n              if (agendaDate.getTime() >= agendaLastDate.getTime() || this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n                lastLevelInfo[lastLevelInfo.length - 1][1].cssClass = cls.AGENDA_DAY_BORDER_CLASS;\n                var tempObj = {\n                  rowSpan: data.length,\n                  type: 'resourceColumn',\n                  resource: resColl[resColl.length - 1],\n                  groupOrder: resData[res].groupOrder.slice(0, -1),\n                  resourceData: resData[res].resourceData,\n                  groupIndex: lastLevelInfo.length - data.length,\n                  className: [cls.RESOURCE_NAME],\n                  date: agendaDate\n                };\n                lastLevelInfo[lastLevelInfo.length - data.length].push(tempObj);\n                tempLastLevelInfo.push(extend({}, tempObj, null, true));\n                break;\n              }\n            }\n          }\n        }\n\n        var topResources = resColl.slice(0, -1);\n        var tempGroupedData = [];\n        var totalRowSpan = 0;\n\n        for (var y = 0; y < topResources.length; y++) {\n          var data = topResources[topResources.length - (y + 1)].dataSource;\n\n          for (var x = 0; x < data.length; x++) {\n            var z = 0;\n\n            for (var u = 0; u < tempLastLevelInfo.length; u++) {\n              if (tempLastLevelInfo[u].groupOrder[topResources.length - (y + 1)] === data[x][topResources[topResources.length - (y + 1)].idField]) {\n                totalRowSpan = totalRowSpan + tempLastLevelInfo[u].rowSpan;\n                tempGroupedData.push(extend({}, tempLastLevelInfo[u], null, true));\n              }\n\n              if (++z === tempLastLevelInfo.length && tempGroupedData.length > 0) {\n                tempGroupedData[0].rowSpan = totalRowSpan;\n                tempGroupedData[0].type = 'parentColumnLevel_' + (y + 1);\n                tempGroupedData[0].resource = topResources[topResources.length - (y + 1)];\n                tempGroupedData[0].resourceData = data[x];\n                tempGroupedData[0].date = agendaDate;\n                lastLevelInfo[tempGroupedData[0].groupIndex].push(tempGroupedData[0]);\n                tempGroupedData = [];\n                totalRowSpan = 0;\n              }\n            }\n          }\n        }\n\n        this.createResourceTableRow(lastLevelInfo, tBody);\n      }\n    }\n\n    var totalCollection = this.parent.eventBase.filterEvents(initialDate, agendaLastDate);\n\n    if (totalCollection.length === 0 && !this.parent.activeViewOptions.allowVirtualScrolling && this.parent.hideEmptyAgendaDays) {\n      this.renderEmptyContent(tBody, initialDate);\n    }\n  };\n\n  AgendaBase.prototype.createResourceTableRow = function (tContent, tBody) {\n    var tr = createElement('tr', {\n      attrs: {\n        role: 'row'\n      }\n    });\n    var ntr;\n    var td = createElement('td', {\n      attrs: {\n        role: 'gridcell',\n        'aria-selected': 'false'\n      }\n    });\n    var tempData;\n    var rowSpan = 0;\n    var level;\n\n    if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n      var tContentCollection = [];\n      var parentCollection = this.parent.resourceBase.resourceCollection.slice(0, -1);\n\n      for (var w = 0; w < tContent.length; w++) {\n        tContentCollection = tContentCollection.concat(tContent[w]);\n      }\n\n      level = parentCollection.length > 0 ? 'parentColumnLevel_' + parentCollection.length : 'resourceColumn';\n      var rowSpanCollection = tContentCollection.filter(function (data) {\n        return data.type === level;\n      });\n\n      for (var x = 0; x < rowSpanCollection.length; x++) {\n        rowSpan = rowSpan + rowSpanCollection[x].rowSpan;\n      }\n    }\n\n    for (var row = 0; row < tContent.length; row++) {\n      ntr = tr.cloneNode();\n\n      for (var col = tContent[row].length - 1; col >= 0; col--) {\n        var data = tContent[row][col];\n        var ntd = td.cloneNode();\n\n        if (data.type === 'dateColumn') {\n          if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n            tempData = tContent[row][col];\n            continue;\n          }\n\n          ntd.setAttribute('data-date', data.date.getTime().toString());\n          ntd.appendChild(this.createDateHeaderElement(data.date));\n          var className = [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DATE_CLASS];\n\n          if (data.cssClass) {\n            className.push(data.cssClass);\n          }\n\n          addClass([ntd], className);\n          ntr.appendChild(ntd);\n        } else if (data.type === 'eventColumn') {\n          var elementType = data.eventData.length === 0 ? 'noEvents' : 'data';\n          ntd = this.createAgendaContentElement(elementType, data.eventData, ntd, data.groupOrder, data.groupIndex);\n          ntd.setAttribute('data-date', data.date.getTime().toString());\n\n          if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n            addClass([ntd], [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DAY_PADDING_CLASS]);\n          }\n\n          ntr.appendChild(ntd);\n        } else {\n          ntd.setAttribute('rowspan', data.rowSpan.toString());\n          addClass([ntd], cls.AGENDA_RESOURCE_CLASS);\n          this.viewBase.setResourceHeaderContent(ntd, data, data.className[0]);\n          ntr.appendChild(ntd);\n        }\n      }\n\n      if (this.parent.activeViewOptions.group.byDate && row === 0 && this.parent.currentView !== 'MonthAgenda') {\n        var ntd = td.cloneNode();\n        ntd.setAttribute('data-date', tempData.date.getTime().toString());\n        ntd.setAttribute('rowspan', rowSpan.toString());\n        ntd.appendChild(this.createDateHeaderElement(tempData.date));\n        addClass([ntd], [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DATE_CLASS, cls.DATE_BORDER_CLASS]);\n        var daysCount = util.getDaysCount(this.parent.selectedDate.getTime(), tempData.date.getTime());\n        ntr.setAttribute('aria-rowindex', daysCount.toString());\n\n        if (this.parent.element.querySelector(\".e-agenda-view tr[aria-rowindex=\\\"\" + daysCount + \"\\\"]\")) {\n          break;\n        }\n\n        ntr.insertBefore(ntd, ntr.childNodes[0]);\n      }\n\n      tBody.appendChild(ntr);\n    }\n  };\n\n  AgendaBase.prototype.createDateHeaderElement = function (date) {\n    var dateHeader;\n\n    if (this.parent.activeViewOptions.dateHeaderTemplate) {\n      dateHeader = createElement('div', {\n        className: cls.AGENDA_HEADER_CLASS\n      });\n      var dateValue = util.addLocalOffset(date);\n      var args = {\n        date: dateValue,\n        type: 'dateHeader'\n      };\n      var scheduleId = this.parent.element.id + '_';\n      var viewName = this.parent.activeViewOptions.dateHeaderTemplateName;\n      var templateId = scheduleId + viewName + 'dateHeaderTemplate';\n      var dateTemplate = [].slice.call(this.parent.getDateHeaderTemplate()(args, this.parent, 'dateHeaderTemplate', templateId, false));\n      append(dateTemplate, dateHeader);\n    } else {\n      dateHeader = this.viewBase.getMobileDateElement(date, cls.AGENDA_HEADER_CLASS);\n    }\n\n    return dateHeader;\n  };\n\n  AgendaBase.prototype.renderEmptyContent = function (tBody, agendaDate) {\n    var eTr = this.createTableRowElement(agendaDate, 'noEvents');\n    var eTd = eTr.children[0];\n    var noEvents = createElement('div', {\n      className: cls.AGENDA_EMPTY_EVENT_CLASS,\n      innerHTML: this.parent.localeObj.getConstant('noEvents')\n    });\n    eTd.appendChild(noEvents);\n    tBody.appendChild(eTr);\n  };\n\n  AgendaBase.prototype.createTableRowElement = function (date, type) {\n    var daysCount = util.getDaysCount(this.parent.selectedDate.getTime(), date.getTime());\n    var tr = createElement('tr', {\n      attrs: {\n        'role': 'row',\n        'aria-rowindex': daysCount.toString()\n      }\n    });\n    var td = createElement('td', {\n      attrs: {\n        'class': type === 'monthHeader' ? cls.MONTH_HEADER_CLASS : cls.AGENDA_CELLS_CLASS,\n        'role': 'gridcell',\n        'aria-selected': 'false',\n        'aria-colindex': daysCount.toString(),\n        'data-date': date.getTime().toString()\n      }\n    });\n    var dTd = td.cloneNode();\n    var aTd = td.cloneNode();\n    tr.appendChild(dTd);\n\n    if (type !== 'noEvents') {\n      tr.appendChild(aTd);\n    }\n\n    return tr;\n  };\n\n  return AgendaBase;\n}();\n\nexport { AgendaBase };","map":{"version":3,"sources":["C:/Users/User/volunteers/node_modules/@syncfusion/ej2-schedule/src/schedule/event-renderer/agenda-base.js"],"names":["isNullOrUndefined","addClass","createElement","append","EventHandler","extend","remove","ListBase","ViewBase","util","cls","event","AgendaBase","parent","viewBase","prototype","createAgendaContentElement","type","listData","aTd","groupOrder","groupIndex","listElement","fieldMapping","eventFields","noEvents","localeObj","getConstant","createList","moduleName","listClass","activeView","viewClass","itemClass","template","AGENDA_NO_EVENT_CLASS","_loop_1","li","length_1","appWrapper","className","APPOINTMENT_CLASS","attrs","this_1","id","Guid","eventBase","getReadonlyAttribute","getAnnocementString","setAttribute","toString","applyResourceColor","templateEle","activeViewOptions","eventTemplate","EVENT_TEMPLATE","scheduleId","element","viewName","eventTemplateName","templateId","templateArgs","addLocalOffsetToEvent","getAppointmentTemplate","recurrenceRule","iconClass","recurrenceID","EVENT_RECURRENCE_ICON_CLASS","EVENT_RECURRENCE_EDIT_ICON_CLASS","appendChild","ICON","createAppointment","slice","call","removeChildren","children","args","data","cancel","trigger","eventRendered","eventArgs","length","currentView","group","resources","AGENDA_DAY_BORDER_CLASS","renderTemplates","eventSubject","subject","eventSettings","fields","default","eventLocation","location","appSubjectWrap","SUBJECT_WRAP","SUBJECT_CLASS","innerHTML","LOCATION_CLASS","strDate","startTime","endDate","endTime","isAllDay","allDayStr","timeStr","getTimeString","milliSeconds","getTimezoneOffset","getTime","eventString","MS_PER_DAY","index","count","displayStr","appDateTime","DATE_TIME_CLASS","processAgendaEvents","events","eventsProcessed","_i","events_1","event_1","splited","splitEventByDay","concat","wireEventActions","eventElement","querySelectorAll","eventElement_1","wireAppointmentEvents","dateHeaderElement","_a","dateHeaderElement_1","add","agendaModule","dayNavigationClick","calculateResourceTableElement","tBody","noOfDays","agendaDate","resourceBase","lastResourceLevel","level","getDateSlots","renderDates","workDays","generateResourceLevels","agendaLastDate","addDays","Date","days","byDate","resColl","resourceCollection","resData","initialDate","i","lastLevelInfo","tempLastLevelInfo","tempIndex","eventObj","dateObj","firstDate","finalDate","agendaCollection","filterEvents","hideEmptyAgendaDays","res","resDataCollection","r","resDayCollection","undefined","push","rowSpan","resource","resourceData","eventData","date","cssClass","tempObj","RESOURCE_NAME","topResources","tempGroupedData","totalRowSpan","y","dataSource","x","z","u","idField","createResourceTableRow","totalCollection","allowVirtualScrolling","renderEmptyContent","tContent","tr","role","ntr","td","tempData","tContentCollection","parentCollection","w","rowSpanCollection","filter","row","cloneNode","col","ntd","createDateHeaderElement","AGENDA_CELLS_CLASS","AGENDA_DATE_CLASS","elementType","AGENDA_DAY_PADDING_CLASS","AGENDA_RESOURCE_CLASS","setResourceHeaderContent","DATE_BORDER_CLASS","daysCount","getDaysCount","selectedDate","querySelector","insertBefore","childNodes","dateHeader","dateHeaderTemplate","AGENDA_HEADER_CLASS","dateValue","addLocalOffset","dateHeaderTemplateName","dateTemplate","getDateHeaderTemplate","getMobileDateElement","eTr","createTableRowElement","eTd","AGENDA_EMPTY_EVENT_CLASS","MONTH_HEADER_CLASS","dTd"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, addClass, createElement, append, EventHandler, extend, remove } from '@syncfusion/ej2-base';\r\nimport { ListBase } from '@syncfusion/ej2-lists';\r\nimport { ViewBase } from '../renderer/view-base';\r\nimport * as util from '../base/util';\r\nimport * as cls from '../base/css-constant';\r\nimport * as event from '../base/constant';\r\nvar AgendaBase = /** @class */ (function () {\r\n    /**\r\n     * Constructor for AgendaBase\r\n     */\r\n    function AgendaBase(parent) {\r\n        this.parent = parent;\r\n        this.viewBase = new ViewBase(parent);\r\n    }\r\n    AgendaBase.prototype.createAgendaContentElement = function (type, listData, aTd, groupOrder, groupIndex) {\r\n        var listElement;\r\n        var fieldMapping = this.parent.eventFields;\r\n        if (type === 'noEvents') {\r\n            var noEvents = [{ 'subject': this.parent.localeObj.getConstant('noEvents') }];\r\n            listElement = ListBase.createList(this.parent.createElement, noEvents, {\r\n                moduleName: 'agenda',\r\n                listClass: this.parent.activeView.viewClass,\r\n                itemClass: this.parent.activeView.viewClass,\r\n                template: '<div class=' + cls.AGENDA_NO_EVENT_CLASS + '>${subject}</div>'\r\n            });\r\n        }\r\n        else {\r\n            listElement = ListBase.createList(this.parent.createElement, listData, {\r\n                moduleName: 'agenda',\r\n                listClass: this.parent.activeView.viewClass,\r\n                itemClass: this.parent.activeView.viewClass\r\n            });\r\n            var _loop_1 = function (li, length_1) {\r\n                var appWrapper = createElement('div', {\r\n                    className: cls.APPOINTMENT_CLASS, attrs: {\r\n                        'data-id': 'Appointment_' + listData[li][this_1.parent.eventFields.id],\r\n                        'data-guid': listData[li].Guid,\r\n                        'role': 'button',\r\n                        'tabindex': '0',\r\n                        'aria-readonly': this_1.parent.eventBase.getReadonlyAttribute(listData[li]),\r\n                        'aria-selected': 'false',\r\n                        'aria-grabbed': 'true',\r\n                        'aria-label': this_1.parent.getAnnocementString(listData[li])\r\n                    }\r\n                });\r\n                if (!isNullOrUndefined(groupIndex)) {\r\n                    appWrapper.setAttribute('data-group-index', groupIndex.toString());\r\n                }\r\n                this_1.parent.eventBase.applyResourceColor(appWrapper, listData[li], 'borderColor', groupOrder);\r\n                var templateEle = void 0;\r\n                if (!isNullOrUndefined(this_1.parent.activeViewOptions.eventTemplate)) {\r\n                    addClass([appWrapper], cls.EVENT_TEMPLATE);\r\n                    var scheduleId = this_1.parent.element.id + '_';\r\n                    var viewName = this_1.parent.activeViewOptions.eventTemplateName;\r\n                    var templateId = scheduleId + viewName + 'eventTemplate';\r\n                    var templateArgs = util.addLocalOffsetToEvent(listData[li], this_1.parent.eventFields);\r\n                    templateEle = this_1.parent.getAppointmentTemplate()(templateArgs, this_1.parent, 'eventTemplate', templateId, false);\r\n                    if (!isNullOrUndefined(listData[li][fieldMapping.recurrenceRule])) {\r\n                        var iconClass = (listData[li][fieldMapping.id] === listData[li][fieldMapping.recurrenceID]) ?\r\n                            cls.EVENT_RECURRENCE_ICON_CLASS : cls.EVENT_RECURRENCE_EDIT_ICON_CLASS;\r\n                        appWrapper.appendChild(createElement('div', { className: cls.ICON + ' ' + iconClass }));\r\n                    }\r\n                }\r\n                else {\r\n                    templateEle = this_1.createAppointment(listData[li]);\r\n                }\r\n                append([].slice.call(templateEle), appWrapper);\r\n                util.removeChildren(listElement.children[li]);\r\n                listElement.children[li].appendChild(appWrapper);\r\n                var args = {\r\n                    data: extend({}, listData[li], null, true),\r\n                    element: listElement.children[li], cancel: false\r\n                };\r\n                this_1.parent.trigger(event.eventRendered, args, function (eventArgs) {\r\n                    if (eventArgs.cancel) {\r\n                        remove(listElement.children[li]);\r\n                    }\r\n                });\r\n            };\r\n            var this_1 = this;\r\n            for (var li = 0, length_1 = listData.length; li < length_1; li++) {\r\n                _loop_1(li, length_1);\r\n            }\r\n        }\r\n        aTd.appendChild(listElement);\r\n        if ((this.parent.currentView === 'MonthAgenda' && this.parent.activeViewOptions.group.resources.length > 0)\r\n            || this.parent.currentView === 'Agenda') {\r\n            addClass([aTd], cls.AGENDA_DAY_BORDER_CLASS);\r\n        }\r\n        this.parent.renderTemplates();\r\n        return aTd;\r\n    };\r\n    AgendaBase.prototype.createAppointment = function (event) {\r\n        var fieldMapping = this.parent.eventFields;\r\n        var eventSubject = (event[fieldMapping.subject] || this.parent.eventSettings.fields.subject.default);\r\n        var eventLocation = (event[fieldMapping.location] || this.parent.eventSettings.fields.location.default);\r\n        var appSubjectWrap = createElement('div', { className: cls.SUBJECT_WRAP });\r\n        if (!isNullOrUndefined(eventLocation) && eventLocation !== '') {\r\n            eventSubject += ',';\r\n        }\r\n        appSubjectWrap.appendChild(createElement('div', { className: cls.SUBJECT_CLASS, innerHTML: eventSubject }));\r\n        if (!isNullOrUndefined(eventLocation) && eventLocation !== '') {\r\n            appSubjectWrap.appendChild(createElement('div', { className: cls.LOCATION_CLASS, innerHTML: eventLocation }));\r\n        }\r\n        if (!isNullOrUndefined(event[fieldMapping.recurrenceRule])) {\r\n            var iconClass = (event[fieldMapping.id] === event[fieldMapping.recurrenceID]) ?\r\n                cls.EVENT_RECURRENCE_ICON_CLASS : cls.EVENT_RECURRENCE_EDIT_ICON_CLASS;\r\n            appSubjectWrap.appendChild(createElement('div', { className: cls.ICON + ' ' + iconClass }));\r\n        }\r\n        var strDate = event[fieldMapping.startTime];\r\n        var endDate = event[fieldMapping.endTime];\r\n        var isAllDay = event[fieldMapping.isAllDay];\r\n        var allDayStr = this.parent.localeObj.getConstant('allDay');\r\n        var timeStr = this.parent.getTimeString(strDate) + ' - ' + this.parent.getTimeString(endDate);\r\n        if (!isNullOrUndefined(event.data)) {\r\n            var milliSeconds = (endDate.getTimezoneOffset() !== strDate.getTimezoneOffset()) ?\r\n                (endDate.getTime() - strDate.getTime() + 3600000) : (endDate.getTime() - strDate.getTime());\r\n            var eventString = (milliSeconds / util.MS_PER_DAY) >= 1 ? allDayStr : timeStr;\r\n            allDayStr = eventString + ' (' + this.parent.localeObj.getConstant('day') + ' '\r\n                + event.data.index + '/' + event.data.count + ')';\r\n        }\r\n        var displayStr = (!isNullOrUndefined(event.data) || isAllDay) ? allDayStr : timeStr;\r\n        var appDateTime = createElement('div', { className: cls.DATE_TIME_CLASS, innerHTML: displayStr });\r\n        return [appSubjectWrap, appDateTime];\r\n    };\r\n    AgendaBase.prototype.processAgendaEvents = function (events) {\r\n        var eventsProcessed = [];\r\n        if (isNullOrUndefined(events)) {\r\n            return eventsProcessed;\r\n        }\r\n        for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\r\n            var event_1 = events_1[_i];\r\n            var splited = this.parent.eventBase.splitEventByDay(event_1);\r\n            eventsProcessed = eventsProcessed.concat(splited.length > 1 ? splited : event_1);\r\n        }\r\n        return eventsProcessed;\r\n    };\r\n    AgendaBase.prototype.wireEventActions = function () {\r\n        var eventElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\r\n        for (var _i = 0, eventElement_1 = eventElement; _i < eventElement_1.length; _i++) {\r\n            var element = eventElement_1[_i];\r\n            this.parent.eventBase.wireAppointmentEvents(element, null, true);\r\n        }\r\n        var dateHeaderElement = [].slice.call(this.parent.element.querySelectorAll('.e-m-date'));\r\n        for (var _a = 0, dateHeaderElement_1 = dateHeaderElement; _a < dateHeaderElement_1.length; _a++) {\r\n            var element = dateHeaderElement_1[_a];\r\n            EventHandler.add(element, 'click', this.parent.agendaModule.dayNavigationClick, this);\r\n        }\r\n    };\r\n    AgendaBase.prototype.calculateResourceTableElement = function (tBody, noOfDays, agendaDate) {\r\n        if (isNullOrUndefined(this.parent.resourceBase.lastResourceLevel)) {\r\n            var level = this.viewBase.getDateSlots(this.viewBase.renderDates, this.parent.activeViewOptions.workDays);\r\n            this.parent.resourceBase.generateResourceLevels(level);\r\n        }\r\n        var agendaLastDate = util.addDays(new Date(agendaDate.getTime()), noOfDays);\r\n        var days = (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') ? noOfDays : 1;\r\n        var resColl = this.parent.resourceBase.resourceCollection;\r\n        var resData = this.parent.resourceBase.lastResourceLevel;\r\n        var initialDate = agendaDate;\r\n        for (var i = 0; i < days; i++) {\r\n            var lastLevelInfo = [];\r\n            var tempLastLevelInfo = [];\r\n            var tempIndex = 0;\r\n            var eventObj = void 0;\r\n            var dateObj = void 0;\r\n            var firstDate = util.addDays(initialDate, i);\r\n            var finalDate = (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda')\r\n                ? util.addDays(firstDate, 1) : agendaLastDate;\r\n            var agendaCollection = this.parent.eventBase.filterEvents(firstDate, finalDate);\r\n            if (agendaCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\r\n                for (var res = 0; res < resData.length; res++) {\r\n                    noOfDays = (!this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') ? noOfDays : 1;\r\n                    var data = [];\r\n                    agendaDate = firstDate;\r\n                    var resDataCollection = this.parent.eventBase.filterEvents(agendaDate, agendaLastDate, agendaCollection, resData[res]);\r\n                    if (resDataCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\r\n                        for (var r = 0; r < noOfDays; r++) {\r\n                            var resDayCollection = this.parent.eventBase.filterEvents(agendaDate, util.addDays(agendaDate, 1), resDataCollection, undefined);\r\n                            if (resDayCollection.length > 0 || !this.parent.hideEmptyAgendaDays ||\r\n                                this.parent.currentView === 'MonthAgenda') {\r\n                                data.push(resDayCollection[0]);\r\n                                eventObj = {\r\n                                    rowSpan: 1, type: 'eventColumn', resource: resColl[resColl.length - 1],\r\n                                    groupIndex: resData[res].groupIndex, groupOrder: resData[res].groupOrder,\r\n                                    resourceData: resData[res].resourceData, eventData: resDayCollection, date: agendaDate\r\n                                };\r\n                                dateObj = {\r\n                                    rowSpan: 1, type: 'dateColumn', resource: resColl[resColl.length - 1],\r\n                                    groupOrder: resData[res].groupOrder, resourceData: resData[res].resourceData,\r\n                                    date: agendaDate\r\n                                };\r\n                                if (!lastLevelInfo[tempIndex]) {\r\n                                    lastLevelInfo[tempIndex] = [];\r\n                                }\r\n                                lastLevelInfo[tempIndex].push(eventObj);\r\n                                lastLevelInfo[tempIndex].push(dateObj);\r\n                                tempIndex++;\r\n                            }\r\n                            agendaDate = util.addDays(agendaDate, 1);\r\n                            if (agendaDate.getTime() >= agendaLastDate.getTime() || this.parent.activeViewOptions.group.byDate\r\n                                || this.parent.currentView === 'MonthAgenda') {\r\n                                lastLevelInfo[lastLevelInfo.length - 1][1].cssClass = cls.AGENDA_DAY_BORDER_CLASS;\r\n                                var tempObj = {\r\n                                    rowSpan: data.length, type: 'resourceColumn', resource: resColl[resColl.length - 1],\r\n                                    groupOrder: resData[res].groupOrder.slice(0, -1), resourceData: resData[res].resourceData,\r\n                                    groupIndex: (lastLevelInfo.length - data.length), className: [cls.RESOURCE_NAME],\r\n                                    date: agendaDate\r\n                                };\r\n                                lastLevelInfo[lastLevelInfo.length - data.length].push(tempObj);\r\n                                tempLastLevelInfo.push(extend({}, tempObj, null, true));\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                var topResources = resColl.slice(0, -1);\r\n                var tempGroupedData = [];\r\n                var totalRowSpan = 0;\r\n                for (var y = 0; y < topResources.length; y++) {\r\n                    var data = topResources[topResources.length - (y + 1)]\r\n                        .dataSource;\r\n                    for (var x = 0; x < data.length; x++) {\r\n                        var z = 0;\r\n                        for (var u = 0; u < tempLastLevelInfo.length; u++) {\r\n                            if (tempLastLevelInfo[u].groupOrder[topResources.length - (y + 1)] === data[x][topResources[topResources.length - (y + 1)].idField]) {\r\n                                totalRowSpan = totalRowSpan + tempLastLevelInfo[u].rowSpan;\r\n                                tempGroupedData.push(extend({}, tempLastLevelInfo[u], null, true));\r\n                            }\r\n                            if (++z === tempLastLevelInfo.length && tempGroupedData.length > 0) {\r\n                                tempGroupedData[0].rowSpan = totalRowSpan;\r\n                                tempGroupedData[0].type = 'parentColumnLevel_' + (y + 1);\r\n                                tempGroupedData[0].resource = topResources[topResources.length - (y + 1)];\r\n                                tempGroupedData[0].resourceData = data[x];\r\n                                tempGroupedData[0].date = agendaDate;\r\n                                lastLevelInfo[tempGroupedData[0].groupIndex].push(tempGroupedData[0]);\r\n                                tempGroupedData = [];\r\n                                totalRowSpan = 0;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                this.createResourceTableRow(lastLevelInfo, tBody);\r\n            }\r\n        }\r\n        var totalCollection = this.parent.eventBase.filterEvents(initialDate, agendaLastDate);\r\n        if (totalCollection.length === 0 && !this.parent.activeViewOptions.allowVirtualScrolling && this.parent.hideEmptyAgendaDays) {\r\n            this.renderEmptyContent(tBody, initialDate);\r\n        }\r\n    };\r\n    AgendaBase.prototype.createResourceTableRow = function (tContent, tBody) {\r\n        var tr = createElement('tr', { attrs: { role: 'row' } });\r\n        var ntr;\r\n        var td = createElement('td', { attrs: { role: 'gridcell', 'aria-selected': 'false' } });\r\n        var tempData;\r\n        var rowSpan = 0;\r\n        var level;\r\n        if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\r\n            var tContentCollection = [];\r\n            var parentCollection = this.parent.resourceBase.resourceCollection.slice(0, -1);\r\n            for (var w = 0; w < tContent.length; w++) {\r\n                tContentCollection = tContentCollection.concat(tContent[w]);\r\n            }\r\n            level = (parentCollection.length > 0) ? 'parentColumnLevel_' + parentCollection.length : 'resourceColumn';\r\n            var rowSpanCollection = tContentCollection.filter(function (data) { return data.type === level; });\r\n            for (var x = 0; x < rowSpanCollection.length; x++) {\r\n                rowSpan = rowSpan + rowSpanCollection[x].rowSpan;\r\n            }\r\n        }\r\n        for (var row = 0; row < tContent.length; row++) {\r\n            ntr = tr.cloneNode();\r\n            for (var col = tContent[row].length - 1; col >= 0; col--) {\r\n                var data = tContent[row][col];\r\n                var ntd = td.cloneNode();\r\n                if (data.type === 'dateColumn') {\r\n                    if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\r\n                        tempData = tContent[row][col];\r\n                        continue;\r\n                    }\r\n                    ntd.setAttribute('data-date', data.date.getTime().toString());\r\n                    ntd.appendChild(this.createDateHeaderElement(data.date));\r\n                    var className = [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DATE_CLASS];\r\n                    if (data.cssClass) {\r\n                        className.push(data.cssClass);\r\n                    }\r\n                    addClass([ntd], className);\r\n                    ntr.appendChild(ntd);\r\n                }\r\n                else if (data.type === 'eventColumn') {\r\n                    var elementType = (data.eventData.length === 0) ? 'noEvents' : 'data';\r\n                    ntd = this.createAgendaContentElement(elementType, data.eventData, ntd, data.groupOrder, data.groupIndex);\r\n                    ntd.setAttribute('data-date', data.date.getTime().toString());\r\n                    if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\r\n                        addClass([ntd], [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DAY_PADDING_CLASS]);\r\n                    }\r\n                    ntr.appendChild(ntd);\r\n                }\r\n                else {\r\n                    ntd.setAttribute('rowspan', data.rowSpan.toString());\r\n                    addClass([ntd], cls.AGENDA_RESOURCE_CLASS);\r\n                    this.viewBase.setResourceHeaderContent(ntd, data, data.className[0]);\r\n                    ntr.appendChild(ntd);\r\n                }\r\n            }\r\n            if (this.parent.activeViewOptions.group.byDate && row === 0 && this.parent.currentView !== 'MonthAgenda') {\r\n                var ntd = td.cloneNode();\r\n                ntd.setAttribute('data-date', tempData.date.getTime().toString());\r\n                ntd.setAttribute('rowspan', rowSpan.toString());\r\n                ntd.appendChild(this.createDateHeaderElement(tempData.date));\r\n                addClass([ntd], [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DATE_CLASS, cls.DATE_BORDER_CLASS]);\r\n                var daysCount = util.getDaysCount(this.parent.selectedDate.getTime(), tempData.date.getTime());\r\n                ntr.setAttribute('aria-rowindex', daysCount.toString());\r\n                if (this.parent.element.querySelector(\".e-agenda-view tr[aria-rowindex=\\\"\" + daysCount + \"\\\"]\")) {\r\n                    break;\r\n                }\r\n                ntr.insertBefore(ntd, ntr.childNodes[0]);\r\n            }\r\n            tBody.appendChild(ntr);\r\n        }\r\n    };\r\n    AgendaBase.prototype.createDateHeaderElement = function (date) {\r\n        var dateHeader;\r\n        if (this.parent.activeViewOptions.dateHeaderTemplate) {\r\n            dateHeader = createElement('div', { className: cls.AGENDA_HEADER_CLASS });\r\n            var dateValue = util.addLocalOffset(date);\r\n            var args = { date: dateValue, type: 'dateHeader' };\r\n            var scheduleId = this.parent.element.id + '_';\r\n            var viewName = this.parent.activeViewOptions.dateHeaderTemplateName;\r\n            var templateId = scheduleId + viewName + 'dateHeaderTemplate';\r\n            var dateTemplate = [].slice.call(this.parent.getDateHeaderTemplate()(args, this.parent, 'dateHeaderTemplate', templateId, false));\r\n            append(dateTemplate, dateHeader);\r\n        }\r\n        else {\r\n            dateHeader = this.viewBase.getMobileDateElement(date, cls.AGENDA_HEADER_CLASS);\r\n        }\r\n        return dateHeader;\r\n    };\r\n    AgendaBase.prototype.renderEmptyContent = function (tBody, agendaDate) {\r\n        var eTr = this.createTableRowElement(agendaDate, 'noEvents');\r\n        var eTd = eTr.children[0];\r\n        var noEvents = createElement('div', {\r\n            className: cls.AGENDA_EMPTY_EVENT_CLASS,\r\n            innerHTML: this.parent.localeObj.getConstant('noEvents')\r\n        });\r\n        eTd.appendChild(noEvents);\r\n        tBody.appendChild(eTr);\r\n    };\r\n    AgendaBase.prototype.createTableRowElement = function (date, type) {\r\n        var daysCount = util.getDaysCount(this.parent.selectedDate.getTime(), date.getTime());\r\n        var tr = createElement('tr', { attrs: { 'role': 'row', 'aria-rowindex': daysCount.toString() } });\r\n        var td = createElement('td', {\r\n            attrs: {\r\n                'class': (type === 'monthHeader') ? cls.MONTH_HEADER_CLASS : cls.AGENDA_CELLS_CLASS,\r\n                'role': 'gridcell',\r\n                'aria-selected': 'false',\r\n                'aria-colindex': daysCount.toString(),\r\n                'data-date': date.getTime().toString()\r\n            }\r\n        });\r\n        var dTd = td.cloneNode();\r\n        var aTd = td.cloneNode();\r\n        tr.appendChild(dTd);\r\n        if (type !== 'noEvents') {\r\n            tr.appendChild(aTd);\r\n        }\r\n        return tr;\r\n    };\r\n    return AgendaBase;\r\n}());\r\nexport { AgendaBase };\r\n"]},"metadata":{},"sourceType":"module"}