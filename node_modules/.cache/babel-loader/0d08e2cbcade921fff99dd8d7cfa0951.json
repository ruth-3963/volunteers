{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { createElement, closest, Draggable, extend, formatUnit, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { addClass, remove, removeClass, setStyleAttribute, Browser, EventHandler } from '@syncfusion/ej2-base';\nimport { ActionBase } from '../actions/action-base';\nimport { MonthEvent } from '../event-renderer/month';\nimport { TimelineEvent } from '../event-renderer/timeline-view';\nimport { YearEvent } from '../event-renderer/year';\nimport { VerticalEvent } from '../event-renderer/vertical-view';\nimport * as cls from '../base/css-constant';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\nvar MINUTES_PER_DAY = 1440;\n/**\n * Schedule events drag actions\n */\n\nvar DragAndDrop =\n/** @class */\nfunction (_super) {\n  __extends(DragAndDrop, _super);\n\n  function DragAndDrop() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.widthUptoCursorPoint = 0;\n    _this.heightUptoCursorPoint = 0;\n    _this.cursorPointIndex = 0;\n    _this.isHeaderRows = false;\n    _this.isTimelineDayProcess = false;\n    _this.widthPerMinute = 0;\n    _this.heightPerMinute = 0;\n    _this.minDiff = 0;\n    _this.isStepDragging = false;\n    _this.isMorePopupOpened = false;\n    _this.isAllDayDrag = false;\n    return _this;\n  }\n\n  DragAndDrop.prototype.wireDragEvent = function (element) {\n    var dragObj = new Draggable(element, {\n      abort: '.' + cls.EVENT_RESIZE_CLASS,\n      clone: true,\n      isDragScroll: true,\n      enableTapHold: this.parent.isAdaptive,\n      enableTailMode: this.parent.eventDragArea ? true : false,\n      cursorAt: this.parent.eventDragArea ? {\n        left: -20,\n        top: -20\n      } : {\n        left: 0,\n        top: 0\n      },\n      dragArea: this.parent.eventDragArea ? document.querySelector(this.parent.eventDragArea) : this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS),\n      dragStart: this.dragStart.bind(this),\n      drag: this.drag.bind(this),\n      dragStop: this.dragStop.bind(this),\n      enableAutoScroll: false,\n      helper: this.dragHelper.bind(this),\n      queryPositionInfo: this.dragPosition.bind(this)\n    });\n\n    if (!(dragObj.enableTapHold && Browser.isDevice && Browser.isTouch)) {\n      // tslint:disable-next-line:no-any\n      EventHandler.remove(element, 'touchstart', dragObj.initialize);\n    }\n  };\n\n  DragAndDrop.prototype.dragHelper = function (e) {\n    this.setDragActionDefaultValues();\n    this.actionObj.element = e.element;\n    this.actionObj.action = 'drag';\n    this.actionObj.clone = this.createCloneElement(this.actionObj.element);\n\n    if (!this.parent.eventDragArea && this.parent.currentView !== 'Month' && this.parent.timeScale.enable && !this.parent.activeView.isTimelineView() && !this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n      setStyleAttribute(this.actionObj.clone, {\n        cursor: 'move',\n        left: '0%',\n        right: '0%',\n        width: '100%'\n      });\n    }\n\n    this.actionObj.clone.style.top = formatUnit(this.actionObj.element.offsetTop);\n    this.actionObj.cloneElement = [this.actionObj.clone];\n    this.actionObj.originalElement = [this.actionObj.element];\n    return this.actionObj.clone;\n  };\n\n  DragAndDrop.prototype.dragPosition = function (e) {\n    if (this.parent.eventDragArea) {\n      return {\n        left: e.left,\n        top: e.top\n      };\n    }\n\n    var cellHeight = this.actionObj.cellHeight / this.actionObj.slotInterval * this.actionObj.interval;\n    var leftValue = formatUnit(0);\n\n    if (this.parent.currentView === 'Month') {\n      leftValue = e.left;\n    }\n\n    if (this.parent.activeView.isTimelineView()) {\n      leftValue = formatUnit(this.actionObj.clone.offsetLeft);\n    }\n\n    var topValue;\n\n    if (this.parent.activeView.isTimelineView() || !this.parent.timeScale.enable || !isNullOrUndefined(this.actionObj.clone.offsetParent) && this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n      topValue = formatUnit(this.actionObj.clone.offsetTop);\n    } else if (this.parent.currentView === 'Month') {\n      topValue = formatUnit(0);\n    } else if (this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n      topValue = formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop);\n      setStyleAttribute(this.actionObj.clone, {\n        width: formatUnit(Math.ceil(this.actionObj.clone.offsetWidth / this.actionObj.cellWidth) * this.actionObj.cellWidth),\n        right: this.parent.enableRtl && formatUnit(0)\n      });\n    } else {\n      if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) && !this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        setStyleAttribute(this.actionObj.clone, {\n          height: formatUnit(this.actionObj.cellHeight),\n          width: formatUnit(this.actionObj.cellWidth - 1),\n          pointerEvents: 'none'\n        });\n      }\n\n      var top_1 = parseInt(e.top, 10);\n      top_1 = top_1 < 0 ? 0 : top_1;\n      topValue = formatUnit(Math.ceil(top_1 / cellHeight) * cellHeight);\n      var scrollHeight = this.parent.element.querySelector('.e-content-wrap').scrollHeight;\n      var cloneBottom = parseInt(topValue, 10) + this.actionObj.clone.offsetHeight;\n\n      if (cloneBottom > scrollHeight) {\n        topValue = parseInt(topValue, 10) - (cloneBottom - scrollHeight) + 'px';\n      }\n    }\n\n    return {\n      left: leftValue,\n      top: topValue\n    };\n  };\n\n  DragAndDrop.prototype.setDragActionDefaultValues = function () {\n    this.actionObj.action = 'drag';\n    this.actionObj.isAllDay = null;\n    this.actionObj.slotInterval = this.parent.activeViewOptions.timeScale.interval / this.parent.activeViewOptions.timeScale.slotCount;\n    this.actionObj.interval = this.actionObj.slotInterval;\n    var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n    this.actionObj.cellWidth = workCell.offsetWidth;\n    this.actionObj.cellHeight = workCell.offsetHeight;\n  };\n\n  DragAndDrop.prototype.dragStart = function (e) {\n    var _this = this;\n\n    var eventGuid = this.actionObj.element.getAttribute('data-guid');\n    this.actionObj.event = this.parent.eventBase.getEventByGuid(eventGuid);\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var dragArgs = {\n      cancel: false,\n      data: eventObj,\n      event: e,\n      excludeSelectors: null,\n      element: this.actionObj.element,\n      interval: this.actionObj.interval,\n      navigation: {\n        enable: false,\n        timeDelay: 2000\n      },\n      scroll: {\n        enable: true,\n        scrollBy: 30,\n        timeDelay: 100\n      }\n    };\n    this.parent.trigger(events.dragStart, dragArgs, function (dragEventArgs) {\n      if (dragEventArgs.cancel || !isNullOrUndefined(_this.actionObj.element) && isNullOrUndefined(_this.actionObj.element.parentElement)) {\n        var dragObj = _this.actionObj.element.ej2_instances[0];\n\n        if (!isNullOrUndefined(dragObj)) {\n          dragObj.intDestroy(e.event);\n        }\n\n        _this.actionObj.action = '';\n\n        _this.removeCloneElementClasses();\n\n        _this.removeCloneElement();\n\n        return;\n      }\n\n      _this.actionClass('addClass');\n\n      _this.parent.uiStateValues.action = true;\n      _this.actionObj.start = eventObj[_this.parent.eventFields.startTime];\n      _this.actionObj.end = eventObj[_this.parent.eventFields.endTime];\n      _this.actionObj.groupIndex = parseInt(_this.actionObj.element.getAttribute('data-group-index') || '0', 10);\n      _this.actionObj.interval = dragEventArgs.interval;\n      _this.actionObj.navigation = dragEventArgs.navigation;\n      _this.actionObj.scroll = dragEventArgs.scroll;\n      _this.actionObj.excludeSelectors = dragEventArgs.excludeSelectors;\n\n      var viewElement = _this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n      _this.scrollArgs = {\n        element: viewElement,\n        width: viewElement.scrollWidth,\n        height: viewElement.scrollHeight\n      };\n      _this.widthPerMinute = _this.actionObj.cellWidth / _this.actionObj.slotInterval * _this.actionObj.interval;\n      _this.heightPerMinute = _this.actionObj.cellHeight / _this.actionObj.slotInterval * _this.actionObj.interval;\n      _this.widthUptoCursorPoint = 0;\n      _this.heightUptoCursorPoint = 0;\n      _this.cursorPointIndex = -1;\n      _this.isHeaderRows = false;\n      _this.isTimelineDayProcess = false;\n      _this.minDiff = 0;\n      _this.isMorePopupOpened = false;\n      _this.daysVariation = -1;\n\n      if ((_this.parent.activeView.isTimelineView() || !_this.parent.timeScale.enable) && _this.parent.currentView !== 'TimelineYear') {\n        if (!isNullOrUndefined(_this.actionObj.clone.offsetParent) && _this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n          _this.isMorePopupOpened = true;\n        }\n\n        var rows = _this.parent.activeViewOptions.headerRows;\n        _this.isHeaderRows = rows.length > 0 && rows[rows.length - 1].option !== 'Hour' && rows[rows.length - 1].option !== 'Date';\n        _this.isTimelineDayProcess = !_this.parent.activeViewOptions.timeScale.enable || _this.isHeaderRows || _this.parent.currentView === 'TimelineMonth' || rows.length > 0 && rows[rows.length - 1].option === 'Date';\n        _this.isStepDragging = !_this.isTimelineDayProcess && _this.actionObj.slotInterval !== _this.actionObj.interval;\n\n        if (_this.isTimelineDayProcess) {\n          _this.timelineEventModule = new TimelineEvent(_this.parent, 'day');\n        } else {\n          _this.timelineEventModule = new TimelineEvent(_this.parent, 'hour');\n        }\n      }\n\n      if (_this.parent.currentView === 'TimelineYear') {\n        _this.yearEvent = new YearEvent(_this.parent);\n      }\n\n      if (_this.parent.currentView === 'Month') {\n        _this.updateOriginalElement(_this.actionObj.clone);\n\n        _this.monthEvent = new MonthEvent(_this.parent);\n      }\n\n      if (_this.parent.currentView === 'Day' || _this.parent.currentView === 'Week' || _this.parent.currentView === 'WorkWeek') {\n        _this.verticalEvent = new VerticalEvent(_this.parent);\n      }\n    });\n  };\n\n  DragAndDrop.prototype.drag = function (e) {\n    this.parent.quickPopup.quickPopupHide(true);\n\n    if (!isNullOrUndefined(e.target) && e.target.classList.contains(cls.DISABLE_DATES)) {\n      return;\n    }\n\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventArgs = this.getPageCoordinates(e);\n    this.actionObj.Y = this.actionObj.pageY = eventArgs.pageY;\n    this.actionObj.X = this.actionObj.pageX = eventArgs.pageX;\n    this.actionObj.target = e.target;\n    this.widthUptoCursorPoint = this.widthUptoCursorPoint === 0 ? Math.ceil(Math.abs(this.actionObj.clone.getBoundingClientRect().left - this.actionObj.X) / this.widthPerMinute) * this.widthPerMinute : this.widthUptoCursorPoint;\n    this.widthUptoCursorPoint = this.isMorePopupOpened ? this.actionObj.cellWidth : this.widthUptoCursorPoint;\n    this.heightUptoCursorPoint = this.heightUptoCursorPoint === 0 ? Math.ceil(Math.abs(this.actionObj.clone.getBoundingClientRect().top - this.actionObj.Y) / this.heightPerMinute) * this.heightPerMinute : this.heightUptoCursorPoint;\n    this.isAllDayDrag = this.parent.activeViewOptions.timeScale.enable ? this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) : this.actionObj.event[this.parent.eventFields.isAllDay];\n\n    if (this.isStepDragging && this.minDiff === 0) {\n      this.calculateMinutesDiff(eventObj);\n    }\n\n    if ((this.parent.currentView === 'Month' || this.isAllDayDrag) && this.daysVariation < 0) {\n      var date = this.parent.getDateFromElement(this.actionObj.target);\n\n      if (!isNullOrUndefined(date)) {\n        var currentDate = util.resetTime(date);\n        var startDate = util.resetTime(new Date(eventObj[this.parent.eventFields.startTime].getTime()));\n        this.daysVariation = (currentDate.getTime() - startDate.getTime()) / util.MS_PER_DAY;\n      } else {\n        this.daysVariation = 0;\n      }\n    } else {\n      this.daysVariation = 0;\n    }\n\n    if (this.parent.eventDragArea) {\n      var targetElement = eventArgs.target;\n      this.actionObj.clone.style.top = formatUnit(targetElement.offsetTop);\n      this.actionObj.clone.style.left = formatUnit(targetElement.offsetLeft);\n      var currentTarget = closest(targetElement, '.' + cls.ROOT);\n\n      if (!currentTarget) {\n        this.actionObj.clone.style.height = '';\n        this.actionObj.clone.style.width = '';\n      } else {\n        if (!(this.parent.currentView === 'Week' || this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'Day')) {\n          this.actionObj.clone.style.width = formatUnit(this.actionObj.element.offsetWidth);\n        }\n      }\n    }\n\n    this.updateScrollPosition(e);\n    this.updateNavigatingPosition(e);\n    this.updateDraggingDateTime(e);\n    var dragArgs = {\n      data: eventObj,\n      event: e,\n      element: this.actionObj.element,\n      startTime: this.actionObj.start,\n      endTime: this.actionObj.end\n    };\n\n    if (this.parent.group.resources.length > 0) {\n      dragArgs.groupIndex = this.actionObj.groupIndex;\n    }\n\n    this.parent.trigger(events.drag, dragArgs);\n  };\n\n  DragAndDrop.prototype.calculateMinutesDiff = function (eventObj) {\n    if (this.parent.enableRtl) {\n      this.minDiff = (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint) / this.widthPerMinute * this.actionObj.interval;\n    } else {\n      this.minDiff = this.widthUptoCursorPoint / this.widthPerMinute * this.actionObj.interval;\n    }\n\n    var startDate = eventObj[this.parent.eventFields.startTime];\n    var startTime = this.parent.activeView.renderDates[0];\n    var startEndHours = util.getStartEndHours(startTime, this.parent.activeView.getStartHour(), this.parent.activeView.getEndHour());\n\n    if (startEndHours.startHour.getTime() > startDate.getTime()) {\n      this.minDiff = this.minDiff + (startEndHours.startHour.getTime() - startDate.getTime()) / util.MS_PER_MINUTE;\n    }\n  };\n\n  DragAndDrop.prototype.dragStop = function (e) {\n    var _this = this;\n\n    this.removeCloneElementClasses();\n    this.removeCloneElement();\n    clearInterval(this.actionObj.navigationInterval);\n    this.actionObj.navigationInterval = null;\n    clearInterval(this.actionObj.scrollInterval);\n    this.actionObj.scrollInterval = null;\n    this.actionClass('removeClass');\n    this.parent.uiStateValues.action = false;\n    this.actionObj.action = null;\n\n    if (this.isAllowDrop(e)) {\n      return;\n    }\n\n    var target = !e.target.classList.contains('e-work-cells') && this.parent.cellTemplate ? closest(e.target, '.e-work-cells') : e.target;\n    var dragArgs = {\n      cancel: false,\n      data: this.getChangedData(),\n      event: e,\n      element: this.actionObj.element,\n      target: target\n    };\n    this.parent.trigger(events.dragStop, dragArgs, function (dragEventArgs) {\n      if (dragEventArgs.cancel) {\n        return;\n      }\n\n      if (_this.parent.activeViewOptions.group.resources.length > 0 && !_this.parent.activeViewOptions.group.allowGroupEdit && !_this.parent.rowAutoHeight && !_this.parent.virtualScrollModule && _this.parent.activeViewOptions.group.byGroupID) {\n        _this.parent.crudModule.crudObj.isCrudAction = true;\n        _this.parent.crudModule.crudObj.sourceEvent = [_this.parent.resourceBase.lastResourceLevel[parseInt(dragArgs.element.getAttribute('data-group-index'), 10)]];\n\n        var currentGroupIndex = parseInt(dragArgs.target.getAttribute('data-group-index'), 10) || _this.actionObj.groupIndex;\n\n        _this.parent.crudModule.crudObj.targetEvent = [_this.parent.resourceBase.lastResourceLevel[currentGroupIndex]];\n      }\n\n      _this.saveChangedData(dragEventArgs);\n    });\n  };\n\n  DragAndDrop.prototype.updateNavigatingPosition = function (e) {\n    var _this = this;\n\n    if (this.actionObj.navigation.enable) {\n      var currentDate_1 = this.parent.getCurrentTime();\n\n      if (isNullOrUndefined(this.actionObj.navigationInterval)) {\n        this.actionObj.navigationInterval = window.setInterval(function () {\n          if (currentDate_1) {\n            var crtDate = _this.parent.getCurrentTime();\n\n            var end = crtDate.getSeconds();\n            var start = currentDate_1.getSeconds() + _this.actionObj.navigation.timeDelay / 1000;\n            start = start >= 60 ? start - 60 : start;\n\n            if (start === end) {\n              currentDate_1 = _this.parent.getCurrentTime();\n\n              _this.viewNavigation(e);\n\n              _this.updateDraggingDateTime(e);\n            }\n          }\n        }, this.actionObj.navigation.timeDelay);\n      }\n    }\n  };\n\n  DragAndDrop.prototype.updateDraggingDateTime = function (e) {\n    if (!isNullOrUndefined(this.actionObj.clone.offsetParent) && this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n      this.morePopupEventDragging(e);\n    } else if (this.parent.activeView.isTimelineView() && this.parent.currentView !== 'TimelineYear') {\n      this.timelineEventModule.dateRender = this.parent.activeView.renderDates;\n      this.timelineEventModule.cellWidth = this.actionObj.cellWidth;\n      this.timelineEventModule.getSlotDates();\n      this.actionObj.cellWidth = this.isHeaderRows ? this.timelineEventModule.cellWidth : this.actionObj.cellWidth;\n      this.calculateTimelineTime(e);\n    } else {\n      if (this.parent.currentView === 'Month' || this.parent.currentView === 'TimelineYear') {\n        this.calculateVerticalDate(e);\n      } else {\n        this.calculateVerticalTime(e);\n      }\n    }\n  };\n\n  DragAndDrop.prototype.navigationWrapper = function () {\n    if (!this.parent.activeView.isTimelineView()) {\n      if (this.parent.currentView === 'Month' || !this.parent.timeScale.enable) {\n        var outerWrapperCls = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n        this.actionObj.index = this.parent.activeView.renderDates.length < this.actionObj.index ? this.parent.activeView.renderDates.length - 1 : this.actionObj.index;\n        var targetWrapper = outerWrapperCls[this.actionObj.index].querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n        if (!targetWrapper) {\n          targetWrapper = createElement('div', {\n            className: cls.APPOINTMENT_WRAPPER_CLASS\n          });\n          outerWrapperCls[this.actionObj.index].appendChild(targetWrapper);\n        }\n\n        targetWrapper.appendChild(this.actionObj.clone);\n      } else {\n        var wrapperClass = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n        this.parent.element.querySelectorAll(wrapperClass).item(this.actionObj.index).appendChild(this.actionObj.clone);\n\n        if (wrapperClass === '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS) {\n          var elementHeight = this.getAllDayEventHeight();\n          var event_2 = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n\n          if (event_2[0].offsetHeight < elementHeight) {\n            for (var _i = 0, event_1 = event_2; _i < event_1.length; _i++) {\n              var e = event_1[_i];\n              e.style.height = (elementHeight + 2) / 12 + 'em';\n            }\n          }\n\n          this.actionObj.clone.style.height = formatUnit(elementHeight);\n        }\n\n        this.actionObj.height = parseInt(this.actionObj.clone.style.height, 0);\n      }\n    } else {\n      var outWrapper = void 0;\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        outWrapper = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(this.actionObj.index);\n      } else {\n        outWrapper = this.parent.element.querySelector('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n      }\n\n      var tarWrapper = outWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n      if (!tarWrapper) {\n        tarWrapper = createElement('div', {\n          className: cls.APPOINTMENT_WRAPPER_CLASS\n        });\n        outWrapper.appendChild(tarWrapper);\n      }\n\n      tarWrapper.appendChild(this.actionObj.clone);\n    }\n  };\n\n  DragAndDrop.prototype.viewNavigation = function (e) {\n    var navigationType;\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n    if (dragArea && (!this.scrollEdges.top && !this.scrollEdges.bottom || closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS))) {\n      if (dragArea.scrollLeft === 0 && Math.round(this.actionObj.X) <= Math.round(dragArea.getBoundingClientRect().left + this.actionObj.cellWidth + window.pageXOffset)) {\n        navigationType = this.parent.enableRtl ? 'next' : 'previous';\n      } else if (Math.round(dragArea.scrollLeft) + dragArea.clientWidth === dragArea.scrollWidth && Math.round(this.actionObj.X) >= Math.round(dragArea.getBoundingClientRect().right - this.actionObj.cellWidth + window.pageXOffset)) {\n        navigationType = this.parent.enableRtl ? 'previous' : 'next';\n      }\n\n      if (navigationType) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate(navigationType));\n      }\n    }\n  };\n\n  DragAndDrop.prototype.morePopupEventDragging = function (e) {\n    if (isNullOrUndefined(e.target) || e.target && isNullOrUndefined(closest(e.target, 'td'))) {\n      return;\n    }\n\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var td = closest(e.target, 'td');\n\n    if (this.parent.currentView === 'TimelineYear' && !td.classList.contains('e-work-cells')) {\n      return;\n    }\n\n    var dragStart = this.parent.getDateFromElement(td);\n    var dragEnd = new Date(dragStart.getTime());\n    dragEnd.setMilliseconds(eventDuration);\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n    }\n\n    this.actionObj.start = new Date(dragStart.getTime());\n    this.actionObj.end = new Date(dragEnd.getTime());\n    this.actionObj.clone.style.top = formatUnit(td.offsetParent.offsetTop);\n    this.actionObj.clone.style.left = formatUnit(td.offsetLeft);\n    this.actionObj.clone.style.width = formatUnit(td.offsetWidth);\n    var eventContainer = td;\n    var eventWrapper;\n\n    if (this.parent.activeView.isTimelineView()) {\n      var rowIndex = closest(td, 'tr').rowIndex;\n      eventContainer = this.parent.element.querySelectorAll('.e-appointment-container').item(rowIndex);\n    }\n\n    eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n    if (!eventWrapper) {\n      eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      eventContainer.appendChild(eventWrapper);\n    }\n\n    this.appendCloneElement(eventWrapper);\n  };\n\n  DragAndDrop.prototype.calculateVerticalTime = function (e) {\n    if (isNullOrUndefined(this.actionObj.target) || this.actionObj.target && isNullOrUndefined(closest(this.actionObj.target, 'tr')) || !closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) && !closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      return;\n    }\n\n    if (this.parent.activeViewOptions.timeScale.enable) {\n      this.swapDragging(e);\n    }\n\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventStart = eventObj[this.parent.eventFields.startTime];\n    var eventEnd = eventObj[this.parent.eventFields.endTime];\n    var eventDuration = eventEnd.getTime() - eventStart.getTime();\n    var offsetTop = Math.floor(parseInt(this.actionObj.clone.style.top, 10) / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n    offsetTop = offsetTop < 0 ? 0 : offsetTop;\n\n    if (this.scrollEdges.top || this.scrollEdges.bottom) {\n      offsetTop = this.scrollEdges.top ? dragArea.scrollTop - this.heightUptoCursorPoint + this.actionObj.cellHeight + window.pageYOffset : dragArea.scrollTop + dragArea.offsetHeight - this.actionObj.clone.offsetHeight + window.pageYOffset + (this.actionObj.clone.offsetHeight - this.heightUptoCursorPoint);\n      offsetTop = Math.round(offsetTop / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n      this.actionObj.clone.style.top = formatUnit(offsetTop);\n    }\n\n    var rowIndex = this.parent.activeViewOptions.timeScale.enable ? offsetTop / this.actionObj.cellHeight : 0;\n    var heightPerMinute = this.actionObj.cellHeight / this.actionObj.slotInterval;\n    var diffInMinutes = parseInt(this.actionObj.clone.style.top, 10) - offsetTop;\n    var tr;\n\n    if (this.isAllDayDrag) {\n      tr = this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS);\n    } else {\n      var trCollections = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n      tr = trCollections[rowIndex];\n    }\n\n    var index;\n\n    if (closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) || closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      index = closest(this.actionObj.target, 'td').cellIndex;\n    }\n\n    var colIndex = isNullOrUndefined(index) ? closest(this.actionObj.clone, 'td').cellIndex : index;\n    this.actionObj.index = colIndex;\n\n    if (isNullOrUndefined(tr)) {\n      return;\n    }\n\n    var td = tr.children[colIndex];\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n    }\n\n    var dragStart;\n    var dragEnd;\n\n    if (this.parent.activeViewOptions.timeScale.enable && !this.isAllDayDrag) {\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      dragStart = this.parent.getDateFromElement(td);\n      dragStart.setMinutes(dragStart.getMinutes() + diffInMinutes / heightPerMinute);\n      dragEnd = new Date(dragStart.getTime());\n\n      if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        dragEnd.setMinutes(dragEnd.getMinutes() + this.actionObj.slotInterval);\n      } else {\n        dragEnd.setMilliseconds(eventDuration);\n      }\n    } else {\n      dragStart = this.parent.getDateFromElement(td);\n      dragStart.setDate(dragStart.getDate() - this.daysVariation);\n      dragStart.setHours(eventStart.getHours(), eventStart.getMinutes(), eventStart.getSeconds());\n      dragEnd = new Date(dragStart.getTime());\n      dragEnd.setMilliseconds(eventDuration);\n\n      if (!this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) && this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        dragEnd = util.addDays(util.resetTime(dragEnd), 1);\n      }\n\n      this.updateAllDayEvents(dragStart, dragEnd, this.parent.activeViewOptions.group.byDate ? colIndex : undefined);\n    }\n\n    this.actionObj.start = new Date(+dragStart);\n    this.actionObj.end = new Date(+dragEnd);\n    var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n    this.updateEventHeight(event);\n    this.updateTimePosition(this.actionObj.start);\n  };\n\n  DragAndDrop.prototype.updateEventHeight = function (event) {\n    this.verticalEvent.initializeValues();\n    var datesCount = 0;\n\n    for (var i = 0; i < this.actionObj.groupIndex; i++) {\n      datesCount = datesCount + this.verticalEvent.dateRender[i].length;\n    }\n\n    var target = this.parent.activeViewOptions.group.byDate && !isNullOrUndefined(this.parent.getDateFromElement(this.actionObj.target)) ? true : false;\n\n    if (target || !this.parent.activeViewOptions.group.byDate) {\n      var dayIndex = !this.parent.activeViewOptions.group.byDate ? this.actionObj.index - datesCount : this.parent.getIndexOfDate(this.verticalEvent.dateRender[this.actionObj.groupIndex], util.resetTime(this.parent.getDateFromElement(this.actionObj.target)));\n      var record = this.verticalEvent.isSpannedEvent(event, dayIndex, this.actionObj.groupIndex);\n      var eStart = record[this.verticalEvent.fields.startTime];\n      var eEnd = record[this.verticalEvent.fields.endTime];\n      var appHeight = this.parent.activeViewOptions.timeScale.enable ? this.verticalEvent.getHeight(eStart, eEnd) : this.actionObj.element.offsetHeight;\n      var topValue = this.parent.activeViewOptions.timeScale.enable ? this.verticalEvent.getTopValue(eStart, dayIndex, this.actionObj.groupIndex) : this.actionObj.element.offsetTop;\n      this.actionObj.clone.style.top = formatUnit(topValue);\n      this.actionObj.clone.style.height = formatUnit(appHeight);\n    }\n  };\n\n  DragAndDrop.prototype.updateAllDayEvents = function (startDate, endDate, colIndex) {\n    var _this = this;\n\n    this.parent.eventBase.slots = [];\n    var event = this.getUpdatedEvent(startDate, endDate, this.actionObj.event);\n    var renderDates = this.parent.activeView.renderDates;\n    this.parent.eventBase.slots.push(this.parent.activeView.renderDates.map(function (date) {\n      return +date;\n    }));\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.parent.eventBase.slots = [];\n      var resources = this.parent.resourceBase.lastResourceLevel.filter(function (res) {\n        return res.groupIndex === _this.actionObj.groupIndex;\n      });\n      renderDates = resources[0].renderDates;\n      this.parent.eventBase.slots.push(renderDates.map(function (date) {\n        return +date;\n      }));\n    }\n\n    var events = this.parent.eventBase.splitEvent(event, renderDates);\n    var query = '.e-all-day-cells[data-date=\"' + this.parent.getMsFromDate(events[0][this.parent.eventFields.startTime]) + '\"]';\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      query = query.concat('[data-group-index = \"' + this.actionObj.groupIndex + '\"]');\n    }\n\n    var cell = [].slice.call(this.parent.element.querySelectorAll(query));\n\n    if (cell.length > 0 || !isNullOrUndefined(colIndex)) {\n      var cellIndex = !isNullOrUndefined(colIndex) ? colIndex : cell[0].cellIndex;\n      this.appendCloneElement(this.getEventWrapper(cellIndex));\n      this.actionObj.clone.style.width = formatUnit(events[0].data.count * this.actionObj.cellWidth);\n    }\n  };\n\n  DragAndDrop.prototype.swapDragging = function (e) {\n    var colIndex = closest(this.actionObj.target, 'td').cellIndex;\n\n    if (closest(this.actionObj.target, '.' + cls.DATE_HEADER_WRAP_CLASS) && !closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS)) {\n      addClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      this.actionObj.isAllDay = true;\n      var eventHeight = this.getAllDayEventHeight();\n      var allDayElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n\n      if (allDayElement[0].offsetHeight < eventHeight) {\n        for (var _i = 0, allDayElement_1 = allDayElement; _i < allDayElement_1.length; _i++) {\n          var element = allDayElement_1[_i];\n          element.style.height = (eventHeight + 2) / 12 + 'em';\n        }\n      }\n\n      setStyleAttribute(this.actionObj.clone, {\n        width: formatUnit(this.actionObj.cellWidth),\n        height: formatUnit(eventHeight),\n        top: formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop)\n      });\n    }\n\n    if (closest(this.actionObj.target, '.' + cls.WORK_CELLS_CLASS) && !closest(this.actionObj.clone, '.' + cls.DAY_WRAPPER_CLASS)) {\n      removeClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      this.actionObj.isAllDay = false;\n      var height = this.actionObj.element.offsetHeight === 0 ? this.actionObj.height : this.actionObj.element.offsetHeight;\n      setStyleAttribute(this.actionObj.clone, {\n        left: formatUnit(0),\n        height: formatUnit(height),\n        width: formatUnit(this.actionObj.cellWidth)\n      });\n    }\n  };\n\n  DragAndDrop.prototype.calculateVerticalDate = function (e) {\n    if (isNullOrUndefined(e.target) || e.target && isNullOrUndefined(closest(e.target, 'tr')) || e.target && e.target.tagName === 'DIV') {\n      return;\n    }\n\n    this.removeCloneElement();\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var td = closest(this.actionObj.target, 'td');\n\n    if (!isNullOrUndefined(td)) {\n      var tr = td.parentElement;\n      this.actionObj.index = tr.rowIndex * tr.children.length + td.cellIndex;\n      var workCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n      td = workCells[this.actionObj.index];\n      var currentDate = this.parent.getDateFromElement(td);\n\n      if (!isNullOrUndefined(currentDate)) {\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n          this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n\n        var timeString = new Date(currentDate.setDate(currentDate.getDate() - this.daysVariation));\n        var dragStart = new Date(timeString.getTime());\n        var dragEnd = new Date(dragStart.getTime());\n        var startTimeDiff = eventObj[this.parent.eventFields.startTime].getTime() - util.resetTime(new Date(+eventObj[this.parent.eventFields.startTime])).getTime();\n        dragStart = new Date(dragStart.getTime() + startTimeDiff);\n        dragEnd = new Date(dragStart.getTime() + eventDuration);\n        this.actionObj.start = new Date(dragStart.getTime());\n        this.actionObj.end = new Date(dragEnd.getTime());\n      }\n    }\n\n    var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n\n    if (this.parent.currentView === 'TimelineYear') {\n      this.dynamicYearlyEventsRendering(event);\n    } else {\n      this.dynamicEventsRendering(event);\n    }\n  };\n\n  DragAndDrop.prototype.calculateTimelineTime = function (e) {\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var offsetLeft = this.parent.enableRtl ? Math.abs(this.actionObj.clone.offsetLeft) - this.actionObj.clone.offsetWidth : parseInt(this.actionObj.clone.style.left, 10);\n    offsetLeft = Math.floor(offsetLeft / this.actionObj.cellWidth) * this.actionObj.cellWidth;\n    var rightOffset;\n\n    if (this.parent.enableRtl) {\n      rightOffset = Math.abs(parseInt(this.actionObj.clone.style.right, 10));\n      this.actionObj.clone.style.right = formatUnit(rightOffset);\n    }\n\n    offsetLeft = this.getOffsetValue(offsetLeft, rightOffset);\n    var colIndex = this.getColumnIndex(offsetLeft);\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var leftVal = this.parent.eventDragArea ? dragArea.scrollLeft - dragArea.offsetLeft : 0;\n    var cloneIndex = Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().left + leftVal) / this.actionObj.cellWidth);\n\n    if (this.parent.enableRtl) {\n      cloneIndex = Math.abs(Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().right) / this.actionObj.cellWidth)) - 1;\n    }\n\n    if (this.cursorPointIndex < 0) {\n      this.cursorIndex(e, eventObj, offsetLeft, cloneIndex);\n    }\n\n    var tr = this.parent.getContentTable().querySelector('tr');\n    var index = this.getCursorCurrentIndex(colIndex, cloneIndex, tr);\n    index = index < 0 ? 0 : index;\n    var eventStart = this.isHeaderRows ? new Date(this.timelineEventModule.dateRender[index].getTime()) : this.parent.getDateFromElement(tr.children[index]);\n\n    if (this.isStepDragging) {\n      var widthDiff = this.getWidthDiff(tr, index);\n\n      if (widthDiff !== 0) {\n        var timeDiff = Math.round(widthDiff / this.widthPerMinute);\n        eventStart.setMinutes(eventStart.getMinutes() + timeDiff * this.actionObj.interval);\n        eventStart.setMinutes(eventStart.getMinutes() - this.minDiff);\n      } else {\n        eventStart = this.actionObj.start;\n      }\n    } else {\n      eventStart.setMinutes(eventStart.getMinutes() - this.cursorPointIndex * (this.isTimelineDayProcess ? MINUTES_PER_DAY : this.actionObj.slotInterval));\n    }\n\n    eventStart = this.calculateIntervalTime(eventStart);\n\n    if (this.isTimelineDayProcess) {\n      var eventSrt = eventObj[this.parent.eventFields.startTime];\n      eventStart.setHours(eventSrt.getHours(), eventSrt.getMinutes(), eventSrt.getSeconds());\n    }\n\n    var eventEnd = new Date(eventStart.getTime());\n    eventEnd.setMilliseconds(eventDuration);\n    var event = this.getUpdatedEvent(eventStart, eventEnd, this.actionObj.event);\n    var events = this.timelineEventModule.splitEvent(event, this.timelineEventModule.dateRender);\n    var eventData = events[0].data;\n    var startTime = this.timelineEventModule.getStartTime(events[0], eventData);\n    var endTime = this.timelineEventModule.getEndTime(events[0], eventData);\n    var width = this.timelineEventModule.getEventWidth(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], eventData.count);\n    var day = this.parent.getIndexOfDate(this.timelineEventModule.dateRender, util.resetTime(new Date(startTime.getTime())));\n    day = day < 0 ? 0 : day;\n    var left = this.timelineEventModule.getPosition(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], day);\n\n    if (this.parent.enableRtl) {\n      this.actionObj.clone.style.right = formatUnit(left);\n    } else {\n      this.actionObj.clone.style.left = formatUnit(left);\n    }\n\n    if (!this.isMorePopupOpened) {\n      this.actionObj.clone.style.width = formatUnit(width);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.calculateResourceGroupingPosition(e);\n    }\n\n    this.actionObj.start = new Date(eventStart.getTime());\n    this.actionObj.end = new Date(eventEnd.getTime());\n    this.updateTimePosition(this.actionObj.start);\n  };\n\n  DragAndDrop.prototype.getOffsetValue = function (offsetLeft, rightOffset) {\n    if (this.scrollEdges.left || this.scrollEdges.right) {\n      var viewEle = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n      if (this.parent.enableRtl) {\n        rightOffset = viewEle.offsetWidth - viewEle.scrollLeft;\n\n        if (this.scrollEdges.right) {\n          rightOffset = rightOffset - viewEle.offsetWidth + this.actionObj.clone.offsetWidth - (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n        } else {\n          rightOffset = rightOffset + this.widthUptoCursorPoint;\n\n          if (rightOffset - this.widthUptoCursorPoint >= viewEle.scrollWidth) {\n            this.actionObj.clone.style.width = formatUnit(this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint + this.actionObj.cellWidth);\n            rightOffset = viewEle.scrollLeft - viewEle.scrollWidth;\n          }\n        }\n\n        this.actionObj.clone.style.left = formatUnit(rightOffset);\n      } else {\n        if (this.scrollEdges.left) {\n          offsetLeft = viewEle.scrollLeft - this.widthUptoCursorPoint + this.actionObj.cellWidth;\n\n          if (viewEle.scrollLeft + viewEle.offsetWidth >= viewEle.offsetWidth) {\n            viewEle.scrollLeft = viewEle.scrollLeft - 1;\n          } else if (this.actionObj.clone.offsetLeft === 0) {\n            offsetLeft = viewEle.scrollLeft;\n          }\n        } else {\n          offsetLeft = viewEle.scrollLeft + viewEle.offsetWidth - this.actionObj.clone.offsetWidth + (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n        }\n\n        offsetLeft = offsetLeft < 0 ? 0 : offsetLeft;\n        this.actionObj.clone.style.left = formatUnit(offsetLeft);\n      }\n    }\n\n    return offsetLeft;\n  };\n\n  DragAndDrop.prototype.getWidthDiff = function (tr, index) {\n    var pages = this.scrollArgs.element.getBoundingClientRect();\n\n    if (pages.left <= this.actionObj.pageX && pages.right >= this.actionObj.pageX) {\n      var targetLeft = tr.children[index].offsetLeft;\n      var pageX = this.actionObj.pageX - pages.left;\n\n      if (this.parent.enableRtl) {\n        return targetLeft + this.actionObj.cellWidth - (this.scrollArgs.element.scrollLeft + pageX);\n      } else {\n        return this.scrollArgs.element.scrollLeft + pageX - targetLeft;\n      }\n    }\n\n    return 0;\n  };\n\n  DragAndDrop.prototype.getColumnIndex = function (offsetLeft) {\n    var index = Math.floor(offsetLeft / this.actionObj.cellWidth);\n\n    if (this.isHeaderRows) {\n      return index;\n    }\n\n    return this.getIndex(index);\n  };\n\n  DragAndDrop.prototype.getCursorCurrentIndex = function (colIndex, cloneIndex, tr) {\n    var index = colIndex + cloneIndex;\n\n    if (this.isHeaderRows) {\n      var dateLength = Math.floor(tr.offsetWidth / this.actionObj.cellWidth);\n      return index > dateLength - 1 ? dateLength - 1 : index;\n    }\n\n    return index > tr.children.length - 1 ? tr.children.length - 1 : index;\n  };\n\n  DragAndDrop.prototype.cursorIndex = function (e, event, left, index) {\n    var td = closest(e.target, '.e-work-cells');\n\n    if (!isNullOrUndefined(td) && !this.isMorePopupOpened) {\n      var targetDate = this.parent.getDateFromElement(td);\n\n      if (this.isHeaderRows) {\n        var currentIndex = Math.floor(left / this.actionObj.cellWidth);\n        targetDate = new Date(this.timelineEventModule.dateRender[currentIndex + index].getTime());\n      }\n\n      var timeDiff = targetDate.getTime() - event[this.parent.eventFields.startTime].getTime();\n\n      if (this.isTimelineDayProcess) {\n        this.cursorPointIndex = Math.abs(Math.ceil(timeDiff / util.MS_PER_DAY));\n      } else {\n        var widthDiff = Math.floor(timeDiff / util.MS_PER_MINUTE / (this.actionObj.slotInterval / this.actionObj.cellWidth));\n        this.cursorPointIndex = Math.floor(widthDiff / this.actionObj.cellWidth);\n        this.cursorPointIndex = this.cursorPointIndex < 0 ? 0 : this.cursorPointIndex;\n      }\n    } else {\n      this.cursorPointIndex = 0;\n    }\n  };\n\n  DragAndDrop.prototype.calculateResourceGroupingPosition = function (e) {\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var trCollection = [].slice.call(this.parent.element.querySelectorAll('.e-content-wrap .e-content-table tr:not(.e-hidden)'));\n    var translateY = util.getTranslateY(dragArea.querySelector('table'));\n    translateY = isNullOrUndefined(translateY) ? 0 : translateY;\n    var rowHeight = this.parent.rowAutoHeight ? ~~(dragArea.querySelector('table').offsetHeight / trCollection.length) : this.actionObj.cellHeight;\n    var rowIndex = Math.floor(Math.floor(this.actionObj.Y + (dragArea.scrollTop - translateY - window.scrollY) - dragArea.getBoundingClientRect().top) / rowHeight);\n    rowIndex = rowIndex < 0 ? 0 : rowIndex > trCollection.length - 1 ? trCollection.length - 1 : rowIndex;\n    this.actionObj.index = rowIndex;\n    var eventContainer = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(rowIndex);\n    var eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n    if (!eventWrapper) {\n      eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      eventContainer.appendChild(eventWrapper);\n    }\n\n    this.appendCloneElement(eventWrapper);\n    var td = closest(this.actionObj.target, 'td');\n    this.actionObj.groupIndex = td && !isNaN(parseInt(td.getAttribute('data-group-index'), 10)) ? parseInt(td.getAttribute('data-group-index'), 10) : this.actionObj.groupIndex;\n    var top = trCollection[rowIndex].offsetTop;\n\n    if (this.parent.rowAutoHeight) {\n      var cursorElement = this.getCursorElement(e);\n\n      if (cursorElement) {\n        top = cursorElement.classList.contains(cls.WORK_CELLS_CLASS) ? cursorElement.offsetTop : cursorElement.offsetParent.classList.contains(cls.APPOINTMENT_CLASS) ? cursorElement.offsetParent.offsetTop : top;\n      }\n    }\n\n    this.actionObj.clone.style.top = formatUnit(top);\n  };\n\n  DragAndDrop.prototype.appendCloneElement = function (element) {\n    if (this.parent.eventDragArea) {\n      document.querySelector(this.parent.eventDragArea).appendChild(this.actionObj.clone);\n    } else {\n      element.appendChild(this.actionObj.clone);\n    }\n  };\n\n  DragAndDrop.prototype.getEventWrapper = function (index) {\n    var eventWrapper;\n    var isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n\n    if (this.parent.activeViewOptions.timeScale.enable) {\n      var wrapperClass = isAllDayDrag ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n      eventWrapper = this.parent.element.querySelectorAll(wrapperClass).item(index);\n    } else {\n      var targetWrapper = this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS).item(index);\n      eventWrapper = targetWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n      if (!eventWrapper) {\n        eventWrapper = createElement('div', {\n          className: cls.APPOINTMENT_WRAPPER_CLASS\n        });\n        targetWrapper.appendChild(eventWrapper);\n      }\n    }\n\n    return eventWrapper;\n  };\n\n  DragAndDrop.prototype.getAllDayEventHeight = function () {\n    var eventWrapper = createElement('div', {\n      className: cls.APPOINTMENT_CLASS\n    });\n    this.parent.element.querySelector('.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS).appendChild(eventWrapper);\n    var eventHeight = eventWrapper.offsetHeight;\n    remove(eventWrapper);\n    return eventHeight;\n  };\n\n  DragAndDrop.prototype.isAllowDrop = function (e) {\n    if (!this.actionObj.excludeSelectors) {\n      return false;\n    }\n\n    var dropSelectors = this.actionObj.excludeSelectors.split(',');\n    var isAllowDrop = false;\n\n    for (var _i = 0, dropSelectors_1 = dropSelectors; _i < dropSelectors_1.length; _i++) {\n      var selector = dropSelectors_1[_i];\n\n      if (e.target.classList.contains(selector)) {\n        isAllowDrop = true;\n        break;\n      }\n    }\n\n    return isAllowDrop;\n  };\n  /**\n   * Get module name.\n   */\n\n\n  DragAndDrop.prototype.getModuleName = function () {\n    return 'dragAndDrop';\n  };\n\n  return DragAndDrop;\n}(ActionBase);\n\nexport { DragAndDrop };","map":{"version":3,"sources":["C:/Users/ilani/project/volunteers/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/drag.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","createElement","closest","Draggable","extend","formatUnit","isNullOrUndefined","addClass","remove","removeClass","setStyleAttribute","Browser","EventHandler","ActionBase","MonthEvent","TimelineEvent","YearEvent","VerticalEvent","cls","events","util","MINUTES_PER_DAY","DragAndDrop","_super","_this","apply","arguments","widthUptoCursorPoint","heightUptoCursorPoint","cursorPointIndex","isHeaderRows","isTimelineDayProcess","widthPerMinute","heightPerMinute","minDiff","isStepDragging","isMorePopupOpened","isAllDayDrag","wireDragEvent","element","dragObj","abort","EVENT_RESIZE_CLASS","clone","isDragScroll","enableTapHold","parent","isAdaptive","enableTailMode","eventDragArea","cursorAt","left","top","dragArea","document","querySelector","CONTENT_TABLE_CLASS","dragStart","bind","drag","dragStop","enableAutoScroll","helper","dragHelper","queryPositionInfo","dragPosition","isDevice","isTouch","initialize","e","setDragActionDefaultValues","actionObj","action","createCloneElement","currentView","timeScale","enable","activeView","isTimelineView","classList","contains","ALLDAY_APPOINTMENT_CLASS","cursor","right","width","style","offsetTop","cloneElement","originalElement","cellHeight","slotInterval","interval","leftValue","offsetLeft","topValue","offsetParent","MORE_EVENT_POPUP_CLASS","ALLDAY_ROW_CLASS","Math","ceil","offsetWidth","cellWidth","enableRtl","height","pointerEvents","top_1","parseInt","scrollHeight","cloneBottom","offsetHeight","isAllDay","activeViewOptions","slotCount","workCell","WORK_CELLS_CLASS","eventGuid","getAttribute","event","eventBase","getEventByGuid","eventObj","dragArgs","cancel","data","excludeSelectors","navigation","timeDelay","scroll","scrollBy","trigger","dragEventArgs","parentElement","ej2_instances","intDestroy","removeCloneElementClasses","removeCloneElement","actionClass","uiStateValues","start","eventFields","startTime","end","endTime","groupIndex","viewElement","CONTENT_WRAP_CLASS","scrollArgs","scrollWidth","daysVariation","rows","headerRows","length","option","timelineEventModule","yearEvent","updateOriginalElement","monthEvent","verticalEvent","quickPopup","quickPopupHide","target","DISABLE_DATES","eventArgs","getPageCoordinates","Y","pageY","X","pageX","abs","getBoundingClientRect","calculateMinutesDiff","date","getDateFromElement","currentDate","resetTime","startDate","Date","getTime","MS_PER_DAY","targetElement","currentTarget","ROOT","updateScrollPosition","updateNavigatingPosition","updateDraggingDateTime","group","resources","renderDates","startEndHours","getStartEndHours","getStartHour","getEndHour","startHour","MS_PER_MINUTE","clearInterval","navigationInterval","scrollInterval","isAllowDrop","cellTemplate","getChangedData","allowGroupEdit","rowAutoHeight","virtualScrollModule","byGroupID","crudModule","crudObj","isCrudAction","sourceEvent","resourceBase","lastResourceLevel","currentGroupIndex","targetEvent","saveChangedData","currentDate_1","getCurrentTime","window","setInterval","crtDate","getSeconds","viewNavigation","morePopupEventDragging","dateRender","getSlotDates","calculateTimelineTime","calculateVerticalDate","calculateVerticalTime","navigationWrapper","outerWrapperCls","slice","call","querySelectorAll","index","targetWrapper","APPOINTMENT_WRAPPER_CLASS","className","appendChild","wrapperClass","ALLDAY_APPOINTMENT_WRAPPER_CLASS","item","elementHeight","getAllDayEventHeight","event_2","ALLDAY_CELLS_CLASS","_i","event_1","outWrapper","APPOINTMENT_CONTAINER_CLASS","tarWrapper","navigationType","scrollEdges","bottom","scrollLeft","round","pageXOffset","clientWidth","changeDate","getNextPreviousDate","eventDuration","td","dragEnd","setMilliseconds","eventContainer","eventWrapper","rowIndex","appendCloneElement","swapDragging","eventStart","eventEnd","floor","scrollTop","pageYOffset","diffInMinutes","tr","trCollections","getContentTable","cellIndex","colIndex","children","getEventWrapper","setMinutes","getMinutes","setDate","getDate","setHours","getHours","addDays","updateAllDayEvents","byDate","undefined","getUpdatedEvent","updateEventHeight","updateTimePosition","initializeValues","datesCount","i","dayIndex","getIndexOfDate","record","isSpannedEvent","eStart","fields","eEnd","appHeight","getHeight","getTopValue","endDate","slots","push","map","filter","res","splitEvent","query","getMsFromDate","concat","cell","count","DATE_HEADER_WRAP_CLASS","eventHeight","allDayElement","allDayElement_1","DAY_WRAPPER_CLASS","tagName","workCells","timeString","startTimeDiff","dynamicYearlyEventsRendering","dynamicEventsRendering","rightOffset","getOffsetValue","getColumnIndex","leftVal","cloneIndex","cursorIndex","getCursorCurrentIndex","widthDiff","getWidthDiff","timeDiff","calculateIntervalTime","eventSrt","eventData","getStartTime","getEndTime","getEventWidth","day","getPosition","calculateResourceGroupingPosition","viewEle","pages","targetLeft","getIndex","dateLength","targetDate","currentIndex","trCollection","translateY","getTranslateY","rowHeight","scrollY","isNaN","cursorElement","getCursorElement","APPOINTMENT_CLASS","dropSelectors","split","dropSelectors_1","selector","getModuleName"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { createElement, closest, Draggable, extend, formatUnit, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { addClass, remove, removeClass, setStyleAttribute, Browser, EventHandler } from '@syncfusion/ej2-base';\nimport { ActionBase } from '../actions/action-base';\nimport { MonthEvent } from '../event-renderer/month';\nimport { TimelineEvent } from '../event-renderer/timeline-view';\nimport { YearEvent } from '../event-renderer/year';\nimport { VerticalEvent } from '../event-renderer/vertical-view';\nimport * as cls from '../base/css-constant';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\nvar MINUTES_PER_DAY = 1440;\n/**\n * Schedule events drag actions\n */\nvar DragAndDrop = /** @class */ (function (_super) {\n    __extends(DragAndDrop, _super);\n    function DragAndDrop() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.widthUptoCursorPoint = 0;\n        _this.heightUptoCursorPoint = 0;\n        _this.cursorPointIndex = 0;\n        _this.isHeaderRows = false;\n        _this.isTimelineDayProcess = false;\n        _this.widthPerMinute = 0;\n        _this.heightPerMinute = 0;\n        _this.minDiff = 0;\n        _this.isStepDragging = false;\n        _this.isMorePopupOpened = false;\n        _this.isAllDayDrag = false;\n        return _this;\n    }\n    DragAndDrop.prototype.wireDragEvent = function (element) {\n        var dragObj = new Draggable(element, {\n            abort: '.' + cls.EVENT_RESIZE_CLASS,\n            clone: true,\n            isDragScroll: true,\n            enableTapHold: this.parent.isAdaptive,\n            enableTailMode: (this.parent.eventDragArea) ? true : false,\n            cursorAt: (this.parent.eventDragArea) ? { left: -20, top: -20 } : { left: 0, top: 0 },\n            dragArea: (this.parent.eventDragArea) ?\n                document.querySelector(this.parent.eventDragArea) :\n                this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS),\n            dragStart: this.dragStart.bind(this),\n            drag: this.drag.bind(this),\n            dragStop: this.dragStop.bind(this),\n            enableAutoScroll: false,\n            helper: this.dragHelper.bind(this),\n            queryPositionInfo: this.dragPosition.bind(this)\n        });\n        if (!(dragObj.enableTapHold && Browser.isDevice && Browser.isTouch)) {\n            // tslint:disable-next-line:no-any\n            EventHandler.remove(element, 'touchstart', dragObj.initialize);\n        }\n    };\n    DragAndDrop.prototype.dragHelper = function (e) {\n        this.setDragActionDefaultValues();\n        this.actionObj.element = e.element;\n        this.actionObj.action = 'drag';\n        this.actionObj.clone = this.createCloneElement(this.actionObj.element);\n        if (!this.parent.eventDragArea && this.parent.currentView !== 'Month' &&\n            this.parent.timeScale.enable && !this.parent.activeView.isTimelineView() &&\n            !this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n            setStyleAttribute(this.actionObj.clone, { cursor: 'move', left: '0%', right: '0%', width: '100%' });\n        }\n        this.actionObj.clone.style.top = formatUnit(this.actionObj.element.offsetTop);\n        this.actionObj.cloneElement = [this.actionObj.clone];\n        this.actionObj.originalElement = [this.actionObj.element];\n        return this.actionObj.clone;\n    };\n    DragAndDrop.prototype.dragPosition = function (e) {\n        if (this.parent.eventDragArea) {\n            return { left: e.left, top: e.top };\n        }\n        var cellHeight = (this.actionObj.cellHeight / this.actionObj.slotInterval) * this.actionObj.interval;\n        var leftValue = formatUnit(0);\n        if (this.parent.currentView === 'Month') {\n            leftValue = e.left;\n        }\n        if (this.parent.activeView.isTimelineView()) {\n            leftValue = formatUnit(this.actionObj.clone.offsetLeft);\n        }\n        var topValue;\n        if ((this.parent.activeView.isTimelineView() || !this.parent.timeScale.enable ||\n            (!isNullOrUndefined(this.actionObj.clone.offsetParent) &&\n                this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)))) {\n            topValue = formatUnit(this.actionObj.clone.offsetTop);\n        }\n        else if (this.parent.currentView === 'Month') {\n            topValue = formatUnit(0);\n        }\n        else if (this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n            topValue = formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop);\n            setStyleAttribute(this.actionObj.clone, {\n                width: formatUnit(Math.ceil(this.actionObj.clone.offsetWidth / this.actionObj.cellWidth) * this.actionObj.cellWidth),\n                right: this.parent.enableRtl && formatUnit(0)\n            });\n        }\n        else {\n            if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) &&\n                !this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                setStyleAttribute(this.actionObj.clone, {\n                    height: formatUnit(this.actionObj.cellHeight),\n                    width: formatUnit(this.actionObj.cellWidth - 1),\n                    pointerEvents: 'none'\n                });\n            }\n            var top_1 = parseInt(e.top, 10);\n            top_1 = top_1 < 0 ? 0 : top_1;\n            topValue = formatUnit(Math.ceil(top_1 / cellHeight) * cellHeight);\n            var scrollHeight = this.parent.element.querySelector('.e-content-wrap').scrollHeight;\n            var cloneBottom = parseInt(topValue, 10) + this.actionObj.clone.offsetHeight;\n            if (cloneBottom > scrollHeight) {\n                topValue = (parseInt(topValue, 10) - (cloneBottom - scrollHeight)) + 'px';\n            }\n        }\n        return { left: leftValue, top: topValue };\n    };\n    DragAndDrop.prototype.setDragActionDefaultValues = function () {\n        this.actionObj.action = 'drag';\n        this.actionObj.isAllDay = null;\n        this.actionObj.slotInterval = this.parent.activeViewOptions.timeScale.interval / this.parent.activeViewOptions.timeScale.slotCount;\n        this.actionObj.interval = this.actionObj.slotInterval;\n        var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n        this.actionObj.cellWidth = workCell.offsetWidth;\n        this.actionObj.cellHeight = workCell.offsetHeight;\n    };\n    DragAndDrop.prototype.dragStart = function (e) {\n        var _this = this;\n        var eventGuid = this.actionObj.element.getAttribute('data-guid');\n        this.actionObj.event = this.parent.eventBase.getEventByGuid(eventGuid);\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var dragArgs = {\n            cancel: false,\n            data: eventObj,\n            event: e,\n            excludeSelectors: null,\n            element: this.actionObj.element,\n            interval: this.actionObj.interval,\n            navigation: { enable: false, timeDelay: 2000 },\n            scroll: { enable: true, scrollBy: 30, timeDelay: 100 }\n        };\n        this.parent.trigger(events.dragStart, dragArgs, function (dragEventArgs) {\n            if (dragEventArgs.cancel || (!isNullOrUndefined(_this.actionObj.element) &&\n                isNullOrUndefined(_this.actionObj.element.parentElement))) {\n                var dragObj = _this.actionObj.element.ej2_instances[0];\n                if (!isNullOrUndefined(dragObj)) {\n                    dragObj.intDestroy(e.event);\n                }\n                _this.actionObj.action = '';\n                _this.removeCloneElementClasses();\n                _this.removeCloneElement();\n                return;\n            }\n            _this.actionClass('addClass');\n            _this.parent.uiStateValues.action = true;\n            _this.actionObj.start = eventObj[_this.parent.eventFields.startTime];\n            _this.actionObj.end = eventObj[_this.parent.eventFields.endTime];\n            _this.actionObj.groupIndex = parseInt(_this.actionObj.element.getAttribute('data-group-index') || '0', 10);\n            _this.actionObj.interval = dragEventArgs.interval;\n            _this.actionObj.navigation = dragEventArgs.navigation;\n            _this.actionObj.scroll = dragEventArgs.scroll;\n            _this.actionObj.excludeSelectors = dragEventArgs.excludeSelectors;\n            var viewElement = _this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            _this.scrollArgs = { element: viewElement, width: viewElement.scrollWidth, height: viewElement.scrollHeight };\n            _this.widthPerMinute = (_this.actionObj.cellWidth / _this.actionObj.slotInterval) * _this.actionObj.interval;\n            _this.heightPerMinute = (_this.actionObj.cellHeight / _this.actionObj.slotInterval) * _this.actionObj.interval;\n            _this.widthUptoCursorPoint = 0;\n            _this.heightUptoCursorPoint = 0;\n            _this.cursorPointIndex = -1;\n            _this.isHeaderRows = false;\n            _this.isTimelineDayProcess = false;\n            _this.minDiff = 0;\n            _this.isMorePopupOpened = false;\n            _this.daysVariation = -1;\n            if ((_this.parent.activeView.isTimelineView() || !_this.parent.timeScale.enable) && _this.parent.currentView !== 'TimelineYear') {\n                if (!isNullOrUndefined(_this.actionObj.clone.offsetParent) &&\n                    _this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n                    _this.isMorePopupOpened = true;\n                }\n                var rows = _this.parent.activeViewOptions.headerRows;\n                _this.isHeaderRows = rows.length > 0 && rows[rows.length - 1].option !== 'Hour' &&\n                    rows[rows.length - 1].option !== 'Date';\n                _this.isTimelineDayProcess = !_this.parent.activeViewOptions.timeScale.enable || _this.isHeaderRows ||\n                    _this.parent.currentView === 'TimelineMonth' || (rows.length > 0 && rows[rows.length - 1].option === 'Date');\n                _this.isStepDragging = !_this.isTimelineDayProcess && (_this.actionObj.slotInterval !== _this.actionObj.interval);\n                if (_this.isTimelineDayProcess) {\n                    _this.timelineEventModule = new TimelineEvent(_this.parent, 'day');\n                }\n                else {\n                    _this.timelineEventModule = new TimelineEvent(_this.parent, 'hour');\n                }\n            }\n            if (_this.parent.currentView === 'TimelineYear') {\n                _this.yearEvent = new YearEvent(_this.parent);\n            }\n            if (_this.parent.currentView === 'Month') {\n                _this.updateOriginalElement(_this.actionObj.clone);\n                _this.monthEvent = new MonthEvent(_this.parent);\n            }\n            if (_this.parent.currentView === 'Day' || _this.parent.currentView === 'Week' || _this.parent.currentView === 'WorkWeek') {\n                _this.verticalEvent = new VerticalEvent(_this.parent);\n            }\n        });\n    };\n    DragAndDrop.prototype.drag = function (e) {\n        this.parent.quickPopup.quickPopupHide(true);\n        if ((!isNullOrUndefined(e.target)) && e.target.classList.contains(cls.DISABLE_DATES)) {\n            return;\n        }\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventArgs = this.getPageCoordinates(e);\n        this.actionObj.Y = this.actionObj.pageY = eventArgs.pageY;\n        this.actionObj.X = this.actionObj.pageX = eventArgs.pageX;\n        this.actionObj.target = e.target;\n        this.widthUptoCursorPoint = (this.widthUptoCursorPoint === 0) ?\n            Math.ceil((Math.abs(this.actionObj.clone.getBoundingClientRect().left - this.actionObj.X) / this.widthPerMinute)) *\n                this.widthPerMinute : this.widthUptoCursorPoint;\n        this.widthUptoCursorPoint = this.isMorePopupOpened ? this.actionObj.cellWidth : this.widthUptoCursorPoint;\n        this.heightUptoCursorPoint = (this.heightUptoCursorPoint === 0) ?\n            Math.ceil((Math.abs(this.actionObj.clone.getBoundingClientRect().top - this.actionObj.Y) / this.heightPerMinute)) *\n                this.heightPerMinute : this.heightUptoCursorPoint;\n        this.isAllDayDrag = (this.parent.activeViewOptions.timeScale.enable) ?\n            this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) :\n            this.actionObj.event[this.parent.eventFields.isAllDay];\n        if (this.isStepDragging && this.minDiff === 0) {\n            this.calculateMinutesDiff(eventObj);\n        }\n        if ((this.parent.currentView === 'Month' || this.isAllDayDrag) && this.daysVariation < 0) {\n            var date = this.parent.getDateFromElement(this.actionObj.target);\n            if (!isNullOrUndefined(date)) {\n                var currentDate = util.resetTime(date);\n                var startDate = util.resetTime(new Date(eventObj[this.parent.eventFields.startTime].getTime()));\n                this.daysVariation = (currentDate.getTime() - startDate.getTime()) / util.MS_PER_DAY;\n            }\n            else {\n                this.daysVariation = 0;\n            }\n        }\n        else {\n            this.daysVariation = 0;\n        }\n        if (this.parent.eventDragArea) {\n            var targetElement = eventArgs.target;\n            this.actionObj.clone.style.top = formatUnit(targetElement.offsetTop);\n            this.actionObj.clone.style.left = formatUnit(targetElement.offsetLeft);\n            var currentTarget = closest(targetElement, '.' + cls.ROOT);\n            if (!currentTarget) {\n                this.actionObj.clone.style.height = '';\n                this.actionObj.clone.style.width = '';\n            }\n            else {\n                if (!(this.parent.currentView === 'Week' || this.parent.currentView === 'WorkWeek'\n                    || this.parent.currentView === 'Day')) {\n                    this.actionObj.clone.style.width = formatUnit(this.actionObj.element.offsetWidth);\n                }\n            }\n        }\n        this.updateScrollPosition(e);\n        this.updateNavigatingPosition(e);\n        this.updateDraggingDateTime(e);\n        var dragArgs = {\n            data: eventObj, event: e, element: this.actionObj.element, startTime: this.actionObj.start,\n            endTime: this.actionObj.end\n        };\n        if (this.parent.group.resources.length > 0) {\n            dragArgs.groupIndex = this.actionObj.groupIndex;\n        }\n        this.parent.trigger(events.drag, dragArgs);\n    };\n    DragAndDrop.prototype.calculateMinutesDiff = function (eventObj) {\n        if (this.parent.enableRtl) {\n            this.minDiff =\n                ((this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint) / this.widthPerMinute) * this.actionObj.interval;\n        }\n        else {\n            this.minDiff = (this.widthUptoCursorPoint / this.widthPerMinute) * this.actionObj.interval;\n        }\n        var startDate = eventObj[this.parent.eventFields.startTime];\n        var startTime = this.parent.activeView.renderDates[0];\n        var startEndHours = util.getStartEndHours(startTime, this.parent.activeView.getStartHour(), this.parent.activeView.getEndHour());\n        if (startEndHours.startHour.getTime() > startDate.getTime()) {\n            this.minDiff = this.minDiff + ((startEndHours.startHour.getTime() - startDate.getTime()) / util.MS_PER_MINUTE);\n        }\n    };\n    DragAndDrop.prototype.dragStop = function (e) {\n        var _this = this;\n        this.removeCloneElementClasses();\n        this.removeCloneElement();\n        clearInterval(this.actionObj.navigationInterval);\n        this.actionObj.navigationInterval = null;\n        clearInterval(this.actionObj.scrollInterval);\n        this.actionObj.scrollInterval = null;\n        this.actionClass('removeClass');\n        this.parent.uiStateValues.action = false;\n        this.actionObj.action = null;\n        if (this.isAllowDrop(e)) {\n            return;\n        }\n        var target = ((!e.target.classList.contains('e-work-cells') && this.parent.cellTemplate) ?\n            closest(e.target, '.e-work-cells') : e.target);\n        var dragArgs = {\n            cancel: false, data: this.getChangedData(),\n            event: e, element: this.actionObj.element, target: target\n        };\n        this.parent.trigger(events.dragStop, dragArgs, function (dragEventArgs) {\n            if (dragEventArgs.cancel) {\n                return;\n            }\n            if (_this.parent.activeViewOptions.group.resources.length > 0 && !_this.parent.activeViewOptions.group.allowGroupEdit\n                && !_this.parent.rowAutoHeight && !_this.parent.virtualScrollModule && _this.parent.activeViewOptions.group.byGroupID) {\n                _this.parent.crudModule.crudObj.isCrudAction = true;\n                _this.parent.crudModule.crudObj.sourceEvent =\n                    [_this.parent.resourceBase.lastResourceLevel[parseInt(dragArgs.element.getAttribute('data-group-index'), 10)]];\n                var currentGroupIndex = parseInt(dragArgs.target.getAttribute('data-group-index'), 10) || _this.actionObj.groupIndex;\n                _this.parent.crudModule.crudObj.targetEvent = [_this.parent.resourceBase.lastResourceLevel[currentGroupIndex]];\n            }\n            _this.saveChangedData(dragEventArgs);\n        });\n    };\n    DragAndDrop.prototype.updateNavigatingPosition = function (e) {\n        var _this = this;\n        if (this.actionObj.navigation.enable) {\n            var currentDate_1 = this.parent.getCurrentTime();\n            if (isNullOrUndefined(this.actionObj.navigationInterval)) {\n                this.actionObj.navigationInterval = window.setInterval(function () {\n                    if (currentDate_1) {\n                        var crtDate = _this.parent.getCurrentTime();\n                        var end = crtDate.getSeconds();\n                        var start = currentDate_1.getSeconds() + (_this.actionObj.navigation.timeDelay / 1000);\n                        start = (start >= 60) ? start - 60 : start;\n                        if (start === end) {\n                            currentDate_1 = _this.parent.getCurrentTime();\n                            _this.viewNavigation(e);\n                            _this.updateDraggingDateTime(e);\n                        }\n                    }\n                }, this.actionObj.navigation.timeDelay);\n            }\n        }\n    };\n    DragAndDrop.prototype.updateDraggingDateTime = function (e) {\n        if (!isNullOrUndefined(this.actionObj.clone.offsetParent) &&\n            this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n            this.morePopupEventDragging(e);\n        }\n        else if (this.parent.activeView.isTimelineView() && this.parent.currentView !== 'TimelineYear') {\n            this.timelineEventModule.dateRender = this.parent.activeView.renderDates;\n            this.timelineEventModule.cellWidth = this.actionObj.cellWidth;\n            this.timelineEventModule.getSlotDates();\n            this.actionObj.cellWidth = this.isHeaderRows ? this.timelineEventModule.cellWidth : this.actionObj.cellWidth;\n            this.calculateTimelineTime(e);\n        }\n        else {\n            if (this.parent.currentView === 'Month' || this.parent.currentView === 'TimelineYear') {\n                this.calculateVerticalDate(e);\n            }\n            else {\n                this.calculateVerticalTime(e);\n            }\n        }\n    };\n    DragAndDrop.prototype.navigationWrapper = function () {\n        if (!this.parent.activeView.isTimelineView()) {\n            if (this.parent.currentView === 'Month' || !this.parent.timeScale.enable) {\n                var outerWrapperCls = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n                this.actionObj.index = (this.parent.activeView.renderDates.length < this.actionObj.index) ?\n                    this.parent.activeView.renderDates.length - 1 : this.actionObj.index;\n                var targetWrapper = outerWrapperCls[this.actionObj.index].querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n                if (!targetWrapper) {\n                    targetWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                    outerWrapperCls[this.actionObj.index].appendChild(targetWrapper);\n                }\n                targetWrapper.appendChild(this.actionObj.clone);\n            }\n            else {\n                var wrapperClass = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) ?\n                    '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n                this.parent.element.querySelectorAll(wrapperClass)\n                    .item(this.actionObj.index).appendChild(this.actionObj.clone);\n                if (wrapperClass === '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS) {\n                    var elementHeight = this.getAllDayEventHeight();\n                    var event_2 = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n                    if (event_2[0].offsetHeight < elementHeight) {\n                        for (var _i = 0, event_1 = event_2; _i < event_1.length; _i++) {\n                            var e = event_1[_i];\n                            e.style.height = ((elementHeight + 2) / 12) + 'em';\n                        }\n                    }\n                    this.actionObj.clone.style.height = formatUnit(elementHeight);\n                }\n                this.actionObj.height = parseInt(this.actionObj.clone.style.height, 0);\n            }\n        }\n        else {\n            var outWrapper = void 0;\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                outWrapper = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(this.actionObj.index);\n            }\n            else {\n                outWrapper = this.parent.element.querySelector('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n            }\n            var tarWrapper = outWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n            if (!tarWrapper) {\n                tarWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                outWrapper.appendChild(tarWrapper);\n            }\n            tarWrapper.appendChild(this.actionObj.clone);\n        }\n    };\n    DragAndDrop.prototype.viewNavigation = function (e) {\n        var navigationType;\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        if (dragArea && ((!this.scrollEdges.top && !this.scrollEdges.bottom) ||\n            closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS))) {\n            if ((dragArea.scrollLeft === 0) &&\n                (Math.round(this.actionObj.X) <=\n                    Math.round(dragArea.getBoundingClientRect().left + this.actionObj.cellWidth + window.pageXOffset))) {\n                navigationType = this.parent.enableRtl ? 'next' : 'previous';\n            }\n            else if ((Math.round(dragArea.scrollLeft) + dragArea.clientWidth === dragArea.scrollWidth) &&\n                (Math.round(this.actionObj.X) >=\n                    Math.round(dragArea.getBoundingClientRect().right - this.actionObj.cellWidth + window.pageXOffset))) {\n                navigationType = this.parent.enableRtl ? 'previous' : 'next';\n            }\n            if (navigationType) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate(navigationType));\n            }\n        }\n    };\n    DragAndDrop.prototype.morePopupEventDragging = function (e) {\n        if (isNullOrUndefined(e.target) || (e.target && isNullOrUndefined(closest(e.target, 'td')))) {\n            return;\n        }\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var td = closest(e.target, 'td');\n        if (this.parent.currentView === 'TimelineYear' && !td.classList.contains('e-work-cells')) {\n            return;\n        }\n        var dragStart = this.parent.getDateFromElement(td);\n        var dragEnd = new Date(dragStart.getTime());\n        dragEnd.setMilliseconds(eventDuration);\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n        this.actionObj.start = new Date(dragStart.getTime());\n        this.actionObj.end = new Date(dragEnd.getTime());\n        this.actionObj.clone.style.top = formatUnit(td.offsetParent.offsetTop);\n        this.actionObj.clone.style.left = formatUnit(td.offsetLeft);\n        this.actionObj.clone.style.width = formatUnit(td.offsetWidth);\n        var eventContainer = td;\n        var eventWrapper;\n        if (this.parent.activeView.isTimelineView()) {\n            var rowIndex = closest(td, 'tr').rowIndex;\n            eventContainer = this.parent.element.querySelectorAll('.e-appointment-container').item(rowIndex);\n        }\n        eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        if (!eventWrapper) {\n            eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            eventContainer.appendChild(eventWrapper);\n        }\n        this.appendCloneElement(eventWrapper);\n    };\n    DragAndDrop.prototype.calculateVerticalTime = function (e) {\n        if (isNullOrUndefined(this.actionObj.target) ||\n            (this.actionObj.target && isNullOrUndefined(closest(this.actionObj.target, 'tr'))) ||\n            (!(closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS)) &&\n                !(closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)))) {\n            return;\n        }\n        if (this.parent.activeViewOptions.timeScale.enable) {\n            this.swapDragging(e);\n        }\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventStart = eventObj[this.parent.eventFields.startTime];\n        var eventEnd = eventObj[this.parent.eventFields.endTime];\n        var eventDuration = eventEnd.getTime() - eventStart.getTime();\n        var offsetTop = Math.floor(parseInt(this.actionObj.clone.style.top, 10) / this.actionObj.cellHeight)\n            * this.actionObj.cellHeight;\n        offsetTop = offsetTop < 0 ? 0 : offsetTop;\n        if (this.scrollEdges.top || this.scrollEdges.bottom) {\n            offsetTop = this.scrollEdges.top ? dragArea.scrollTop - this.heightUptoCursorPoint +\n                this.actionObj.cellHeight + window.pageYOffset :\n                (dragArea.scrollTop + dragArea.offsetHeight - this.actionObj.clone.offsetHeight + window.pageYOffset) +\n                    (this.actionObj.clone.offsetHeight - this.heightUptoCursorPoint);\n            offsetTop = Math.round(offsetTop / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n            this.actionObj.clone.style.top = formatUnit(offsetTop);\n        }\n        var rowIndex = (this.parent.activeViewOptions.timeScale.enable) ? (offsetTop / this.actionObj.cellHeight) : 0;\n        var heightPerMinute = this.actionObj.cellHeight / this.actionObj.slotInterval;\n        var diffInMinutes = parseInt(this.actionObj.clone.style.top, 10) - offsetTop;\n        var tr;\n        if (this.isAllDayDrag) {\n            tr = this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS);\n        }\n        else {\n            var trCollections = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n            tr = trCollections[rowIndex];\n        }\n        var index;\n        if (closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) ||\n            closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            index = closest(this.actionObj.target, 'td').cellIndex;\n        }\n        var colIndex = isNullOrUndefined(index) ? closest(this.actionObj.clone, 'td').cellIndex : index;\n        this.actionObj.index = colIndex;\n        if (isNullOrUndefined(tr)) {\n            return;\n        }\n        var td = tr.children[colIndex];\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n        var dragStart;\n        var dragEnd;\n        if (this.parent.activeViewOptions.timeScale.enable && !this.isAllDayDrag) {\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            dragStart = this.parent.getDateFromElement(td);\n            dragStart.setMinutes(dragStart.getMinutes() + (diffInMinutes / heightPerMinute));\n            dragEnd = new Date(dragStart.getTime());\n            if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                dragEnd.setMinutes(dragEnd.getMinutes() + this.actionObj.slotInterval);\n            }\n            else {\n                dragEnd.setMilliseconds(eventDuration);\n            }\n        }\n        else {\n            dragStart = this.parent.getDateFromElement(td);\n            dragStart.setDate(dragStart.getDate() - this.daysVariation);\n            dragStart.setHours(eventStart.getHours(), eventStart.getMinutes(), eventStart.getSeconds());\n            dragEnd = new Date(dragStart.getTime());\n            dragEnd.setMilliseconds(eventDuration);\n            if (!this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) &&\n                this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                dragEnd = util.addDays(util.resetTime(dragEnd), 1);\n            }\n            this.updateAllDayEvents(dragStart, dragEnd, this.parent.activeViewOptions.group.byDate ? colIndex : undefined);\n        }\n        this.actionObj.start = new Date(+dragStart);\n        this.actionObj.end = new Date(+dragEnd);\n        var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n        this.updateEventHeight(event);\n        this.updateTimePosition(this.actionObj.start);\n    };\n    DragAndDrop.prototype.updateEventHeight = function (event) {\n        this.verticalEvent.initializeValues();\n        var datesCount = 0;\n        for (var i = 0; i < this.actionObj.groupIndex; i++) {\n            datesCount = datesCount + this.verticalEvent.dateRender[i].length;\n        }\n        var target = (this.parent.activeViewOptions.group.byDate &&\n            !isNullOrUndefined(this.parent.getDateFromElement(this.actionObj.target))) ? true : false;\n        if (target || !this.parent.activeViewOptions.group.byDate) {\n            var dayIndex = !this.parent.activeViewOptions.group.byDate ? this.actionObj.index - datesCount\n                : this.parent.getIndexOfDate(this.verticalEvent.dateRender[this.actionObj.groupIndex], util.resetTime(this.parent.getDateFromElement(this.actionObj.target)));\n            var record = this.verticalEvent.isSpannedEvent(event, dayIndex, this.actionObj.groupIndex);\n            var eStart = record[this.verticalEvent.fields.startTime];\n            var eEnd = record[this.verticalEvent.fields.endTime];\n            var appHeight = this.parent.activeViewOptions.timeScale.enable ? this.verticalEvent.getHeight(eStart, eEnd) :\n                this.actionObj.element.offsetHeight;\n            var topValue = this.parent.activeViewOptions.timeScale.enable ?\n                this.verticalEvent.getTopValue(eStart, dayIndex, this.actionObj.groupIndex) : this.actionObj.element.offsetTop;\n            this.actionObj.clone.style.top = formatUnit(topValue);\n            this.actionObj.clone.style.height = formatUnit(appHeight);\n        }\n    };\n    DragAndDrop.prototype.updateAllDayEvents = function (startDate, endDate, colIndex) {\n        var _this = this;\n        this.parent.eventBase.slots = [];\n        var event = this.getUpdatedEvent(startDate, endDate, this.actionObj.event);\n        var renderDates = this.parent.activeView.renderDates;\n        this.parent.eventBase.slots.push(this.parent.activeView.renderDates.map(function (date) { return +date; }));\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.parent.eventBase.slots = [];\n            var resources = this.parent.resourceBase.lastResourceLevel.\n                filter(function (res) { return res.groupIndex === _this.actionObj.groupIndex; });\n            renderDates = resources[0].renderDates;\n            this.parent.eventBase.slots.push(renderDates.map(function (date) { return +date; }));\n        }\n        var events = this.parent.eventBase.splitEvent(event, renderDates);\n        var query = '.e-all-day-cells[data-date=\"' +\n            this.parent.getMsFromDate(events[0][this.parent.eventFields.startTime]) + '\"]';\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            query = query.concat('[data-group-index = \"' + this.actionObj.groupIndex + '\"]');\n        }\n        var cell = [].slice.call(this.parent.element.querySelectorAll(query));\n        if (cell.length > 0 || !isNullOrUndefined(colIndex)) {\n            var cellIndex = !isNullOrUndefined(colIndex) ? colIndex : cell[0].cellIndex;\n            this.appendCloneElement(this.getEventWrapper(cellIndex));\n            this.actionObj.clone.style.width =\n                formatUnit(events[0].data.count * this.actionObj.cellWidth);\n        }\n    };\n    DragAndDrop.prototype.swapDragging = function (e) {\n        var colIndex = closest(this.actionObj.target, 'td').cellIndex;\n        if (closest(this.actionObj.target, '.' + cls.DATE_HEADER_WRAP_CLASS) &&\n            !closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS)) {\n            addClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            this.actionObj.isAllDay = true;\n            var eventHeight = this.getAllDayEventHeight();\n            var allDayElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n            if (allDayElement[0].offsetHeight < eventHeight) {\n                for (var _i = 0, allDayElement_1 = allDayElement; _i < allDayElement_1.length; _i++) {\n                    var element = allDayElement_1[_i];\n                    element.style.height = ((eventHeight + 2) / 12) + 'em';\n                }\n            }\n            setStyleAttribute(this.actionObj.clone, {\n                width: formatUnit(this.actionObj.cellWidth),\n                height: formatUnit(eventHeight),\n                top: formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop)\n            });\n        }\n        if (closest(this.actionObj.target, '.' + cls.WORK_CELLS_CLASS) &&\n            !closest(this.actionObj.clone, '.' + cls.DAY_WRAPPER_CLASS)) {\n            removeClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            this.actionObj.isAllDay = false;\n            var height = (this.actionObj.element.offsetHeight === 0) ? this.actionObj.height : this.actionObj.element.offsetHeight;\n            setStyleAttribute(this.actionObj.clone, {\n                left: formatUnit(0),\n                height: formatUnit(height),\n                width: formatUnit(this.actionObj.cellWidth)\n            });\n        }\n    };\n    DragAndDrop.prototype.calculateVerticalDate = function (e) {\n        if (isNullOrUndefined(e.target) || (e.target && isNullOrUndefined(closest(e.target, 'tr'))) ||\n            (e.target && e.target.tagName === 'DIV')) {\n            return;\n        }\n        this.removeCloneElement();\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var td = closest(this.actionObj.target, 'td');\n        if (!isNullOrUndefined(td)) {\n            var tr = td.parentElement;\n            this.actionObj.index = (tr.rowIndex * tr.children.length) + td.cellIndex;\n            var workCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n            td = workCells[this.actionObj.index];\n            var currentDate = this.parent.getDateFromElement(td);\n            if (!isNullOrUndefined(currentDate)) {\n                if (this.parent.activeViewOptions.group.resources.length > 0) {\n                    this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n                }\n                var timeString = new Date(currentDate.setDate(currentDate.getDate() - this.daysVariation));\n                var dragStart = new Date(timeString.getTime());\n                var dragEnd = new Date(dragStart.getTime());\n                var startTimeDiff = eventObj[this.parent.eventFields.startTime].getTime() -\n                    (util.resetTime(new Date(+eventObj[this.parent.eventFields.startTime]))).getTime();\n                dragStart = new Date(dragStart.getTime() + startTimeDiff);\n                dragEnd = new Date(dragStart.getTime() + eventDuration);\n                this.actionObj.start = new Date(dragStart.getTime());\n                this.actionObj.end = new Date(dragEnd.getTime());\n            }\n        }\n        var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n        if (this.parent.currentView === 'TimelineYear') {\n            this.dynamicYearlyEventsRendering(event);\n        }\n        else {\n            this.dynamicEventsRendering(event);\n        }\n    };\n    DragAndDrop.prototype.calculateTimelineTime = function (e) {\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var offsetLeft = this.parent.enableRtl ? Math.abs(this.actionObj.clone.offsetLeft) - this.actionObj.clone.offsetWidth :\n            parseInt(this.actionObj.clone.style.left, 10);\n        offsetLeft = Math.floor(offsetLeft / this.actionObj.cellWidth) * this.actionObj.cellWidth;\n        var rightOffset;\n        if (this.parent.enableRtl) {\n            rightOffset = Math.abs(parseInt(this.actionObj.clone.style.right, 10));\n            this.actionObj.clone.style.right = formatUnit(rightOffset);\n        }\n        offsetLeft = this.getOffsetValue(offsetLeft, rightOffset);\n        var colIndex = this.getColumnIndex(offsetLeft);\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var leftVal = (this.parent.eventDragArea) ? dragArea.scrollLeft - dragArea.offsetLeft : 0;\n        var cloneIndex = Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().left + leftVal) / this.actionObj.cellWidth);\n        if (this.parent.enableRtl) {\n            cloneIndex = Math.abs(Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().right) /\n                this.actionObj.cellWidth)) - 1;\n        }\n        if (this.cursorPointIndex < 0) {\n            this.cursorIndex(e, eventObj, offsetLeft, cloneIndex);\n        }\n        var tr = this.parent.getContentTable().querySelector('tr');\n        var index = this.getCursorCurrentIndex(colIndex, cloneIndex, tr);\n        index = index < 0 ? 0 : index;\n        var eventStart = this.isHeaderRows ? new Date(this.timelineEventModule.dateRender[index].getTime()) :\n            this.parent.getDateFromElement(tr.children[index]);\n        if (this.isStepDragging) {\n            var widthDiff = this.getWidthDiff(tr, index);\n            if (widthDiff !== 0) {\n                var timeDiff = Math.round(widthDiff / this.widthPerMinute);\n                eventStart.setMinutes(eventStart.getMinutes() + (timeDiff * this.actionObj.interval));\n                eventStart.setMinutes(eventStart.getMinutes() - this.minDiff);\n            }\n            else {\n                eventStart = this.actionObj.start;\n            }\n        }\n        else {\n            eventStart.setMinutes(eventStart.getMinutes() -\n                (this.cursorPointIndex * (this.isTimelineDayProcess ? MINUTES_PER_DAY : this.actionObj.slotInterval)));\n        }\n        eventStart = this.calculateIntervalTime(eventStart);\n        if (this.isTimelineDayProcess) {\n            var eventSrt = eventObj[this.parent.eventFields.startTime];\n            eventStart.setHours(eventSrt.getHours(), eventSrt.getMinutes(), eventSrt.getSeconds());\n        }\n        var eventEnd = new Date(eventStart.getTime());\n        eventEnd.setMilliseconds(eventDuration);\n        var event = this.getUpdatedEvent(eventStart, eventEnd, this.actionObj.event);\n        var events = this.timelineEventModule.splitEvent(event, this.timelineEventModule.dateRender);\n        var eventData = events[0].data;\n        var startTime = this.timelineEventModule.getStartTime(events[0], eventData);\n        var endTime = this.timelineEventModule.getEndTime(events[0], eventData);\n        var width = this.timelineEventModule.\n            getEventWidth(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], eventData.count);\n        var day = this.parent.getIndexOfDate(this.timelineEventModule.dateRender, util.resetTime(new Date(startTime.getTime())));\n        day = day < 0 ? 0 : day;\n        var left = this.timelineEventModule.getPosition(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], day);\n        if (this.parent.enableRtl) {\n            this.actionObj.clone.style.right = formatUnit(left);\n        }\n        else {\n            this.actionObj.clone.style.left = formatUnit(left);\n        }\n        if (!this.isMorePopupOpened) {\n            this.actionObj.clone.style.width = formatUnit(width);\n        }\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.calculateResourceGroupingPosition(e);\n        }\n        this.actionObj.start = new Date(eventStart.getTime());\n        this.actionObj.end = new Date(eventEnd.getTime());\n        this.updateTimePosition(this.actionObj.start);\n    };\n    DragAndDrop.prototype.getOffsetValue = function (offsetLeft, rightOffset) {\n        if (this.scrollEdges.left || this.scrollEdges.right) {\n            var viewEle = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            if (this.parent.enableRtl) {\n                rightOffset = viewEle.offsetWidth - viewEle.scrollLeft;\n                if (this.scrollEdges.right) {\n                    rightOffset = (rightOffset - viewEle.offsetWidth + this.actionObj.clone.offsetWidth) -\n                        (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n                }\n                else {\n                    rightOffset = rightOffset + this.widthUptoCursorPoint;\n                    if (rightOffset - this.widthUptoCursorPoint >= viewEle.scrollWidth) {\n                        this.actionObj.clone.style.width =\n                            formatUnit(this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint + this.actionObj.cellWidth);\n                        rightOffset = (viewEle.scrollLeft - viewEle.scrollWidth);\n                    }\n                }\n                this.actionObj.clone.style.left = formatUnit(rightOffset);\n            }\n            else {\n                if (this.scrollEdges.left) {\n                    offsetLeft = viewEle.scrollLeft - this.widthUptoCursorPoint + this.actionObj.cellWidth;\n                    if (viewEle.scrollLeft + viewEle.offsetWidth >= viewEle.offsetWidth) {\n                        viewEle.scrollLeft = viewEle.scrollLeft - 1;\n                    }\n                    else if (this.actionObj.clone.offsetLeft === 0) {\n                        offsetLeft = viewEle.scrollLeft;\n                    }\n                }\n                else {\n                    offsetLeft = (viewEle.scrollLeft + viewEle.offsetWidth -\n                        this.actionObj.clone.offsetWidth) + (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n                }\n                offsetLeft = offsetLeft < 0 ? 0 : offsetLeft;\n                this.actionObj.clone.style.left = formatUnit(offsetLeft);\n            }\n        }\n        return offsetLeft;\n    };\n    DragAndDrop.prototype.getWidthDiff = function (tr, index) {\n        var pages = this.scrollArgs.element.getBoundingClientRect();\n        if (pages.left <= this.actionObj.pageX && pages.right >= this.actionObj.pageX) {\n            var targetLeft = tr.children[index].offsetLeft;\n            var pageX = this.actionObj.pageX - pages.left;\n            if (this.parent.enableRtl) {\n                return (targetLeft + this.actionObj.cellWidth) - (this.scrollArgs.element.scrollLeft + pageX);\n            }\n            else {\n                return (this.scrollArgs.element.scrollLeft + pageX) - targetLeft;\n            }\n        }\n        return 0;\n    };\n    DragAndDrop.prototype.getColumnIndex = function (offsetLeft) {\n        var index = Math.floor(offsetLeft / this.actionObj.cellWidth);\n        if (this.isHeaderRows) {\n            return index;\n        }\n        return this.getIndex(index);\n    };\n    DragAndDrop.prototype.getCursorCurrentIndex = function (colIndex, cloneIndex, tr) {\n        var index = colIndex + cloneIndex;\n        if (this.isHeaderRows) {\n            var dateLength = Math.floor(tr.offsetWidth / this.actionObj.cellWidth);\n            return (index > dateLength - 1) ? dateLength - 1 : index;\n        }\n        return (index > tr.children.length - 1) ? tr.children.length - 1 : index;\n    };\n    DragAndDrop.prototype.cursorIndex = function (e, event, left, index) {\n        var td = closest(e.target, '.e-work-cells');\n        if (!isNullOrUndefined(td) && !this.isMorePopupOpened) {\n            var targetDate = this.parent.getDateFromElement(td);\n            if (this.isHeaderRows) {\n                var currentIndex = Math.floor(left / this.actionObj.cellWidth);\n                targetDate = new Date(this.timelineEventModule.dateRender[currentIndex + index].getTime());\n            }\n            var timeDiff = targetDate.getTime() - event[this.parent.eventFields.startTime].getTime();\n            if (this.isTimelineDayProcess) {\n                this.cursorPointIndex = Math.abs(Math.ceil(timeDiff / (util.MS_PER_DAY)));\n            }\n            else {\n                var widthDiff = Math.floor((timeDiff / util.MS_PER_MINUTE) / (this.actionObj.slotInterval / this.actionObj.cellWidth));\n                this.cursorPointIndex = Math.floor(widthDiff / this.actionObj.cellWidth);\n                this.cursorPointIndex = this.cursorPointIndex < 0 ? 0 : this.cursorPointIndex;\n            }\n        }\n        else {\n            this.cursorPointIndex = 0;\n        }\n    };\n    DragAndDrop.prototype.calculateResourceGroupingPosition = function (e) {\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var trCollection = [].slice.call(this.parent.element.querySelectorAll('.e-content-wrap .e-content-table tr:not(.e-hidden)'));\n        var translateY = util.getTranslateY(dragArea.querySelector('table'));\n        translateY = (isNullOrUndefined(translateY)) ? 0 : translateY;\n        var rowHeight = (this.parent.rowAutoHeight) ?\n            ~~(dragArea.querySelector('table').offsetHeight / trCollection.length) : this.actionObj.cellHeight;\n        var rowIndex = Math.floor(Math.floor((this.actionObj.Y + (dragArea.scrollTop - translateY - window.scrollY)) -\n            dragArea.getBoundingClientRect().top) / rowHeight);\n        rowIndex = (rowIndex < 0) ? 0 : (rowIndex > trCollection.length - 1) ? trCollection.length - 1 : rowIndex;\n        this.actionObj.index = rowIndex;\n        var eventContainer = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(rowIndex);\n        var eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        if (!eventWrapper) {\n            eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            eventContainer.appendChild(eventWrapper);\n        }\n        this.appendCloneElement(eventWrapper);\n        var td = closest(this.actionObj.target, 'td');\n        this.actionObj.groupIndex = (td && !isNaN(parseInt(td.getAttribute('data-group-index'), 10)))\n            ? parseInt(td.getAttribute('data-group-index'), 10) : this.actionObj.groupIndex;\n        var top = trCollection[rowIndex].offsetTop;\n        if (this.parent.rowAutoHeight) {\n            var cursorElement = this.getCursorElement(e);\n            if (cursorElement) {\n                top = cursorElement.classList.contains(cls.WORK_CELLS_CLASS) ? cursorElement.offsetTop :\n                    cursorElement.offsetParent.classList.contains(cls.APPOINTMENT_CLASS) ?\n                        cursorElement.offsetParent.offsetTop : top;\n            }\n        }\n        this.actionObj.clone.style.top = formatUnit(top);\n    };\n    DragAndDrop.prototype.appendCloneElement = function (element) {\n        if (this.parent.eventDragArea) {\n            document.querySelector(this.parent.eventDragArea).appendChild(this.actionObj.clone);\n        }\n        else {\n            element.appendChild(this.actionObj.clone);\n        }\n    };\n    DragAndDrop.prototype.getEventWrapper = function (index) {\n        var eventWrapper;\n        var isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n        if (this.parent.activeViewOptions.timeScale.enable) {\n            var wrapperClass = isAllDayDrag ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n            eventWrapper = this.parent.element.querySelectorAll(wrapperClass).item(index);\n        }\n        else {\n            var targetWrapper = this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS).item(index);\n            eventWrapper = targetWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n            if (!eventWrapper) {\n                eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                targetWrapper.appendChild(eventWrapper);\n            }\n        }\n        return eventWrapper;\n    };\n    DragAndDrop.prototype.getAllDayEventHeight = function () {\n        var eventWrapper = createElement('div', { className: cls.APPOINTMENT_CLASS });\n        this.parent.element.querySelector('.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS).appendChild(eventWrapper);\n        var eventHeight = eventWrapper.offsetHeight;\n        remove(eventWrapper);\n        return eventHeight;\n    };\n    DragAndDrop.prototype.isAllowDrop = function (e) {\n        if (!this.actionObj.excludeSelectors) {\n            return false;\n        }\n        var dropSelectors = this.actionObj.excludeSelectors.split(',');\n        var isAllowDrop = false;\n        for (var _i = 0, dropSelectors_1 = dropSelectors; _i < dropSelectors_1.length; _i++) {\n            var selector = dropSelectors_1[_i];\n            if (e.target.classList.contains(selector)) {\n                isAllowDrop = true;\n                break;\n            }\n        }\n        return isAllowDrop;\n    };\n    /**\n     * Get module name.\n     */\n    DragAndDrop.prototype.getModuleName = function () {\n        return 'dragAndDrop';\n    };\n    return DragAndDrop;\n}(ActionBase));\nexport { DragAndDrop };\n"]},"metadata":{},"sourceType":"module"}