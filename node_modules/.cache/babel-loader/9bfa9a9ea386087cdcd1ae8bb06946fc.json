{"ast":null,"code":"import RRule, { DEFAULT_OPTIONS } from './rrule';\nimport { includes, isPresent, isArray, isNumber, toArray } from './helpers';\nimport { Weekday } from './weekday';\nimport dateutil from './dateutil';\nimport { DateWithZone } from './datewithzone';\nexport function optionsToString(options) {\n  var rrule = [];\n  var dtstart = '';\n  var keys = Object.keys(options);\n  var defaultKeys = Object.keys(DEFAULT_OPTIONS);\n\n  for (var i = 0; i < keys.length; i++) {\n    if (keys[i] === 'tzid') continue;\n    if (!includes(defaultKeys, keys[i])) continue;\n    var key = keys[i].toUpperCase();\n    var value = options[keys[i]];\n    var outValue = '';\n    if (!isPresent(value) || isArray(value) && !value.length) continue;\n\n    switch (key) {\n      case 'FREQ':\n        outValue = RRule.FREQUENCIES[options.freq];\n        break;\n\n      case 'WKST':\n        if (isNumber(value)) {\n          outValue = new Weekday(value).toString();\n        } else {\n          outValue = value.toString();\n        }\n\n        break;\n\n      case 'BYWEEKDAY':\n        /*\r\n        NOTE: BYWEEKDAY is a special case.\r\n        RRule() deconstructs the rule.options.byweekday array\r\n        into an array of Weekday arguments.\r\n        On the other hand, rule.origOptions is an array of Weekdays.\r\n        We need to handle both cases here.\r\n        It might be worth change RRule to keep the Weekdays.\r\n                Also, BYWEEKDAY (used by RRule) vs. BYDAY (RFC)\r\n                */\n        key = 'BYDAY';\n        outValue = toArray(value).map(function (wday) {\n          if (wday instanceof Weekday) {\n            return wday;\n          }\n\n          if (isArray(wday)) {\n            return new Weekday(wday[0], wday[1]);\n          }\n\n          return new Weekday(wday);\n        }).toString();\n        break;\n\n      case 'DTSTART':\n        dtstart = buildDtstart(value, options.tzid);\n        break;\n\n      case 'UNTIL':\n        outValue = dateutil.timeToUntilString(value, !options.tzid);\n        break;\n\n      default:\n        if (isArray(value)) {\n          var strValues = [];\n\n          for (var j = 0; j < value.length; j++) {\n            strValues[j] = String(value[j]);\n          }\n\n          outValue = strValues.toString();\n        } else {\n          outValue = String(value);\n        }\n\n    }\n\n    if (outValue) {\n      rrule.push([key, outValue]);\n    }\n  }\n\n  var rules = rrule.map(function (_a) {\n    var key = _a[0],\n        value = _a[1];\n    return key + \"=\" + value.toString();\n  }).join(';');\n  var ruleString = '';\n\n  if (rules !== '') {\n    ruleString = \"RRULE:\" + rules;\n  }\n\n  return [dtstart, ruleString].filter(function (x) {\n    return !!x;\n  }).join('\\n');\n}\n\nfunction buildDtstart(dtstart, tzid) {\n  if (!dtstart) {\n    return '';\n  }\n\n  return 'DTSTART' + new DateWithZone(new Date(dtstart), tzid).toString();\n}","map":{"version":3,"sources":["../../../src/optionstostring.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import RRule, { DEFAULT_OPTIONS } from './rrule';\r\nimport { includes, isPresent, isArray, isNumber, toArray } from './helpers';\r\nimport { Weekday } from './weekday';\r\nimport dateutil from './dateutil';\r\nimport { DateWithZone } from './datewithzone';\r\nexport function optionsToString(options) {\r\n    var rrule = [];\r\n    var dtstart = '';\r\n    var keys = Object.keys(options);\r\n    var defaultKeys = Object.keys(DEFAULT_OPTIONS);\r\n    for (var i = 0; i < keys.length; i++) {\r\n        if (keys[i] === 'tzid')\r\n            continue;\r\n        if (!includes(defaultKeys, keys[i]))\r\n            continue;\r\n        var key = keys[i].toUpperCase();\r\n        var value = options[keys[i]];\r\n        var outValue = '';\r\n        if (!isPresent(value) || (isArray(value) && !value.length))\r\n            continue;\r\n        switch (key) {\r\n            case 'FREQ':\r\n                outValue = RRule.FREQUENCIES[options.freq];\r\n                break;\r\n            case 'WKST':\r\n                if (isNumber(value)) {\r\n                    outValue = new Weekday(value).toString();\r\n                }\r\n                else {\r\n                    outValue = value.toString();\r\n                }\r\n                break;\r\n            case 'BYWEEKDAY':\r\n                /*\r\n                NOTE: BYWEEKDAY is a special case.\r\n                RRule() deconstructs the rule.options.byweekday array\r\n                into an array of Weekday arguments.\r\n                On the other hand, rule.origOptions is an array of Weekdays.\r\n                We need to handle both cases here.\r\n                It might be worth change RRule to keep the Weekdays.\r\n      \r\n                Also, BYWEEKDAY (used by RRule) vs. BYDAY (RFC)\r\n      \r\n                */\r\n                key = 'BYDAY';\r\n                outValue = toArray(value).map(function (wday) {\r\n                    if (wday instanceof Weekday) {\r\n                        return wday;\r\n                    }\r\n                    if (isArray(wday)) {\r\n                        return new Weekday(wday[0], wday[1]);\r\n                    }\r\n                    return new Weekday(wday);\r\n                }).toString();\r\n                break;\r\n            case 'DTSTART':\r\n                dtstart = buildDtstart(value, options.tzid);\r\n                break;\r\n            case 'UNTIL':\r\n                outValue = dateutil.timeToUntilString(value, !options.tzid);\r\n                break;\r\n            default:\r\n                if (isArray(value)) {\r\n                    var strValues = [];\r\n                    for (var j = 0; j < value.length; j++) {\r\n                        strValues[j] = String(value[j]);\r\n                    }\r\n                    outValue = strValues.toString();\r\n                }\r\n                else {\r\n                    outValue = String(value);\r\n                }\r\n        }\r\n        if (outValue) {\r\n            rrule.push([key, outValue]);\r\n        }\r\n    }\r\n    var rules = rrule.map(function (_a) {\r\n        var key = _a[0], value = _a[1];\r\n        return key + \"=\" + value.toString();\r\n    }).join(';');\r\n    var ruleString = '';\r\n    if (rules !== '') {\r\n        ruleString = \"RRULE:\" + rules;\r\n    }\r\n    return [dtstart, ruleString].filter(function (x) { return !!x; }).join('\\n');\r\n}\r\nfunction buildDtstart(dtstart, tzid) {\r\n    if (!dtstart) {\r\n        return '';\r\n    }\r\n    return 'DTSTART' + new DateWithZone(new Date(dtstart), tzid).toString();\r\n}\r\n//# sourceMappingURL=optionstostring.js.map"]},"metadata":{},"sourceType":"module"}