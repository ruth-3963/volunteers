{"ast":null,"code":"import { isNullOrUndefined, closest, extend, EventHandler } from '@syncfusion/ej2-base';\nimport { createElement, prepend, append, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\nimport { generate, getDateFromRecurrenceDateString } from '../../recurrence-editor/date-generator';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n/**\r\n * EventBase for appointment rendering\r\n */\n\nvar EventBase =\n/** @class */\nfunction () {\n  /**\r\n   * Constructor for EventBase\r\n   */\n  function EventBase(parent) {\n    this.slots = [];\n    this.isDoubleTapped = false;\n    this.parent = parent;\n  }\n\n  EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\n    var _this = this;\n\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var fields = this.parent.eventFields;\n    var processed = [];\n    var temp = 1;\n    var generateID = false;\n    var resourceCollection = this.parent.resourceBase ? this.parent.resourceBase.resourceCollection : [];\n\n    if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\n      generateID = true;\n    }\n\n    var _loop_1 = function (event_1) {\n      if (generateID) {\n        event_1[fields.id] = temp++;\n      }\n\n      if (typeof event_1[fields.startTime] === 'string') {\n        event_1[fields.startTime] = util.getDateFromString(event_1[fields.startTime]);\n      }\n\n      if (typeof event_1[fields.endTime] === 'string') {\n        event_1[fields.endTime] = util.getDateFromString(event_1[fields.endTime]);\n      }\n\n      if (timeZonePropChanged) {\n        this_1.processTimezoneChange(event_1, oldTimezone);\n      } else {\n        event_1 = this_1.processTimezone(event_1);\n      }\n\n      for (var level = 0; level < resourceCollection.length; level++) {\n        if (event_1[resourceCollection[level].field] === null || event_1[resourceCollection[level].field] === 0) {\n          event_1[resourceCollection[level].field] = undefined;\n        }\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && event_1[fields.recurrenceRule] === '') {\n        event_1[fields.recurrenceRule] = null;\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID]) && !(this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction)) {\n        processed = processed.concat(this_1.generateOccurrence(event_1, null, oldTimezone, true));\n      } else {\n        if (this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction) {\n          var recEvent = void 0;\n          var app = void 0;\n\n          if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\n            recEvent = this_1.generateOccurrence(event_1, null, oldTimezone, true);\n\n            for (var k = 0; k < recEvent.length; k++) {\n              event_1 = recEvent[k];\n              app = this_1.parent.eventsProcessed.filter(function (data) {\n                return data[_this.parent.eventFields.startTime].getTime() - event_1[_this.parent.eventFields.startTime].getTime() === 0 && data[_this.parent.eventFields.id] === event_1[_this.parent.eventFields.id];\n              });\n              event_1.Guid = app.length > 0 ? app[0].Guid : this_1.generateGuid();\n              processed.push(event_1);\n            }\n          } else {\n            app = this_1.parent.eventsProcessed.filter(function (data) {\n              return data[_this.parent.eventFields.id] === event_1[_this.parent.eventFields.id];\n            });\n            event_1.Guid = app.length > 0 ? app[0].Guid : this_1.generateGuid();\n            processed.push(event_1);\n          }\n        } else {\n          event_1.Guid = this_1.generateGuid();\n          processed.push(event_1);\n        }\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n\n      _loop_1(event_1);\n    }\n\n    this.parent.eventsProcessed = [];\n    var eventData = processed.filter(function (data) {\n      return !data[_this.parent.eventFields.isBlock];\n    });\n    this.parent.eventsProcessed = this.filterEvents(start, end, eventData);\n    var blockData = processed.filter(function (data) {\n      return data[_this.parent.eventFields.isBlock];\n    });\n\n    for (var i = 0, len = blockData.length; i < len; i++) {\n      var eventObj = blockData[i];\n\n      if (eventObj[fields.isAllDay]) {\n        eventObj[fields.startTime] = util.resetTime(eventObj[fields.startTime]);\n        eventObj[fields.endTime] = util.addDays(util.resetTime(eventObj[fields.endTime]), 1);\n      }\n    }\n\n    this.parent.blockProcessed = blockData;\n    return eventData;\n  };\n\n  EventBase.prototype.getProcessedEvents = function (eventCollection) {\n    if (eventCollection === void 0) {\n      eventCollection = this.parent.eventsData;\n    }\n\n    var processed = [];\n\n    for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\n      var event_2 = _a[_i];\n\n      if (!isNullOrUndefined(event_2[this.parent.eventFields.recurrenceRule]) && isNullOrUndefined(event_2[this.parent.eventFields.recurrenceID])) {\n        processed = processed.concat(this.generateOccurrence(event_2));\n      } else {\n        processed.push(event_2);\n      }\n    }\n\n    return processed;\n  };\n\n  EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\n    var data = this.parent.eventsData.concat(this.parent.blockData);\n    var processed = this.processData(data, true, oldTimezone);\n    this.parent.notify(event.dataReady, {\n      processedData: processed\n    });\n  };\n  /** @private */\n\n\n  EventBase.prototype.timezoneConvert = function (eventData) {\n    var fields = this.parent.eventFields;\n    eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\n    eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\n\n    if (this.parent.timezone) {\n      var startTz = eventData[fields.startTimezone];\n      var endTz = eventData[fields.endTimezone];\n      eventData[fields.startTime] = this.parent.tzModule.convert(eventData[fields.startTime], this.parent.timezone, startTz);\n      eventData[fields.endTime] = this.parent.tzModule.convert(eventData[fields.endTime], this.parent.timezone, endTz);\n    }\n  };\n\n  EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\n    var fields = this.parent.eventFields;\n\n    if (event[fields.isAllDay]) {\n      return;\n    }\n\n    if (oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\n      event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\n    } else if (!oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n      event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n    } else if (oldTimezone && !this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], oldTimezone);\n      event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], oldTimezone);\n    }\n  };\n\n  EventBase.prototype.processTimezone = function (event, isReverse) {\n    if (isReverse === void 0) {\n      isReverse = false;\n    }\n\n    var fields = this.parent.eventFields;\n\n    if (event[fields.startTimezone] || event[fields.endTimezone]) {\n      var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\n      var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\n\n      if (isReverse) {\n        if (this.parent.timezone) {\n          event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\n          event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\n          event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n          event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n        } else {\n          event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], startTimezone);\n          event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], endTimezone);\n        }\n      } else {\n        event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], startTimezone);\n        event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], endTimezone);\n\n        if (this.parent.timezone) {\n          event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\n          event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\n        }\n      }\n    } else if (this.parent.timezone) {\n      if (isReverse) {\n        event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n        event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n      } else {\n        event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n        event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n      }\n    }\n\n    return event;\n  };\n\n  EventBase.prototype.filterBlockEvents = function (eventObj) {\n    var eStart = eventObj[this.parent.eventFields.startTime];\n    var eEnd = eventObj[this.parent.eventFields.endTime];\n    var resourceData;\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      var data = this.getGroupIndexFromEvent(eventObj);\n      resourceData = this.parent.resourceBase.lastResourceLevel[data];\n    }\n\n    return this.filterEvents(eStart, eEnd, this.parent.blockProcessed, resourceData);\n  };\n\n  EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var fieldMapping = this.parent.eventFields;\n    var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\n    var filter = new DataManager({\n      json: appointments\n    }).executeLocal(new Query().where(predicate));\n\n    if (resourceTdData) {\n      filter = this.filterEventsByResource(resourceTdData, filter);\n    }\n\n    return this.sortByTime(filter);\n  };\n\n  EventBase.prototype.filterEventsByRange = function (eventCollection, startDate, endDate) {\n    var _this = this;\n\n    var filteredEvents = [];\n\n    if (startDate && endDate) {\n      filteredEvents = this.filterEvents(startDate, endDate, eventCollection);\n    } else if (startDate && !endDate) {\n      filteredEvents = eventCollection.filter(function (e) {\n        return e[_this.parent.eventFields.startTime] >= startDate;\n      });\n    } else if (!startDate && endDate) {\n      filteredEvents = eventCollection.filter(function (e) {\n        return e[_this.parent.eventFields.endTime] <= endDate;\n      });\n    } else {\n      filteredEvents = eventCollection;\n    }\n\n    return this.sortByTime(filteredEvents);\n  };\n\n  EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var predicate = {};\n    var resourceCollection = this.parent.resourceBase.resourceCollection;\n\n    for (var level = 0; level < resourceCollection.length; level++) {\n      predicate[resourceCollection[level].field] = resourceTdData.groupOrder[level];\n    }\n\n    var keys = Object.keys(predicate);\n    var filteredCollection = appointments.filter(function (eventObj) {\n      return keys.every(function (key) {\n        if (eventObj[key] instanceof Array) {\n          return eventObj[key].indexOf(predicate[key]) > -1;\n        } else {\n          return eventObj[key] === predicate[key];\n        }\n      });\n    });\n    return filteredCollection;\n  };\n\n  EventBase.prototype.sortByTime = function (appointments) {\n    var fieldMapping = this.parent.eventFields;\n    appointments.sort(function (a, b) {\n      var d1 = a[fieldMapping.startTime];\n      var d2 = b[fieldMapping.startTime];\n      return d1.getTime() - d2.getTime();\n    });\n    return appointments;\n  };\n\n  EventBase.prototype.sortByDateTime = function (appointments) {\n    var fieldMapping = this.parent.eventFields;\n    appointments.sort(function (object1, object2) {\n      var d3 = object1[fieldMapping.startTime];\n      var d4 = object2[fieldMapping.startTime];\n      var d5 = object1[fieldMapping.endTime];\n      var d6 = object2[fieldMapping.endTime];\n      var d1 = d5.getTime() - d3.getTime();\n      var d2 = d6.getTime() - d4.getTime();\n      return d3.getTime() - d4.getTime() || d2 - d1;\n    });\n    return appointments;\n  };\n\n  EventBase.prototype.getSmallestMissingNumber = function (array) {\n    var large = Math.max.apply(Math, array);\n\n    for (var i = 0; i < large; i++) {\n      if (array.indexOf(i) === -1) {\n        return i;\n      }\n    }\n\n    return large + 1;\n  };\n\n  EventBase.prototype.splitEventByDay = function (event) {\n    var eventFields = this.parent.eventFields;\n    var data = [];\n    var eventStartTime = event[eventFields.startTime];\n    var eventEndTime = event[eventFields.endTime];\n    var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) < util.resetTime(new Date(eventEndTime.getTime()));\n\n    if (isDifferentDate) {\n      var start = new Date(eventStartTime.getTime());\n      var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\n      var endDate = eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0 ? eventEndTime : util.addDays(eventEndTime, 1);\n      var index = 1;\n      var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\n\n      while (end <= eventEndTime && start.getTime() !== end.getTime()) {\n        var app = extend({}, event);\n        app[eventFields.startTime] = start;\n        app[eventFields.endTime] = end;\n        app.data = {\n          index: index,\n          count: eventLength\n        };\n        app.Guid = this.generateGuid();\n        app.isSpanned = true;\n        data.push(app);\n        start = end;\n\n        if (util.resetTime(new Date(start.getTime())).getTime() === util.resetTime(new Date(eventEndTime.getTime())).getTime() && !(end.getTime() === eventEndTime.getTime())) {\n          end = new Date(start.getTime());\n          end = new Date(end.setHours(eventEndTime.getHours(), eventEndTime.getMinutes(), eventEndTime.getSeconds()));\n        } else {\n          end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\n        }\n\n        index++;\n      }\n    } else {\n      data.push(event);\n    }\n\n    return data;\n  };\n\n  EventBase.prototype.splitEvent = function (event, dateRender) {\n    var fields = this.parent.eventFields;\n    var start = util.resetTime(new Date(event[fields.startTime] + '')).getTime();\n    var end = util.resetTime(new Date(event[fields.endTime] + '')).getTime();\n\n    if (util.getDateInMs(event[fields.endTime]) <= 0) {\n      var temp = util.addDays(util.resetTime(new Date(event[fields.endTime] + '')), -1).getTime();\n      end = start > temp ? start : temp;\n    }\n\n    var orgStart = start;\n    var orgEnd = end;\n    var ranges = [];\n\n    if (start !== end) {\n      if (start < dateRender[0].getTime()) {\n        start = dateRender[0].getTime();\n      }\n\n      if (end > dateRender[dateRender.length - 1].getTime()) {\n        end = dateRender[dateRender.length - 1].getTime();\n      }\n\n      var cStart = start;\n\n      for (var level = 0; level < this.slots.length; level++) {\n        var slot = this.slots[level];\n\n        if (this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'TimelineWorkWeek' || this.parent.activeViewOptions.group.byDate || this.parent.activeViewOptions.showWeekend) {\n          var slotDates = [];\n\n          for (var _i = 0, slot_1 = slot; _i < slot_1.length; _i++) {\n            var s = slot_1[_i];\n            slotDates.push(new Date(s));\n          }\n\n          var renderedDates = this.getRenderedDates(slotDates);\n\n          if (!isNullOrUndefined(renderedDates) && renderedDates.length > 0) {\n            slot = [];\n\n            for (var _a = 0, renderedDates_1 = renderedDates; _a < renderedDates_1.length; _a++) {\n              var date = renderedDates_1[_a];\n              slot.push(date.getTime());\n            }\n          }\n        }\n\n        var firstSlot = slot[0];\n        cStart = cStart <= firstSlot && end >= firstSlot ? firstSlot : cStart;\n\n        if (cStart > end || firstSlot > end) {\n          break;\n        }\n\n        if (!this.parent.activeViewOptions.group.byDate && this.parent.activeViewOptions.showWeekend && this.parent.currentView !== 'WorkWeek' && this.parent.currentView !== 'TimelineWorkWeek') {\n          var startIndex = slot.indexOf(cStart);\n\n          if (startIndex !== -1) {\n            var endIndex = slot.indexOf(end);\n            var hasBreak = endIndex !== -1;\n            endIndex = hasBreak ? endIndex : slot.length - 1;\n            var count = endIndex - startIndex + 1;\n            var isLeft = slot[startIndex] !== orgStart;\n            var isRight = slot[endIndex] !== orgEnd;\n            ranges.push(this.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\n\n            if (hasBreak) {\n              break;\n            }\n          }\n        } else {\n          if (this.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\n            var availSlot = [];\n\n            for (var i = 0; i < slot.length; i++) {\n              if (this.dateInRange(slot[i], orgStart, orgEnd)) {\n                availSlot.push(slot[i]);\n              }\n            }\n\n            if (availSlot.length > 0) {\n              if (!this.parent.activeViewOptions.group.byDate) {\n                var isLeft = availSlot[0] !== orgStart;\n                var isRight = availSlot[availSlot.length - 1] !== orgEnd;\n                ranges.push(this.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\n              } else {\n                for (var _b = 0, availSlot_1 = availSlot; _b < availSlot_1.length; _b++) {\n                  var slot_2 = availSlot_1[_b];\n                  ranges.push(this.cloneEventObject(event, slot_2, slot_2, 1, slot_2 !== orgStart, slot_2 !== orgEnd));\n                }\n              }\n            }\n          }\n        }\n      }\n    } else {\n      ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\n    }\n\n    return ranges;\n  };\n\n  EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\n    var fields = this.parent.eventFields;\n    var e = extend({}, event, null, true);\n    var data = {\n      count: count,\n      isLeft: isLeft,\n      isRight: isRight\n    };\n    data[fields.startTime] = event[fields.startTime];\n    data[fields.endTime] = event[fields.endTime];\n    e.data = data;\n    e[fields.startTime] = new Date(start);\n    e[fields.endTime] = new Date(end);\n    return e;\n  };\n\n  EventBase.prototype.dateInRange = function (date, start, end) {\n    return start <= date && date <= end;\n  };\n\n  EventBase.prototype.getSelectedEventElements = function (target) {\n    this.removeSelectedAppointmentClass();\n\n    if (this.parent.selectedElements.length <= 0) {\n      this.parent.selectedElements.push(target);\n    } else {\n      var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\n        return element.getAttribute('data-guid') === target.getAttribute('data-guid');\n      });\n\n      if (isAlreadySelected.length <= 0) {\n        var elementSelector = 'div[data-guid=\"' + target.getAttribute('data-guid') + '\"]';\n        var focusElements = [].slice.call(this.parent.element.querySelectorAll(elementSelector));\n\n        for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\n          var element = focusElements_1[_i];\n          this.parent.selectedElements.push(element);\n        }\n      } else {\n        var selectedElements = this.parent.selectedElements.filter(function (element) {\n          return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\n        });\n        this.parent.selectedElements = selectedElements;\n      }\n    }\n\n    if (target && this.parent.selectedElements.length > 0) {\n      this.addSelectedAppointments(this.parent.selectedElements);\n    }\n\n    return this.parent.selectedElements;\n  };\n\n  EventBase.prototype.getSelectedEvents = function () {\n    var _this = this;\n\n    var eventSelect = [];\n    var elementSelect = [];\n    var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n    selectAppointments.filter(function (element) {\n      var isAlreadyAdded = eventSelect.filter(function (event) {\n        return event.Guid === element.getAttribute('data-guid');\n      });\n\n      if (isAlreadyAdded.length === 0) {\n        eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\n      }\n\n      elementSelect.push(element);\n    });\n    return {\n      event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\n      element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\n    };\n  };\n\n  EventBase.prototype.removeSelectedAppointmentClass = function () {\n    var selectedAppointments = this.getSelectedAppointments();\n\n    for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\n      var appointment = selectedAppointments_1[_i];\n      appointment.setAttribute('aria-selected', 'false');\n    }\n\n    removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\n    }\n  };\n\n  EventBase.prototype.addSelectedAppointments = function (cells) {\n    for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n      var cell = cells_1[_i];\n      cell.setAttribute('aria-selected', 'true');\n    }\n\n    if (this.parent.currentView !== 'MonthAgenda') {\n      this.parent.removeSelectedClass();\n    }\n\n    addClass(cells, cls.APPOINTMENT_BORDER);\n  };\n\n  EventBase.prototype.getSelectedAppointments = function () {\n    return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\n  };\n\n  EventBase.prototype.focusElement = function () {\n    if (this.parent.eventWindow.dialogObject && this.parent.eventWindow.dialogObject.visible) {\n      return;\n    }\n\n    var selectedCell = this.parent.getSelectedElements();\n\n    if (selectedCell.length > 0) {\n      if (this.parent.keyboardInteractionModule) {\n        var target = !isNullOrUndefined(this.parent.activeCellsData) && this.parent.activeCellsData.element || selectedCell[selectedCell.length - 1];\n        this.parent.keyboardInteractionModule.selectCells(target instanceof Array, target);\n      }\n\n      return;\n    }\n\n    var selectedAppointments = this.getSelectedAppointments();\n\n    if (selectedAppointments.length > 0) {\n      selectedAppointments[selectedAppointments.length - 1].focus();\n      return;\n    }\n  };\n\n  EventBase.prototype.selectWorkCellByTime = function (eventsData) {\n    var target;\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      return target;\n    }\n\n    if (eventsData.length > 0) {\n      var selectedObject = eventsData[eventsData.length - 1];\n      var eventStartTime = selectedObject[this.parent.eventFields.startTime];\n      var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\n      var isAllDay = this.isAllDayAppointment(selectedObject);\n\n      if (this.parent.currentView === 'Month' || isAllDay) {\n        nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\n      }\n\n      var targetArea = void 0;\n\n      if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\n        targetArea = this.parent.getAllDayRow();\n      } else {\n        targetArea = this.parent.getContentTable();\n      }\n\n      var queryString = '[data-date=\"' + this.parent.getMsFromDate(new Date(nearestTime)) + '\"]';\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\n      }\n\n      target = targetArea.querySelector(queryString);\n\n      if (target) {\n        this.parent.activeCellsData = this.parent.getCellDetails(target);\n\n        if (this.parent.keyboardInteractionModule) {\n          this.parent.keyboardInteractionModule.selectCells(false, target);\n        }\n\n        return target;\n      }\n    }\n\n    return target;\n  };\n\n  EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\n    var levelIndex;\n    var resource;\n    var levelName;\n    var idField;\n\n    for (var i = this.parent.resourceBase.resourceCollection.length - 1; i >= 0; i--) {\n      var resourceData = eventData[this.parent.resourceBase.resourceCollection[i].field];\n\n      if (!isNullOrUndefined(resourceData)) {\n        resource = this.parent.resourceBase.resourceCollection[i];\n        levelIndex = i;\n        levelName = resource.name;\n        idField = resource.field;\n        break;\n      }\n    }\n\n    if (isNullOrUndefined(levelName) && isNullOrUndefined(levelIndex)) {\n      levelName = this.parent.resourceCollection.slice(-1)[0].name;\n      levelIndex = this.parent.resourceCollection.length - 1;\n      idField = this.parent.resourceCollection.slice(-1)[0].field;\n      resource = this.parent.resourceCollection.filter(function (e, index) {\n        if (e.name === levelName) {\n          levelIndex = index;\n          return e;\n        }\n\n        return null;\n      })[0];\n    }\n\n    var id = eventData[idField] instanceof Array ? eventData[idField][0] : eventData[idField];\n\n    if (levelIndex > 0) {\n      var parentField = this.parent.resourceCollection[levelIndex - 1].field;\n      return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource, eventData, parentField);\n    } else {\n      return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource);\n    }\n  };\n\n  EventBase.prototype.isAllDayAppointment = function (event) {\n    var fieldMapping = this.parent.eventFields;\n    var isAllDay = event[fieldMapping.isAllDay];\n    var isFullDay = (event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime()) / util.MS_PER_DAY >= 1;\n    return isAllDay || isFullDay ? true : false;\n  };\n\n  EventBase.prototype.addEventListener = function () {\n    this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\n  };\n\n  EventBase.prototype.appointmentBorderRemove = function (event) {\n    var element = event.event.target;\n\n    if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\n      if (this.parent.currentView !== 'MonthAgenda') {\n        this.parent.removeSelectedClass();\n      }\n    } else if (!closest(element, '.' + cls.POPUP_OPEN)) {\n      this.removeSelectedAppointmentClass();\n    }\n  };\n\n  EventBase.prototype.wireAppointmentEvents = function (element, event, isPreventCrud) {\n    if (isPreventCrud === void 0) {\n      isPreventCrud = false;\n    }\n\n    var isReadOnly = !isNullOrUndefined(event) ? event[this.parent.eventFields.isReadonly] : false;\n    EventHandler.add(element, 'click', this.eventClick, this);\n\n    if (!this.parent.isAdaptive) {\n      EventHandler.add(element, 'touchstart', this.eventTouchClick, this);\n    }\n\n    if (!this.parent.isAdaptive && !this.parent.activeViewOptions.readonly && !isReadOnly) {\n      EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\n    }\n\n    if (!this.parent.activeViewOptions.readonly && !isReadOnly && !isPreventCrud) {\n      if (this.parent.resizeModule) {\n        this.parent.resizeModule.wireResizeEvent(element);\n      }\n\n      if (this.parent.dragAndDropModule) {\n        this.parent.dragAndDropModule.wireDragEvent(element);\n      }\n    }\n  };\n\n  EventBase.prototype.eventTouchClick = function (e) {\n    var _this = this;\n\n    setTimeout(function () {\n      return _this.isDoubleTapped = false;\n    }, 250);\n    e.preventDefault();\n\n    if (this.isDoubleTapped) {\n      this.eventDoubleClick(e);\n    } else if (!this.isDoubleTapped) {\n      this.isDoubleTapped = true;\n      this.eventClick(e);\n    }\n  };\n\n  EventBase.prototype.renderResizeHandler = function (element, spanEvent, isReadOnly) {\n    if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly || isReadOnly) {\n      return;\n    }\n\n    for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\n      var resizeEdge = _a[_i];\n      var resizeHandler = createElement('div', {\n        className: cls.EVENT_RESIZE_CLASS\n      });\n\n      switch (resizeEdge) {\n        case 'isLeft':\n          if (!spanEvent.isLeft) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isRight':\n          if (!spanEvent.isRight) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isTop':\n          if (!spanEvent.isTop) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isBottom':\n          if (!spanEvent.isBottom) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n      }\n    }\n  };\n\n  EventBase.prototype.eventClick = function (eventData) {\n    var _this = this;\n\n    var target = eventData.target;\n\n    if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS)) {\n      return;\n    }\n\n    if (eventData.ctrlKey && eventData.which === 1 && this.parent.keyboardInteractionModule) {\n      this.parent.quickPopup.quickPopup.hide();\n      this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n      var target_1 = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n      this.getSelectedEventElements(target_1);\n      this.activeEventData(eventData, false);\n      var selectArgs = {\n        data: this.parent.activeEventData.event,\n        element: this.parent.activeEventData.element,\n        event: eventData,\n        requestType: 'eventSelect'\n      };\n      this.parent.trigger(event.select, selectArgs);\n      var args = extend(this.parent.activeEventData, {\n        cancel: false,\n        originalEvent: eventData\n      });\n      this.parent.trigger(event.eventClick, args);\n    } else {\n      this.removeSelectedAppointmentClass();\n      this.activeEventData(eventData, true);\n      var selectEventArgs = {\n        data: this.parent.activeEventData.event,\n        element: this.parent.activeEventData.element,\n        event: eventData,\n        requestType: 'eventSelect'\n      };\n      this.parent.trigger(event.select, selectEventArgs);\n      var args = extend(this.parent.activeEventData, {\n        cancel: false,\n        originalEvent: eventData\n      });\n      this.parent.trigger(event.eventClick, args, function (eventClickArgs) {\n        if (eventClickArgs.cancel) {\n          _this.removeSelectedAppointmentClass();\n\n          if (_this.parent.quickPopup) {\n            _this.parent.quickPopup.quickPopupHide();\n          }\n        } else {\n          if (_this.parent.currentView === 'Agenda' || _this.parent.currentView === 'MonthAgenda') {\n            addClass([_this.parent.activeEventData.element], cls.AGENDA_SELECTED_CELL);\n          }\n\n          if (_this.parent.allowInline) {\n            var inlineArgs = {\n              data: eventClickArgs.event,\n              element: eventClickArgs.element,\n              type: 'Event'\n            };\n\n            _this.parent.notify(event.inlineClick, inlineArgs);\n          } else {\n            _this.parent.notify(event.eventClick, eventClickArgs);\n          }\n        }\n      });\n    }\n  };\n\n  EventBase.prototype.eventDoubleClick = function (e) {\n    this.parent.quickPopup.quickPopupHide(true);\n\n    if (e.type === 'touchstart') {\n      this.activeEventData(e, true);\n    }\n\n    this.removeSelectedAppointmentClass();\n\n    if (this.parent.activeEventData.element.classList.contains(cls.INLINE_APPOINTMENT_CLASS) || this.parent.activeEventData.element.querySelector('.' + cls.INLINE_SUBJECT_CLASS)) {\n      return;\n    }\n\n    if (!isNullOrUndefined(this.parent.activeEventData.event) && isNullOrUndefined(this.parent.activeEventData.event[this.parent.eventFields.recurrenceID])) {\n      this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\n    } else {\n      this.parent.currentAction = 'EditOccurrence';\n      this.parent.quickPopup.openRecurrenceAlert();\n    }\n  };\n\n  EventBase.prototype.getEventByGuid = function (guid) {\n    return this.parent.eventsProcessed.filter(function (data) {\n      return data.Guid === guid;\n    })[0];\n  };\n\n  EventBase.prototype.getEventById = function (id) {\n    var _this = this;\n\n    return this.parent.eventsData.filter(function (data) {\n      return data[_this.parent.eventFields.id] === id;\n    })[0];\n  };\n\n  EventBase.prototype.generateGuid = function () {\n    return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0;\n      var v = c === 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  };\n\n  EventBase.prototype.getEventIDType = function () {\n    if (this.parent.eventsData.length !== 0) {\n      return typeof this.parent.eventsData[0][this.parent.eventFields.id];\n    }\n\n    if (this.parent.blockData.length !== 0) {\n      return typeof this.parent.blockData[0][this.parent.eventFields.id];\n    }\n\n    return 'string';\n  };\n\n  EventBase.prototype.getEventMaxID = function (resourceId) {\n    var _this = this;\n\n    if (this.parent.eventsData.length < 1 && this.parent.blockData.length < 1) {\n      return 1;\n    }\n\n    var eventId;\n    var idType = this.getEventIDType();\n\n    if (idType === 'string') {\n      eventId = this.generateGuid();\n    }\n\n    if (idType === 'number') {\n      var datas = this.parent.eventsData.concat(this.parent.blockData);\n      var maxId = Math.max.apply(Math, datas.map(function (event) {\n        return event[_this.parent.eventFields.id];\n      }));\n      maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\n      eventId = maxId + 1;\n    }\n\n    return eventId;\n  };\n\n  EventBase.prototype.activeEventData = function (eventData, isMultiple) {\n    var _this = this;\n\n    var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n    var guid = target.getAttribute('data-guid');\n\n    if (isMultiple) {\n      this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\n      target.focus();\n    }\n\n    var eventObject = this.getEventByGuid(guid);\n\n    if (eventObject && eventObject.isSpanned) {\n      eventObject = this.parent.eventsData.filter(function (obj) {\n        return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\n      })[0];\n    }\n\n    this.parent.activeEventData = {\n      event: eventObject,\n      element: target\n    };\n  };\n\n  EventBase.prototype.generateOccurrence = function (event, viewDate, oldTimezone, isMaxCount) {\n    var startDate = event[this.parent.eventFields.startTime];\n    var endDate = event[this.parent.eventFields.endTime];\n    var eventRule = event[this.parent.eventFields.recurrenceRule];\n    var duration = endDate.getTime() - startDate.getTime();\n    viewDate = new Date((viewDate || this.parent.activeView.startDate()).getTime() - duration);\n    var exception = event[this.parent.eventFields.recurrenceException];\n    var maxCount;\n\n    if (this.parent.currentView !== 'Agenda' && isMaxCount) {\n      maxCount = util.getDateCount(this.parent.activeView.startDate(), this.parent.activeView.endDate()) + 1;\n    }\n\n    var newTimezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n    var firstDay = this.parent.activeViewOptions.firstDayOfWeek;\n    var calendarMode = this.parent.calendarMode;\n    var dates = generate(startDate, eventRule, exception, firstDay, maxCount, viewDate, calendarMode, oldTimezone, newTimezone);\n\n    if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\n      if (isNullOrUndefined(event.generatedDates)) {\n        event.generatedDates = {\n          start: new Date(dates[0]),\n          end: new Date(dates[dates.length - 1])\n        };\n      } else {\n        if (dates[0] < event.generatedDates.start.getTime()) {\n          event.generatedDates.start = new Date(dates[0]);\n        }\n\n        if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\n          event.generatedDates.end = new Date(dates[dates.length - 1]);\n        }\n      }\n    }\n\n    var occurrenceCollection = [];\n\n    for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n      var date = dates_1[_i];\n      var clonedObject = extend({}, event, null, true);\n      clonedObject[this.parent.eventFields.startTime] = new Date(date);\n      clonedObject[this.parent.eventFields.endTime] = new Date(new Date(date).setMilliseconds(duration));\n      clonedObject[this.parent.eventFields.recurrenceID] = clonedObject[this.parent.eventFields.id];\n      delete clonedObject[this.parent.eventFields.recurrenceException];\n      delete clonedObject[this.parent.eventFields.followingID];\n      clonedObject.Guid = this.generateGuid();\n      occurrenceCollection.push(clonedObject);\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getParentEvent = function (eventObj, isParent) {\n    if (isParent === void 0) {\n      isParent = false;\n    }\n\n    var parentEvent;\n\n    do {\n      eventObj = this.getFollowingEvent(eventObj);\n\n      if (eventObj) {\n        parentEvent = extend({}, eventObj, null, true);\n      }\n    } while (eventObj && isParent);\n\n    if (isParent && parentEvent) {\n      var collection = this.getEventCollections(parentEvent);\n      var followObj = collection.follow.slice(-1)[0];\n\n      if (collection.occurrence.length > 0 && !parentEvent[this.parent.eventFields.recurrenceException]) {\n        followObj = collection.occurrence.slice(-1)[0];\n      }\n\n      if (followObj) {\n        parentEvent[this.parent.eventFields.recurrenceRule] = followObj[this.parent.eventFields.recurrenceRule];\n      }\n    }\n\n    return parentEvent;\n  };\n\n  EventBase.prototype.getEventCollections = function (parentObj, childObj) {\n    var followingCollection = [];\n    var occurrenceCollection = [];\n    var followingEvent = parentObj;\n\n    do {\n      followingEvent = this.getFollowingEvent(followingEvent, true);\n\n      if (followingEvent) {\n        followingCollection.push(followingEvent);\n      }\n\n      occurrenceCollection = occurrenceCollection.concat(this.getOccurrenceEvent(followingEvent || parentObj));\n    } while (followingEvent);\n\n    var collections = {};\n\n    if (childObj) {\n      var fields_1 = this.parent.eventFields;\n      collections = {\n        follow: followingCollection.filter(function (eventData) {\n          return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n        }),\n        occurrence: occurrenceCollection.filter(function (eventData) {\n          return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n        })\n      };\n    } else {\n      collections = {\n        follow: followingCollection,\n        occurrence: occurrenceCollection\n      };\n    }\n\n    return collections;\n  };\n\n  EventBase.prototype.getFollowingEvent = function (parentObj, isReverse) {\n    var fields = this.parent.eventFields;\n    var fieldValue;\n\n    if (isReverse) {\n      fieldValue = parentObj[fields.id];\n    } else {\n      fieldValue = parentObj[fields.recurrenceID] || parentObj[fields.followingID];\n    }\n\n    var parentApp = this.parent.eventsData.filter(function (data) {\n      return data[isReverse ? fields.followingID : fields.id] === fieldValue;\n    });\n    return parentApp.shift();\n  };\n\n  EventBase.prototype.isFollowingEvent = function (parentObj, childObj) {\n    var parentStart = parentObj[this.parent.eventFields.startTime];\n    var childStart = childObj[this.parent.eventFields.startTime];\n    return parentStart.getHours() === childStart.getHours() && parentStart.getMinutes() === childStart.getMinutes() && parentStart.getSeconds() === childStart.getSeconds();\n  };\n\n  EventBase.prototype.getOccurrenceEvent = function (eventObj, isGuid, isFollowing) {\n    if (isGuid === void 0) {\n      isGuid = false;\n    }\n\n    if (isFollowing === void 0) {\n      isFollowing = false;\n    }\n\n    var idField = isGuid ? 'Guid' : isFollowing ? this.parent.eventFields.followingID : this.parent.eventFields.recurrenceID;\n    var fieldKey = isGuid ? 'Guid' : this.parent.eventFields.id;\n    var dataSource = isGuid ? this.parent.eventsProcessed : this.parent.eventsData;\n    return dataSource.filter(function (data) {\n      return data[idField] === eventObj[fieldKey];\n    });\n  };\n\n  EventBase.prototype.getOccurrencesByID = function (id) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n    var parentObject = this.parent.eventsData.filter(function (obj) {\n      return obj[fields.id] === id;\n    });\n\n    for (var _i = 0, _a = parentObject; _i < _a.length; _i++) {\n      var event_3 = _a[_i];\n\n      if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\n      }\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n\n    for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\n      var event_4 = _a[_i];\n\n      if (!isNullOrUndefined(event_4[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_4));\n      }\n    }\n\n    var filter = occurrenceCollection.filter(function (obj) {\n      return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\n    });\n    return filter;\n  };\n\n  EventBase.prototype.getDeletedOccurrences = function (recurrenceData) {\n    var fields = this.parent.eventFields;\n    var parentObject;\n    var deletedOccurrences = [];\n\n    if (typeof recurrenceData === 'string' || typeof recurrenceData === 'number') {\n      parentObject = this.parent.eventsData.filter(function (obj) {\n        return obj[fields.id] === recurrenceData;\n      })[0];\n    } else {\n      parentObject = extend({}, recurrenceData, null, true);\n    }\n\n    if (parentObject[fields.recurrenceException]) {\n      var exDateString_1 = parentObject[fields.recurrenceException].split(',');\n\n      var _loop_2 = function (i, len) {\n        var edited = this_2.parent.eventsData.filter(function (eventObj) {\n          return eventObj[fields.recurrenceID] === parentObject[fields.id] && eventObj[fields.recurrenceException] === exDateString_1[i];\n        });\n\n        if (edited.length === 0) {\n          var exDate = getDateFromRecurrenceDateString(exDateString_1[i]);\n          var childObject = extend({}, recurrenceData, null, true);\n          childObject[fields.recurrenceID] = parentObject[fields.id];\n          delete childObject[fields.followingID];\n          childObject[fields.recurrenceException] = exDateString_1[i];\n          var startDate = new Date(exDate.getTime());\n          var time = parentObject[fields.endTime].getTime() - parentObject[fields.startTime].getTime();\n          var endDate = new Date(startDate.getTime());\n          endDate.setMilliseconds(time);\n          childObject[fields.startTime] = new Date(startDate.getTime());\n          childObject[fields.endTime] = new Date(endDate.getTime());\n          deletedOccurrences.push(childObject);\n        }\n      };\n\n      var this_2 = this;\n\n      for (var i = 0, len = exDateString_1.length; i < len; i++) {\n        _loop_2(i, len);\n      }\n    }\n\n    return deletedOccurrences;\n  };\n\n  EventBase.prototype.applyResourceColor = function (element, data, type, index, alpha) {\n    if (!this.parent.resourceBase) {\n      return;\n    }\n\n    var alphaColor = function (color, alpha) {\n      color = color.replace('#', '');\n      var r = parseInt(color.substring(0, color.length / 3), 16);\n      var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\n      var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\n      return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\n    }; // index refers groupOrder\n\n\n    var color = this.parent.resourceBase.getResourceColor(data, index);\n\n    if (color) {\n      // tslint:disable-next-line:no-any\n      element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\n    }\n  };\n\n  EventBase.prototype.createBlockAppointmentElement = function (record, resIndex) {\n    var eventSubject = record[this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default;\n    var appointmentWrapper = createElement('div', {\n      className: cls.BLOCK_APPOINTMENT_CLASS,\n      attrs: {\n        'data-id': 'Appointment_' + record[this.parent.eventFields.id],\n        'aria-readonly': 'true',\n        'aria-selected': 'false'\n      }\n    });\n    var templateElement;\n\n    if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\n      var scheduleId = this.parent.element.id + '_';\n      var viewName = this.parent.activeViewOptions.eventTemplateName;\n      var templateId = scheduleId + viewName + 'eventTemplate';\n      var templateArgs = util.addLocalOffsetToEvent(record, this.parent.eventFields);\n      templateElement = this.parent.getAppointmentTemplate()(templateArgs, this.parent, 'eventTemplate', templateId, false);\n    } else {\n      var appointmentSubject = createElement('div', {\n        className: cls.SUBJECT_CLASS,\n        innerHTML: eventSubject\n      });\n      templateElement = [appointmentSubject];\n    }\n\n    append(templateElement, appointmentWrapper);\n    this.setWrapperAttributes(appointmentWrapper, resIndex);\n    return appointmentWrapper;\n  };\n\n  EventBase.prototype.setWrapperAttributes = function (appointmentWrapper, resIndex) {\n    if (!isNullOrUndefined(this.cssClass)) {\n      addClass([appointmentWrapper], this.cssClass);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      appointmentWrapper.setAttribute('data-group-index', resIndex.toString());\n    }\n  };\n\n  EventBase.prototype.getReadonlyAttribute = function (event) {\n    return (event[this.parent.eventFields.isReadonly] || this.parent.readonly).toString();\n  };\n\n  EventBase.prototype.isBlockRange = function (eventData) {\n    var eventCollection = eventData instanceof Array ? eventData : [eventData];\n    var isBlockAlert = false;\n    var fields = this.parent.eventFields;\n\n    for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\n      var event_5 = _a[_i];\n      var dataCol = [];\n\n      if (!isNullOrUndefined(event_5[fields.recurrenceRule]) && (isNullOrUndefined(event_5[fields.recurrenceID]) || event_5[fields.id] === event_5[fields.recurrenceID])) {\n        dataCol = this.generateOccurrence(event_5);\n      } else {\n        dataCol.push(event_5);\n      }\n\n      for (var _b = 0, dataCol_1 = dataCol; _b < dataCol_1.length; _b++) {\n        var data = dataCol_1[_b];\n        var filterBlockEvents = this.filterBlockEvents(data);\n\n        if (filterBlockEvents.length > 0) {\n          isBlockAlert = true;\n          break;\n        }\n      }\n    }\n\n    this.parent.uiStateValues.isBlock = isBlockAlert;\n    return isBlockAlert;\n  };\n\n  EventBase.prototype.getFilterEventsList = function (dataSource, query) {\n    return new DataManager(dataSource).executeLocal(new Query().where(query));\n  };\n\n  EventBase.prototype.getSeriesEvents = function (parentEvent, startTime) {\n    var fields = this.parent.eventFields;\n    startTime = isNullOrUndefined(startTime) ? parentEvent[fields.startTime] : startTime;\n    var deleteFutureEditEvents;\n    var futureEvents;\n    var deleteFutureEditEventList = [];\n    var delId = parentEvent[fields.id];\n    var followingId = parentEvent[fields.followingID];\n    var deleteFutureEvent;\n    var startTimeQuery = this.parent.currentAction === 'EditSeries' ? 'greaterthan' : 'greaterthanorequal';\n\n    do {\n      deleteFutureEvent = new Predicate(fields.followingID, 'equal', delId).and(new Predicate(fields.startTime, startTimeQuery, startTime));\n      futureEvents = this.getFilterEventsList(this.parent.eventsData, deleteFutureEvent);\n      deleteFutureEditEvents = futureEvents.slice(-1)[0];\n\n      if (!isNullOrUndefined(deleteFutureEditEvents) && deleteFutureEditEvents[fields.id] !== followingId) {\n        deleteFutureEditEventList.push(deleteFutureEditEvents);\n        delId = deleteFutureEditEvents[fields.id];\n        followingId = deleteFutureEditEvents[fields.followingID];\n      } else {\n        followingId = null;\n      }\n    } while (futureEvents.length === 1 && !isNullOrUndefined(deleteFutureEditEvents[fields.followingID]));\n\n    return deleteFutureEditEventList;\n  };\n\n  EventBase.prototype.getEditedOccurrences = function (deleteFutureEditEventList, startTime) {\n    var fields = this.parent.eventFields;\n    var deleteRecurrenceEventList = [];\n    var delEditedEvents;\n\n    for (var _i = 0, deleteFutureEditEventList_1 = deleteFutureEditEventList; _i < deleteFutureEditEventList_1.length; _i++) {\n      var event_6 = deleteFutureEditEventList_1[_i];\n      var delEventQuery = new Predicate(fields.recurrenceID, 'equal', event_6[fields.id]).or(new Predicate(fields.recurrenceID, 'equal', event_6[fields.followingID]).and(new Predicate(fields.recurrenceID, 'notequal', undefined)).and(new Predicate(fields.recurrenceID, 'notequal', null)));\n\n      if (this.parent.currentAction === 'EditFollowingEvents' || this.parent.currentAction === 'DeleteFollowingEvents') {\n        delEventQuery = delEventQuery.and(new Predicate(fields.startTime, 'greaterthanorequal', startTime));\n      }\n\n      delEditedEvents = this.getFilterEventsList(this.parent.eventsData, delEventQuery);\n      deleteRecurrenceEventList = deleteRecurrenceEventList.concat(delEditedEvents);\n    }\n\n    return deleteRecurrenceEventList;\n  };\n\n  EventBase.prototype.getRenderedDates = function (dateRender) {\n    var firstDate = 0;\n    var lastDate = dateRender.length;\n    var filteredDates;\n\n    if (dateRender[0] < this.parent.minDate && dateRender[dateRender.length - 1] > this.parent.maxDate) {\n      for (var i = 0; i < dateRender.length; i++) {\n        if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.minDate)).getTime()) {\n          firstDate = i;\n        }\n\n        if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.maxDate)).getTime()) {\n          lastDate = i;\n        }\n      }\n\n      filteredDates = dateRender.filter(function (date) {\n        return date >= dateRender[firstDate] && date <= dateRender[lastDate];\n      });\n    }\n\n    return filteredDates;\n  };\n\n  EventBase.prototype.isValidEvent = function (eventObj, start, end, schedule) {\n    var isHourRange = end.getTime() > schedule.startHour.getTime() && start.getTime() < schedule.endHour.getTime();\n    var isSameRange = schedule.startHour.getTime() <= start.getTime() && eventObj[this.parent.eventFields.startTime].getTime() >= schedule.startHour.getTime() && eventObj[this.parent.eventFields.endTime].getTime() < schedule.endHour.getTime() && start.getTime() === end.getTime();\n    return isHourRange || isSameRange;\n  };\n\n  return EventBase;\n}();\n\nexport { EventBase };","map":{"version":3,"sources":["C:/Users/User/volunteers/node_modules/@syncfusion/ej2-schedule/src/schedule/event-renderer/event-base.js"],"names":["isNullOrUndefined","closest","extend","EventHandler","createElement","prepend","append","addClass","removeClass","DataManager","Query","Predicate","generate","getDateFromRecurrenceDateString","util","cls","event","EventBase","parent","slots","isDoubleTapped","prototype","processData","events","timeZonePropChanged","oldTimezone","_this","start","activeView","startDate","end","endDate","fields","eventFields","processed","temp","generateID","resourceCollection","resourceBase","length","id","_loop_1","event_1","startTime","getDateFromString","endTime","this_1","processTimezoneChange","processTimezone","level","field","undefined","recurrenceRule","recurrenceID","crudModule","crudObj","isCrudAction","concat","generateOccurrence","recEvent","app","k","eventsProcessed","filter","data","getTime","Guid","generateGuid","push","_i","events_1","eventData","isBlock","filterEvents","blockData","i","len","eventObj","isAllDay","resetTime","addDays","blockProcessed","getProcessedEvents","eventCollection","eventsData","_a","event_2","timezonePropertyChange","notify","dataReady","processedData","timezoneConvert","startTimezone","endTimezone","timezone","startTz","endTz","tzModule","convert","add","remove","isReverse","filterBlockEvents","eStart","eEnd","resourceData","activeViewOptions","group","resources","getGroupIndexFromEvent","lastResourceLevel","appointments","resourceTdData","fieldMapping","predicate","and","or","json","executeLocal","where","filterEventsByResource","sortByTime","filterEventsByRange","filteredEvents","e","groupOrder","keys","Object","filteredCollection","every","key","Array","indexOf","sort","a","b","d1","d2","sortByDateTime","object1","object2","d3","d4","d5","d6","getSmallestMissingNumber","array","large","Math","max","apply","splitEventByDay","eventStartTime","eventEndTime","isDifferentDate","Date","getHours","getMinutes","index","eventLength","getDaysCount","count","isSpanned","setHours","getSeconds","splitEvent","dateRender","getDateInMs","orgStart","orgEnd","ranges","cStart","slot","currentView","byDate","showWeekend","slotDates","slot_1","s","renderedDates","getRenderedDates","renderedDates_1","date","firstSlot","startIndex","endIndex","hasBreak","isLeft","isRight","cloneEventObject","dateInRange","availSlot","_b","availSlot_1","slot_2","getSelectedEventElements","target","removeSelectedAppointmentClass","selectedElements","isAlreadySelected","element","getAttribute","elementSelector","focusElements","slice","call","querySelectorAll","focusElements_1","addSelectedAppointments","getSelectedEvents","eventSelect","elementSelect","selectAppointments","APPOINTMENT_BORDER","isAlreadyAdded","getEventByGuid","selectedAppointments","getSelectedAppointments","selectedAppointments_1","appointment","setAttribute","AGENDA_SELECTED_CELL","cells","cells_1","cell","removeSelectedClass","APPOINTMENT_CLASS","focusElement","eventWindow","dialogObject","visible","selectedCell","getSelectedElements","keyboardInteractionModule","activeCellsData","selectCells","focus","selectWorkCellByTime","selectedObject","nearestTime","setMinutes","isAllDayAppointment","targetArea","getAllDayRow","getContentTable","queryString","getMsFromDate","querySelector","getCellDetails","levelIndex","resource","levelName","idField","name","parentField","getIndexFromResourceId","isFullDay","MS_PER_DAY","addEventListener","on","documentClick","appointmentBorderRemove","POPUP_OPEN","wireAppointmentEvents","isPreventCrud","isReadOnly","isReadonly","eventClick","isAdaptive","eventTouchClick","readonly","eventDoubleClick","resizeModule","wireResizeEvent","dragAndDropModule","wireDragEvent","setTimeout","preventDefault","renderResizeHandler","spanEvent","allowResizing","resizeEdge","resizeHandler","className","EVENT_RESIZE_CLASS","appendChild","enableRtl","RIGHT_RESIZE_HANDLER","LEFT_RESIZE_HANDLER","isTop","TOP_RESIZE_HANDLER","isBottom","BOTTOM_RESIZE_HANDLER","classList","contains","DRAG_CLONE_CLASS","RESIZE_CLONE_CLASS","ctrlKey","which","quickPopup","hide","target_1","activeEventData","selectArgs","requestType","trigger","select","args","cancel","originalEvent","selectEventArgs","eventClickArgs","quickPopupHide","allowInline","inlineArgs","type","inlineClick","INLINE_APPOINTMENT_CLASS","INLINE_SUBJECT_CLASS","openEditor","currentAction","openRecurrenceAlert","guid","getEventById","replace","c","r","random","v","toString","getEventIDType","getEventMaxID","resourceId","eventId","idType","datas","maxId","map","isMultiple","eventObject","obj","viewDate","isMaxCount","eventRule","duration","exception","recurrenceException","maxCount","getDateCount","newTimezone","getLocalTimezoneName","firstDay","firstDayOfWeek","calendarMode","dates","generatedDates","occurrenceCollection","dates_1","clonedObject","setMilliseconds","followingID","getParentEvent","isParent","parentEvent","getFollowingEvent","collection","getEventCollections","followObj","follow","occurrence","parentObj","childObj","followingCollection","followingEvent","getOccurrenceEvent","collections","fields_1","fieldValue","parentApp","shift","isFollowingEvent","parentStart","childStart","isGuid","isFollowing","fieldKey","dataSource","getOccurrencesByID","parentObject","event_3","getOccurrencesByRange","event_4","getDeletedOccurrences","recurrenceData","deletedOccurrences","exDateString_1","split","_loop_2","edited","this_2","exDate","childObject","time","applyResourceColor","alpha","alphaColor","color","parseInt","substring","g","getResourceColor","style","createBlockAppointmentElement","record","resIndex","eventSubject","subject","eventSettings","default","appointmentWrapper","BLOCK_APPOINTMENT_CLASS","attrs","templateElement","eventTemplate","scheduleId","viewName","eventTemplateName","templateId","templateArgs","addLocalOffsetToEvent","getAppointmentTemplate","appointmentSubject","SUBJECT_CLASS","innerHTML","setWrapperAttributes","cssClass","getReadonlyAttribute","isBlockRange","isBlockAlert","event_5","dataCol","dataCol_1","uiStateValues","getFilterEventsList","query","getSeriesEvents","deleteFutureEditEvents","futureEvents","deleteFutureEditEventList","delId","followingId","deleteFutureEvent","startTimeQuery","getEditedOccurrences","deleteRecurrenceEventList","delEditedEvents","deleteFutureEditEventList_1","event_6","delEventQuery","firstDate","lastDate","filteredDates","minDate","maxDate","isValidEvent","schedule","isHourRange","startHour","endHour","isSameRange"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, closest, extend, EventHandler } from '@syncfusion/ej2-base';\r\nimport { createElement, prepend, append, addClass, removeClass } from '@syncfusion/ej2-base';\r\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\r\nimport { generate, getDateFromRecurrenceDateString } from '../../recurrence-editor/date-generator';\r\nimport * as util from '../base/util';\r\nimport * as cls from '../base/css-constant';\r\nimport * as event from '../base/constant';\r\n/**\r\n * EventBase for appointment rendering\r\n */\r\nvar EventBase = /** @class */ (function () {\r\n    /**\r\n     * Constructor for EventBase\r\n     */\r\n    function EventBase(parent) {\r\n        this.slots = [];\r\n        this.isDoubleTapped = false;\r\n        this.parent = parent;\r\n    }\r\n    EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\r\n        var _this = this;\r\n        var start = this.parent.activeView.startDate();\r\n        var end = this.parent.activeView.endDate();\r\n        var fields = this.parent.eventFields;\r\n        var processed = [];\r\n        var temp = 1;\r\n        var generateID = false;\r\n        var resourceCollection = this.parent.resourceBase ? this.parent.resourceBase.resourceCollection : [];\r\n        if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\r\n            generateID = true;\r\n        }\r\n        var _loop_1 = function (event_1) {\r\n            if (generateID) {\r\n                event_1[fields.id] = temp++;\r\n            }\r\n            if (typeof event_1[fields.startTime] === 'string') {\r\n                event_1[fields.startTime] = util.getDateFromString(event_1[fields.startTime]);\r\n            }\r\n            if (typeof event_1[fields.endTime] === 'string') {\r\n                event_1[fields.endTime] = util.getDateFromString(event_1[fields.endTime]);\r\n            }\r\n            if (timeZonePropChanged) {\r\n                this_1.processTimezoneChange(event_1, oldTimezone);\r\n            }\r\n            else {\r\n                event_1 = this_1.processTimezone(event_1);\r\n            }\r\n            for (var level = 0; level < resourceCollection.length; level++) {\r\n                if (event_1[resourceCollection[level].field] === null || event_1[resourceCollection[level].field] === 0) {\r\n                    event_1[resourceCollection[level].field] = undefined;\r\n                }\r\n            }\r\n            if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && event_1[fields.recurrenceRule] === '') {\r\n                event_1[fields.recurrenceRule] = null;\r\n            }\r\n            if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID]) &&\r\n                !(this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction)) {\r\n                processed = processed.concat(this_1.generateOccurrence(event_1, null, oldTimezone, true));\r\n            }\r\n            else {\r\n                if (this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction) {\r\n                    var recEvent = void 0;\r\n                    var app = void 0;\r\n                    if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\r\n                        recEvent = this_1.generateOccurrence(event_1, null, oldTimezone, true);\r\n                        for (var k = 0; k < recEvent.length; k++) {\r\n                            event_1 = recEvent[k];\r\n                            app = this_1.parent.eventsProcessed.filter(function (data) {\r\n                                return (data[_this.parent.eventFields.startTime].getTime() -\r\n                                    event_1[_this.parent.eventFields.startTime].getTime() === 0 &&\r\n                                    data[_this.parent.eventFields.id] === event_1[_this.parent.eventFields.id]);\r\n                            });\r\n                            event_1.Guid = (app.length > 0) ? app[0].Guid : this_1.generateGuid();\r\n                            processed.push(event_1);\r\n                        }\r\n                    }\r\n                    else {\r\n                        app = this_1.parent.eventsProcessed.filter(function (data) {\r\n                            return data[_this.parent.eventFields.id] === event_1[_this.parent.eventFields.id];\r\n                        });\r\n                        event_1.Guid = (app.length > 0) ? app[0].Guid : this_1.generateGuid();\r\n                        processed.push(event_1);\r\n                    }\r\n                }\r\n                else {\r\n                    event_1.Guid = this_1.generateGuid();\r\n                    processed.push(event_1);\r\n                }\r\n            }\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\r\n            var event_1 = events_1[_i];\r\n            _loop_1(event_1);\r\n        }\r\n        this.parent.eventsProcessed = [];\r\n        var eventData = processed.filter(function (data) { return !data[_this.parent.eventFields.isBlock]; });\r\n        this.parent.eventsProcessed = this.filterEvents(start, end, eventData);\r\n        var blockData = processed.filter(function (data) { return data[_this.parent.eventFields.isBlock]; });\r\n        for (var i = 0, len = blockData.length; i < len; i++) {\r\n            var eventObj = blockData[i];\r\n            if (eventObj[fields.isAllDay]) {\r\n                eventObj[fields.startTime] = util.resetTime(eventObj[fields.startTime]);\r\n                eventObj[fields.endTime] = util.addDays(util.resetTime(eventObj[fields.endTime]), 1);\r\n            }\r\n        }\r\n        this.parent.blockProcessed = blockData;\r\n        return eventData;\r\n    };\r\n    EventBase.prototype.getProcessedEvents = function (eventCollection) {\r\n        if (eventCollection === void 0) { eventCollection = this.parent.eventsData; }\r\n        var processed = [];\r\n        for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\r\n            var event_2 = _a[_i];\r\n            if (!isNullOrUndefined(event_2[this.parent.eventFields.recurrenceRule]) &&\r\n                isNullOrUndefined(event_2[this.parent.eventFields.recurrenceID])) {\r\n                processed = processed.concat(this.generateOccurrence(event_2));\r\n            }\r\n            else {\r\n                processed.push(event_2);\r\n            }\r\n        }\r\n        return processed;\r\n    };\r\n    EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\r\n        var data = this.parent.eventsData.concat(this.parent.blockData);\r\n        var processed = this.processData(data, true, oldTimezone);\r\n        this.parent.notify(event.dataReady, { processedData: processed });\r\n    };\r\n    /** @private */\r\n    EventBase.prototype.timezoneConvert = function (eventData) {\r\n        var fields = this.parent.eventFields;\r\n        eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\r\n        eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\r\n        if (this.parent.timezone) {\r\n            var startTz = eventData[fields.startTimezone];\r\n            var endTz = eventData[fields.endTimezone];\r\n            eventData[fields.startTime] = this.parent.tzModule.convert(eventData[fields.startTime], this.parent.timezone, startTz);\r\n            eventData[fields.endTime] = this.parent.tzModule.convert(eventData[fields.endTime], this.parent.timezone, endTz);\r\n        }\r\n    };\r\n    EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\r\n        var fields = this.parent.eventFields;\r\n        if (event[fields.isAllDay]) {\r\n            return;\r\n        }\r\n        if (oldTimezone && this.parent.timezone) {\r\n            event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\r\n            event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\r\n        }\r\n        else if (!oldTimezone && this.parent.timezone) {\r\n            event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\r\n            event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\r\n        }\r\n        else if (oldTimezone && !this.parent.timezone) {\r\n            event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], oldTimezone);\r\n            event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], oldTimezone);\r\n        }\r\n    };\r\n    EventBase.prototype.processTimezone = function (event, isReverse) {\r\n        if (isReverse === void 0) { isReverse = false; }\r\n        var fields = this.parent.eventFields;\r\n        if (event[fields.startTimezone] || event[fields.endTimezone]) {\r\n            var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\r\n            var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\r\n            if (isReverse) {\r\n                if (this.parent.timezone) {\r\n                    event[fields.startTime] =\r\n                        this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\r\n                    event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\r\n                    event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\r\n                    event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\r\n                }\r\n                else {\r\n                    event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], startTimezone);\r\n                    event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], endTimezone);\r\n                }\r\n            }\r\n            else {\r\n                event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], startTimezone);\r\n                event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], endTimezone);\r\n                if (this.parent.timezone) {\r\n                    event[fields.startTime] =\r\n                        this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\r\n                    event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\r\n                }\r\n            }\r\n        }\r\n        else if (this.parent.timezone) {\r\n            if (isReverse) {\r\n                event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\r\n                event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\r\n            }\r\n            else {\r\n                event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\r\n                event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\r\n            }\r\n        }\r\n        return event;\r\n    };\r\n    EventBase.prototype.filterBlockEvents = function (eventObj) {\r\n        var eStart = eventObj[this.parent.eventFields.startTime];\r\n        var eEnd = eventObj[this.parent.eventFields.endTime];\r\n        var resourceData;\r\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\r\n            var data = this.getGroupIndexFromEvent(eventObj);\r\n            resourceData = this.parent.resourceBase.lastResourceLevel[data];\r\n        }\r\n        return this.filterEvents(eStart, eEnd, this.parent.blockProcessed, resourceData);\r\n    };\r\n    EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\r\n        if (appointments === void 0) { appointments = this.parent.eventsProcessed; }\r\n        var fieldMapping = this.parent.eventFields;\r\n        var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).\r\n            and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).\r\n            and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).\r\n            or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).\r\n            and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\r\n        var filter = new DataManager({ json: appointments }).executeLocal(new Query().where(predicate));\r\n        if (resourceTdData) {\r\n            filter = this.filterEventsByResource(resourceTdData, filter);\r\n        }\r\n        return this.sortByTime(filter);\r\n    };\r\n    EventBase.prototype.filterEventsByRange = function (eventCollection, startDate, endDate) {\r\n        var _this = this;\r\n        var filteredEvents = [];\r\n        if (startDate && endDate) {\r\n            filteredEvents = this.filterEvents(startDate, endDate, eventCollection);\r\n        }\r\n        else if (startDate && !endDate) {\r\n            filteredEvents = eventCollection.filter(function (e) { return e[_this.parent.eventFields.startTime] >= startDate; });\r\n        }\r\n        else if (!startDate && endDate) {\r\n            filteredEvents = eventCollection.filter(function (e) { return e[_this.parent.eventFields.endTime] <= endDate; });\r\n        }\r\n        else {\r\n            filteredEvents = eventCollection;\r\n        }\r\n        return this.sortByTime(filteredEvents);\r\n    };\r\n    EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\r\n        if (appointments === void 0) { appointments = this.parent.eventsProcessed; }\r\n        var predicate = {};\r\n        var resourceCollection = this.parent.resourceBase.resourceCollection;\r\n        for (var level = 0; level < resourceCollection.length; level++) {\r\n            predicate[resourceCollection[level].field] = resourceTdData.groupOrder[level];\r\n        }\r\n        var keys = Object.keys(predicate);\r\n        var filteredCollection = appointments.filter(function (eventObj) { return keys.every(function (key) {\r\n            if (eventObj[key] instanceof Array) {\r\n                return eventObj[key].indexOf(predicate[key]) > -1;\r\n            }\r\n            else {\r\n                return eventObj[key] === predicate[key];\r\n            }\r\n        }); });\r\n        return filteredCollection;\r\n    };\r\n    EventBase.prototype.sortByTime = function (appointments) {\r\n        var fieldMapping = this.parent.eventFields;\r\n        appointments.sort(function (a, b) {\r\n            var d1 = a[fieldMapping.startTime];\r\n            var d2 = b[fieldMapping.startTime];\r\n            return d1.getTime() - d2.getTime();\r\n        });\r\n        return appointments;\r\n    };\r\n    EventBase.prototype.sortByDateTime = function (appointments) {\r\n        var fieldMapping = this.parent.eventFields;\r\n        appointments.sort(function (object1, object2) {\r\n            var d3 = object1[fieldMapping.startTime];\r\n            var d4 = object2[fieldMapping.startTime];\r\n            var d5 = object1[fieldMapping.endTime];\r\n            var d6 = object2[fieldMapping.endTime];\r\n            var d1 = d5.getTime() - d3.getTime();\r\n            var d2 = d6.getTime() - d4.getTime();\r\n            return (d3.getTime() - d4.getTime() || d2 - d1);\r\n        });\r\n        return appointments;\r\n    };\r\n    EventBase.prototype.getSmallestMissingNumber = function (array) {\r\n        var large = Math.max.apply(Math, array);\r\n        for (var i = 0; i < large; i++) {\r\n            if (array.indexOf(i) === -1) {\r\n                return i;\r\n            }\r\n        }\r\n        return large + 1;\r\n    };\r\n    EventBase.prototype.splitEventByDay = function (event) {\r\n        var eventFields = this.parent.eventFields;\r\n        var data = [];\r\n        var eventStartTime = event[eventFields.startTime];\r\n        var eventEndTime = event[eventFields.endTime];\r\n        var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) <\r\n            util.resetTime(new Date(eventEndTime.getTime()));\r\n        if (isDifferentDate) {\r\n            var start = new Date(eventStartTime.getTime());\r\n            var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\r\n            var endDate = (eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0) ?\r\n                eventEndTime : util.addDays(eventEndTime, 1);\r\n            var index = 1;\r\n            var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\r\n            while (end <= eventEndTime && start.getTime() !== end.getTime()) {\r\n                var app = extend({}, event);\r\n                app[eventFields.startTime] = start;\r\n                app[eventFields.endTime] = end;\r\n                app.data = { index: index, count: eventLength };\r\n                app.Guid = this.generateGuid();\r\n                app.isSpanned = true;\r\n                data.push(app);\r\n                start = end;\r\n                if ((util.resetTime(new Date(start.getTime())).getTime() === util.resetTime(new Date(eventEndTime.getTime())).getTime())\r\n                    && !(end.getTime() === eventEndTime.getTime())) {\r\n                    end = new Date(start.getTime());\r\n                    end = new Date(end.setHours(eventEndTime.getHours(), eventEndTime.getMinutes(), eventEndTime.getSeconds()));\r\n                }\r\n                else {\r\n                    end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\r\n                }\r\n                index++;\r\n            }\r\n        }\r\n        else {\r\n            data.push(event);\r\n        }\r\n        return data;\r\n    };\r\n    EventBase.prototype.splitEvent = function (event, dateRender) {\r\n        var fields = this.parent.eventFields;\r\n        var start = util.resetTime(new Date(event[fields.startTime] + '')).getTime();\r\n        var end = util.resetTime(new Date(event[fields.endTime] + '')).getTime();\r\n        if (util.getDateInMs(event[fields.endTime]) <= 0) {\r\n            var temp = util.addDays(util.resetTime(new Date(event[fields.endTime] + '')), -1).getTime();\r\n            end = start > temp ? start : temp;\r\n        }\r\n        var orgStart = start;\r\n        var orgEnd = end;\r\n        var ranges = [];\r\n        if (start !== end) {\r\n            if (start < dateRender[0].getTime()) {\r\n                start = dateRender[0].getTime();\r\n            }\r\n            if (end > dateRender[dateRender.length - 1].getTime()) {\r\n                end = dateRender[dateRender.length - 1].getTime();\r\n            }\r\n            var cStart = start;\r\n            for (var level = 0; level < this.slots.length; level++) {\r\n                var slot = this.slots[level];\r\n                if (this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'TimelineWorkWeek'\r\n                    || this.parent.activeViewOptions.group.byDate || this.parent.activeViewOptions.showWeekend) {\r\n                    var slotDates = [];\r\n                    for (var _i = 0, slot_1 = slot; _i < slot_1.length; _i++) {\r\n                        var s = slot_1[_i];\r\n                        slotDates.push(new Date(s));\r\n                    }\r\n                    var renderedDates = this.getRenderedDates(slotDates);\r\n                    if (!isNullOrUndefined(renderedDates) && renderedDates.length > 0) {\r\n                        slot = [];\r\n                        for (var _a = 0, renderedDates_1 = renderedDates; _a < renderedDates_1.length; _a++) {\r\n                            var date = renderedDates_1[_a];\r\n                            slot.push(date.getTime());\r\n                        }\r\n                    }\r\n                }\r\n                var firstSlot = slot[0];\r\n                cStart = (cStart <= firstSlot && end >= firstSlot) ? firstSlot : cStart;\r\n                if (cStart > end || firstSlot > end) {\r\n                    break;\r\n                }\r\n                if (!this.parent.activeViewOptions.group.byDate && this.parent.activeViewOptions.showWeekend &&\r\n                    this.parent.currentView !== 'WorkWeek' && this.parent.currentView !== 'TimelineWorkWeek') {\r\n                    var startIndex = slot.indexOf(cStart);\r\n                    if (startIndex !== -1) {\r\n                        var endIndex = slot.indexOf(end);\r\n                        var hasBreak = endIndex !== -1;\r\n                        endIndex = hasBreak ? endIndex : slot.length - 1;\r\n                        var count = ((endIndex - startIndex) + 1);\r\n                        var isLeft = (slot[startIndex] !== orgStart);\r\n                        var isRight = (slot[endIndex] !== orgEnd);\r\n                        ranges.push(this.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\r\n                        if (hasBreak) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    if (this.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\r\n                        var availSlot = [];\r\n                        for (var i = 0; i < slot.length; i++) {\r\n                            if (this.dateInRange(slot[i], orgStart, orgEnd)) {\r\n                                availSlot.push(slot[i]);\r\n                            }\r\n                        }\r\n                        if (availSlot.length > 0) {\r\n                            if (!this.parent.activeViewOptions.group.byDate) {\r\n                                var isLeft = (availSlot[0] !== orgStart);\r\n                                var isRight = (availSlot[availSlot.length - 1] !== orgEnd);\r\n                                ranges.push(this.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\r\n                            }\r\n                            else {\r\n                                for (var _b = 0, availSlot_1 = availSlot; _b < availSlot_1.length; _b++) {\r\n                                    var slot_2 = availSlot_1[_b];\r\n                                    ranges.push(this.cloneEventObject(event, slot_2, slot_2, 1, (slot_2 !== orgStart), (slot_2 !== orgEnd)));\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\r\n        }\r\n        return ranges;\r\n    };\r\n    EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\r\n        var fields = this.parent.eventFields;\r\n        var e = extend({}, event, null, true);\r\n        var data = { count: count, isLeft: isLeft, isRight: isRight };\r\n        data[fields.startTime] = event[fields.startTime];\r\n        data[fields.endTime] = event[fields.endTime];\r\n        e.data = data;\r\n        e[fields.startTime] = new Date(start);\r\n        e[fields.endTime] = new Date(end);\r\n        return e;\r\n    };\r\n    EventBase.prototype.dateInRange = function (date, start, end) {\r\n        return start <= date && date <= end;\r\n    };\r\n    EventBase.prototype.getSelectedEventElements = function (target) {\r\n        this.removeSelectedAppointmentClass();\r\n        if (this.parent.selectedElements.length <= 0) {\r\n            this.parent.selectedElements.push(target);\r\n        }\r\n        else {\r\n            var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\r\n                return element.getAttribute('data-guid') === target.getAttribute('data-guid');\r\n            });\r\n            if (isAlreadySelected.length <= 0) {\r\n                var elementSelector = 'div[data-guid=\"' + target.getAttribute('data-guid') + '\"]';\r\n                var focusElements = [].slice.call(this.parent.element.querySelectorAll(elementSelector));\r\n                for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\r\n                    var element = focusElements_1[_i];\r\n                    this.parent.selectedElements.push(element);\r\n                }\r\n            }\r\n            else {\r\n                var selectedElements = this.parent.selectedElements.filter(function (element) {\r\n                    return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\r\n                });\r\n                this.parent.selectedElements = selectedElements;\r\n            }\r\n        }\r\n        if (target && this.parent.selectedElements.length > 0) {\r\n            this.addSelectedAppointments(this.parent.selectedElements);\r\n        }\r\n        return this.parent.selectedElements;\r\n    };\r\n    EventBase.prototype.getSelectedEvents = function () {\r\n        var _this = this;\r\n        var eventSelect = [];\r\n        var elementSelect = [];\r\n        var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\r\n        selectAppointments.filter(function (element) {\r\n            var isAlreadyAdded = eventSelect.filter(function (event) {\r\n                return event.Guid === element.getAttribute('data-guid');\r\n            });\r\n            if (isAlreadyAdded.length === 0) {\r\n                eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\r\n            }\r\n            elementSelect.push(element);\r\n        });\r\n        return {\r\n            event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\r\n            element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\r\n        };\r\n    };\r\n    EventBase.prototype.removeSelectedAppointmentClass = function () {\r\n        var selectedAppointments = this.getSelectedAppointments();\r\n        for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\r\n            var appointment = selectedAppointments_1[_i];\r\n            appointment.setAttribute('aria-selected', 'false');\r\n        }\r\n        removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\r\n        if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\r\n            removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\r\n        }\r\n    };\r\n    EventBase.prototype.addSelectedAppointments = function (cells) {\r\n        for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\r\n            var cell = cells_1[_i];\r\n            cell.setAttribute('aria-selected', 'true');\r\n        }\r\n        if (this.parent.currentView !== 'MonthAgenda') {\r\n            this.parent.removeSelectedClass();\r\n        }\r\n        addClass(cells, cls.APPOINTMENT_BORDER);\r\n    };\r\n    EventBase.prototype.getSelectedAppointments = function () {\r\n        return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\r\n    };\r\n    EventBase.prototype.focusElement = function () {\r\n        if (this.parent.eventWindow.dialogObject && this.parent.eventWindow.dialogObject.visible) {\r\n            return;\r\n        }\r\n        var selectedCell = this.parent.getSelectedElements();\r\n        if (selectedCell.length > 0) {\r\n            if (this.parent.keyboardInteractionModule) {\r\n                var target = ((!isNullOrUndefined(this.parent.activeCellsData) &&\r\n                    this.parent.activeCellsData.element) || selectedCell[selectedCell.length - 1]);\r\n                this.parent.keyboardInteractionModule.selectCells(target instanceof Array, target);\r\n            }\r\n            return;\r\n        }\r\n        var selectedAppointments = this.getSelectedAppointments();\r\n        if (selectedAppointments.length > 0) {\r\n            selectedAppointments[selectedAppointments.length - 1].focus();\r\n            return;\r\n        }\r\n    };\r\n    EventBase.prototype.selectWorkCellByTime = function (eventsData) {\r\n        var target;\r\n        if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\r\n            return target;\r\n        }\r\n        if (eventsData.length > 0) {\r\n            var selectedObject = eventsData[eventsData.length - 1];\r\n            var eventStartTime = selectedObject[this.parent.eventFields.startTime];\r\n            var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\r\n            var isAllDay = this.isAllDayAppointment(selectedObject);\r\n            if (this.parent.currentView === 'Month' || isAllDay) {\r\n                nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\r\n            }\r\n            var targetArea = void 0;\r\n            if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\r\n                targetArea = this.parent.getAllDayRow();\r\n            }\r\n            else {\r\n                targetArea = this.parent.getContentTable();\r\n            }\r\n            var queryString = '[data-date=\"' + this.parent.getMsFromDate(new Date(nearestTime)) + '\"]';\r\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\r\n                queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\r\n            }\r\n            target = targetArea.querySelector(queryString);\r\n            if (target) {\r\n                this.parent.activeCellsData = this.parent.getCellDetails(target);\r\n                if (this.parent.keyboardInteractionModule) {\r\n                    this.parent.keyboardInteractionModule.selectCells(false, target);\r\n                }\r\n                return target;\r\n            }\r\n        }\r\n        return target;\r\n    };\r\n    EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\r\n        var levelIndex;\r\n        var resource;\r\n        var levelName;\r\n        var idField;\r\n        for (var i = this.parent.resourceBase.resourceCollection.length - 1; i >= 0; i--) {\r\n            var resourceData = eventData[this.parent.resourceBase.resourceCollection[i].field];\r\n            if (!isNullOrUndefined(resourceData)) {\r\n                resource = this.parent.resourceBase.resourceCollection[i];\r\n                levelIndex = i;\r\n                levelName = resource.name;\r\n                idField = resource.field;\r\n                break;\r\n            }\r\n        }\r\n        if (isNullOrUndefined(levelName) && isNullOrUndefined(levelIndex)) {\r\n            levelName = this.parent.resourceCollection.slice(-1)[0].name;\r\n            levelIndex = this.parent.resourceCollection.length - 1;\r\n            idField = this.parent.resourceCollection.slice(-1)[0].field;\r\n            resource = this.parent.resourceCollection.filter(function (e, index) {\r\n                if (e.name === levelName) {\r\n                    levelIndex = index;\r\n                    return e;\r\n                }\r\n                return null;\r\n            })[0];\r\n        }\r\n        var id = ((eventData[idField] instanceof Array) ?\r\n            eventData[idField][0] : eventData[idField]);\r\n        if (levelIndex > 0) {\r\n            var parentField = this.parent.resourceCollection[levelIndex - 1].field;\r\n            return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource, eventData, parentField);\r\n        }\r\n        else {\r\n            return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource);\r\n        }\r\n    };\r\n    EventBase.prototype.isAllDayAppointment = function (event) {\r\n        var fieldMapping = this.parent.eventFields;\r\n        var isAllDay = event[fieldMapping.isAllDay];\r\n        var isFullDay = ((event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime())\r\n            / util.MS_PER_DAY) >= 1;\r\n        return (isAllDay || isFullDay) ? true : false;\r\n    };\r\n    EventBase.prototype.addEventListener = function () {\r\n        this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\r\n    };\r\n    EventBase.prototype.appointmentBorderRemove = function (event) {\r\n        var element = event.event.target;\r\n        if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\r\n            if (this.parent.currentView !== 'MonthAgenda') {\r\n                this.parent.removeSelectedClass();\r\n            }\r\n        }\r\n        else if (!closest(element, '.' + cls.POPUP_OPEN)) {\r\n            this.removeSelectedAppointmentClass();\r\n        }\r\n    };\r\n    EventBase.prototype.wireAppointmentEvents = function (element, event, isPreventCrud) {\r\n        if (isPreventCrud === void 0) { isPreventCrud = false; }\r\n        var isReadOnly = (!isNullOrUndefined(event)) ? event[this.parent.eventFields.isReadonly] : false;\r\n        EventHandler.add(element, 'click', this.eventClick, this);\r\n        if (!this.parent.isAdaptive) {\r\n            EventHandler.add(element, 'touchstart', this.eventTouchClick, this);\r\n        }\r\n        if (!this.parent.isAdaptive && !this.parent.activeViewOptions.readonly && !isReadOnly) {\r\n            EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\r\n        }\r\n        if (!this.parent.activeViewOptions.readonly && !isReadOnly && !isPreventCrud) {\r\n            if (this.parent.resizeModule) {\r\n                this.parent.resizeModule.wireResizeEvent(element);\r\n            }\r\n            if (this.parent.dragAndDropModule) {\r\n                this.parent.dragAndDropModule.wireDragEvent(element);\r\n            }\r\n        }\r\n    };\r\n    EventBase.prototype.eventTouchClick = function (e) {\r\n        var _this = this;\r\n        setTimeout(function () { return _this.isDoubleTapped = false; }, 250);\r\n        e.preventDefault();\r\n        if (this.isDoubleTapped) {\r\n            this.eventDoubleClick(e);\r\n        }\r\n        else if (!this.isDoubleTapped) {\r\n            this.isDoubleTapped = true;\r\n            this.eventClick(e);\r\n        }\r\n    };\r\n    EventBase.prototype.renderResizeHandler = function (element, spanEvent, isReadOnly) {\r\n        if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly || isReadOnly) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\r\n            var resizeEdge = _a[_i];\r\n            var resizeHandler = createElement('div', { className: cls.EVENT_RESIZE_CLASS });\r\n            switch (resizeEdge) {\r\n                case 'isLeft':\r\n                    if (!spanEvent.isLeft) {\r\n                        resizeHandler.appendChild(createElement('div', { className: 'e-left-right-resize' }));\r\n                        addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\r\n                        prepend([resizeHandler], element);\r\n                    }\r\n                    break;\r\n                case 'isRight':\r\n                    if (!spanEvent.isRight) {\r\n                        resizeHandler.appendChild(createElement('div', { className: 'e-left-right-resize' }));\r\n                        addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\r\n                        append([resizeHandler], element);\r\n                    }\r\n                    break;\r\n                case 'isTop':\r\n                    if (!spanEvent.isTop) {\r\n                        resizeHandler.appendChild(createElement('div', { className: 'e-top-bottom-resize' }));\r\n                        addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\r\n                        prepend([resizeHandler], element);\r\n                    }\r\n                    break;\r\n                case 'isBottom':\r\n                    if (!spanEvent.isBottom) {\r\n                        resizeHandler.appendChild(createElement('div', { className: 'e-top-bottom-resize' }));\r\n                        addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\r\n                        append([resizeHandler], element);\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    EventBase.prototype.eventClick = function (eventData) {\r\n        var _this = this;\r\n        var target = eventData.target;\r\n        if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS)) {\r\n            return;\r\n        }\r\n        if (eventData.ctrlKey && eventData.which === 1 && this.parent.keyboardInteractionModule) {\r\n            this.parent.quickPopup.quickPopup.hide();\r\n            this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\r\n            var target_1 = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\r\n            this.getSelectedEventElements(target_1);\r\n            this.activeEventData(eventData, false);\r\n            var selectArgs = {\r\n                data: this.parent.activeEventData.event,\r\n                element: this.parent.activeEventData.element,\r\n                event: eventData, requestType: 'eventSelect'\r\n            };\r\n            this.parent.trigger(event.select, selectArgs);\r\n            var args = extend(this.parent.activeEventData, { cancel: false, originalEvent: eventData });\r\n            this.parent.trigger(event.eventClick, args);\r\n        }\r\n        else {\r\n            this.removeSelectedAppointmentClass();\r\n            this.activeEventData(eventData, true);\r\n            var selectEventArgs = {\r\n                data: this.parent.activeEventData.event,\r\n                element: this.parent.activeEventData.element,\r\n                event: eventData, requestType: 'eventSelect'\r\n            };\r\n            this.parent.trigger(event.select, selectEventArgs);\r\n            var args = extend(this.parent.activeEventData, { cancel: false, originalEvent: eventData });\r\n            this.parent.trigger(event.eventClick, args, function (eventClickArgs) {\r\n                if (eventClickArgs.cancel) {\r\n                    _this.removeSelectedAppointmentClass();\r\n                    if (_this.parent.quickPopup) {\r\n                        _this.parent.quickPopup.quickPopupHide();\r\n                    }\r\n                }\r\n                else {\r\n                    if (_this.parent.currentView === 'Agenda' || _this.parent.currentView === 'MonthAgenda') {\r\n                        addClass([_this.parent.activeEventData.element], cls.AGENDA_SELECTED_CELL);\r\n                    }\r\n                    if (_this.parent.allowInline) {\r\n                        var inlineArgs = {\r\n                            data: eventClickArgs.event,\r\n                            element: eventClickArgs.element,\r\n                            type: 'Event'\r\n                        };\r\n                        _this.parent.notify(event.inlineClick, inlineArgs);\r\n                    }\r\n                    else {\r\n                        _this.parent.notify(event.eventClick, eventClickArgs);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    EventBase.prototype.eventDoubleClick = function (e) {\r\n        this.parent.quickPopup.quickPopupHide(true);\r\n        if (e.type === 'touchstart') {\r\n            this.activeEventData(e, true);\r\n        }\r\n        this.removeSelectedAppointmentClass();\r\n        if (this.parent.activeEventData.element.classList.contains(cls.INLINE_APPOINTMENT_CLASS) ||\r\n            this.parent.activeEventData.element.querySelector('.' + cls.INLINE_SUBJECT_CLASS)) {\r\n            return;\r\n        }\r\n        if (!isNullOrUndefined(this.parent.activeEventData.event) &&\r\n            isNullOrUndefined(this.parent.activeEventData.event[this.parent.eventFields.recurrenceID])) {\r\n            this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\r\n        }\r\n        else {\r\n            this.parent.currentAction = 'EditOccurrence';\r\n            this.parent.quickPopup.openRecurrenceAlert();\r\n        }\r\n    };\r\n    EventBase.prototype.getEventByGuid = function (guid) {\r\n        return this.parent.eventsProcessed.filter(function (data) { return data.Guid === guid; })[0];\r\n    };\r\n    EventBase.prototype.getEventById = function (id) {\r\n        var _this = this;\r\n        return this.parent.eventsData.filter(function (data) {\r\n            return data[_this.parent.eventFields.id] === id;\r\n        })[0];\r\n    };\r\n    EventBase.prototype.generateGuid = function () {\r\n        return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\r\n            var r = Math.random() * 16 | 0;\r\n            var v = (c === 'x') ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    };\r\n    EventBase.prototype.getEventIDType = function () {\r\n        if (this.parent.eventsData.length !== 0) {\r\n            return typeof (this.parent.eventsData[0][this.parent.eventFields.id]);\r\n        }\r\n        if (this.parent.blockData.length !== 0) {\r\n            return typeof (this.parent.blockData[0][this.parent.eventFields.id]);\r\n        }\r\n        return 'string';\r\n    };\r\n    EventBase.prototype.getEventMaxID = function (resourceId) {\r\n        var _this = this;\r\n        if (this.parent.eventsData.length < 1 && this.parent.blockData.length < 1) {\r\n            return 1;\r\n        }\r\n        var eventId;\r\n        var idType = this.getEventIDType();\r\n        if (idType === 'string') {\r\n            eventId = this.generateGuid();\r\n        }\r\n        if (idType === 'number') {\r\n            var datas = this.parent.eventsData.concat(this.parent.blockData);\r\n            var maxId = Math.max.apply(Math, datas.map(function (event) { return event[_this.parent.eventFields.id]; }));\r\n            maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\r\n            eventId = maxId + 1;\r\n        }\r\n        return eventId;\r\n    };\r\n    EventBase.prototype.activeEventData = function (eventData, isMultiple) {\r\n        var _this = this;\r\n        var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\r\n        var guid = target.getAttribute('data-guid');\r\n        if (isMultiple) {\r\n            this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\r\n            target.focus();\r\n        }\r\n        var eventObject = this.getEventByGuid(guid);\r\n        if (eventObject && eventObject.isSpanned) {\r\n            eventObject = this.parent.eventsData.filter(function (obj) {\r\n                return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\r\n            })[0];\r\n        }\r\n        this.parent.activeEventData = { event: eventObject, element: target };\r\n    };\r\n    EventBase.prototype.generateOccurrence = function (event, viewDate, oldTimezone, isMaxCount) {\r\n        var startDate = event[this.parent.eventFields.startTime];\r\n        var endDate = event[this.parent.eventFields.endTime];\r\n        var eventRule = event[this.parent.eventFields.recurrenceRule];\r\n        var duration = endDate.getTime() - startDate.getTime();\r\n        viewDate = new Date((viewDate || this.parent.activeView.startDate()).getTime() - duration);\r\n        var exception = event[this.parent.eventFields.recurrenceException];\r\n        var maxCount;\r\n        if (this.parent.currentView !== 'Agenda' && isMaxCount) {\r\n            maxCount = util.getDateCount(this.parent.activeView.startDate(), this.parent.activeView.endDate()) + 1;\r\n        }\r\n        var newTimezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\r\n        var firstDay = this.parent.activeViewOptions.firstDayOfWeek;\r\n        var calendarMode = this.parent.calendarMode;\r\n        var dates = generate(startDate, eventRule, exception, firstDay, maxCount, viewDate, calendarMode, oldTimezone, newTimezone);\r\n        if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\r\n            if (isNullOrUndefined(event.generatedDates)) {\r\n                event.generatedDates = { start: new Date(dates[0]), end: new Date(dates[dates.length - 1]) };\r\n            }\r\n            else {\r\n                if (dates[0] < event.generatedDates.start.getTime()) {\r\n                    event.generatedDates.start = new Date(dates[0]);\r\n                }\r\n                if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\r\n                    event.generatedDates.end = new Date(dates[dates.length - 1]);\r\n                }\r\n            }\r\n        }\r\n        var occurrenceCollection = [];\r\n        for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\r\n            var date = dates_1[_i];\r\n            var clonedObject = extend({}, event, null, true);\r\n            clonedObject[this.parent.eventFields.startTime] = new Date(date);\r\n            clonedObject[this.parent.eventFields.endTime] = new Date(new Date(date).setMilliseconds(duration));\r\n            clonedObject[this.parent.eventFields.recurrenceID] = clonedObject[this.parent.eventFields.id];\r\n            delete clonedObject[this.parent.eventFields.recurrenceException];\r\n            delete clonedObject[this.parent.eventFields.followingID];\r\n            clonedObject.Guid = this.generateGuid();\r\n            occurrenceCollection.push(clonedObject);\r\n        }\r\n        return occurrenceCollection;\r\n    };\r\n    EventBase.prototype.getParentEvent = function (eventObj, isParent) {\r\n        if (isParent === void 0) { isParent = false; }\r\n        var parentEvent;\r\n        do {\r\n            eventObj = this.getFollowingEvent(eventObj);\r\n            if (eventObj) {\r\n                parentEvent = extend({}, eventObj, null, true);\r\n            }\r\n        } while (eventObj && isParent);\r\n        if (isParent && parentEvent) {\r\n            var collection = this.getEventCollections(parentEvent);\r\n            var followObj = collection.follow.slice(-1)[0];\r\n            if (collection.occurrence.length > 0 && !parentEvent[this.parent.eventFields.recurrenceException]) {\r\n                followObj = collection.occurrence.slice(-1)[0];\r\n            }\r\n            if (followObj) {\r\n                parentEvent[this.parent.eventFields.recurrenceRule] = followObj[this.parent.eventFields.recurrenceRule];\r\n            }\r\n        }\r\n        return parentEvent;\r\n    };\r\n    EventBase.prototype.getEventCollections = function (parentObj, childObj) {\r\n        var followingCollection = [];\r\n        var occurrenceCollection = [];\r\n        var followingEvent = parentObj;\r\n        do {\r\n            followingEvent = this.getFollowingEvent(followingEvent, true);\r\n            if (followingEvent) {\r\n                followingCollection.push(followingEvent);\r\n            }\r\n            occurrenceCollection = occurrenceCollection.concat(this.getOccurrenceEvent(followingEvent || parentObj));\r\n        } while (followingEvent);\r\n        var collections = {};\r\n        if (childObj) {\r\n            var fields_1 = this.parent.eventFields;\r\n            collections = {\r\n                follow: followingCollection.filter(function (eventData) {\r\n                    return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\r\n                }),\r\n                occurrence: occurrenceCollection.filter(function (eventData) {\r\n                    return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\r\n                })\r\n            };\r\n        }\r\n        else {\r\n            collections = { follow: followingCollection, occurrence: occurrenceCollection };\r\n        }\r\n        return collections;\r\n    };\r\n    EventBase.prototype.getFollowingEvent = function (parentObj, isReverse) {\r\n        var fields = this.parent.eventFields;\r\n        var fieldValue;\r\n        if (isReverse) {\r\n            fieldValue = parentObj[fields.id];\r\n        }\r\n        else {\r\n            fieldValue = (parentObj[fields.recurrenceID] || parentObj[fields.followingID]);\r\n        }\r\n        var parentApp = this.parent.eventsData.filter(function (data) {\r\n            return data[isReverse ? fields.followingID : fields.id] === fieldValue;\r\n        });\r\n        return parentApp.shift();\r\n    };\r\n    EventBase.prototype.isFollowingEvent = function (parentObj, childObj) {\r\n        var parentStart = parentObj[this.parent.eventFields.startTime];\r\n        var childStart = childObj[this.parent.eventFields.startTime];\r\n        return parentStart.getHours() === childStart.getHours() && parentStart.getMinutes() === childStart.getMinutes() &&\r\n            parentStart.getSeconds() === childStart.getSeconds();\r\n    };\r\n    EventBase.prototype.getOccurrenceEvent = function (eventObj, isGuid, isFollowing) {\r\n        if (isGuid === void 0) { isGuid = false; }\r\n        if (isFollowing === void 0) { isFollowing = false; }\r\n        var idField = isGuid ? 'Guid' : (isFollowing) ? this.parent.eventFields.followingID : this.parent.eventFields.recurrenceID;\r\n        var fieldKey = isGuid ? 'Guid' : this.parent.eventFields.id;\r\n        var dataSource = isGuid ? this.parent.eventsProcessed : this.parent.eventsData;\r\n        return dataSource.filter(function (data) { return data[idField] === eventObj[fieldKey]; });\r\n    };\r\n    EventBase.prototype.getOccurrencesByID = function (id) {\r\n        var fields = this.parent.eventFields;\r\n        var occurrenceCollection = [];\r\n        var parentObject = this.parent.eventsData.filter(function (obj) { return obj[fields.id] === id; });\r\n        for (var _i = 0, _a = parentObject; _i < _a.length; _i++) {\r\n            var event_3 = _a[_i];\r\n            if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\r\n                occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\r\n            }\r\n        }\r\n        return occurrenceCollection;\r\n    };\r\n    EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\r\n        var fields = this.parent.eventFields;\r\n        var occurrenceCollection = [];\r\n        for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\r\n            var event_4 = _a[_i];\r\n            if (!isNullOrUndefined(event_4[fields.recurrenceRule])) {\r\n                occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_4));\r\n            }\r\n        }\r\n        var filter = occurrenceCollection.filter(function (obj) {\r\n            return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\r\n        });\r\n        return filter;\r\n    };\r\n    EventBase.prototype.getDeletedOccurrences = function (recurrenceData) {\r\n        var fields = this.parent.eventFields;\r\n        var parentObject;\r\n        var deletedOccurrences = [];\r\n        if (typeof recurrenceData === 'string' || typeof recurrenceData === 'number') {\r\n            parentObject = this.parent.eventsData.filter(function (obj) {\r\n                return obj[fields.id] === recurrenceData;\r\n            })[0];\r\n        }\r\n        else {\r\n            parentObject = extend({}, recurrenceData, null, true);\r\n        }\r\n        if (parentObject[fields.recurrenceException]) {\r\n            var exDateString_1 = parentObject[fields.recurrenceException].split(',');\r\n            var _loop_2 = function (i, len) {\r\n                var edited = this_2.parent.eventsData.filter(function (eventObj) {\r\n                    return eventObj[fields.recurrenceID] === parentObject[fields.id] && eventObj[fields.recurrenceException] === exDateString_1[i];\r\n                });\r\n                if (edited.length === 0) {\r\n                    var exDate = getDateFromRecurrenceDateString(exDateString_1[i]);\r\n                    var childObject = extend({}, recurrenceData, null, true);\r\n                    childObject[fields.recurrenceID] = parentObject[fields.id];\r\n                    delete childObject[fields.followingID];\r\n                    childObject[fields.recurrenceException] = exDateString_1[i];\r\n                    var startDate = new Date(exDate.getTime());\r\n                    var time = parentObject[fields.endTime].getTime() - parentObject[fields.startTime].getTime();\r\n                    var endDate = new Date(startDate.getTime());\r\n                    endDate.setMilliseconds(time);\r\n                    childObject[fields.startTime] = new Date(startDate.getTime());\r\n                    childObject[fields.endTime] = new Date(endDate.getTime());\r\n                    deletedOccurrences.push(childObject);\r\n                }\r\n            };\r\n            var this_2 = this;\r\n            for (var i = 0, len = exDateString_1.length; i < len; i++) {\r\n                _loop_2(i, len);\r\n            }\r\n        }\r\n        return deletedOccurrences;\r\n    };\r\n    EventBase.prototype.applyResourceColor = function (element, data, type, index, alpha) {\r\n        if (!this.parent.resourceBase) {\r\n            return;\r\n        }\r\n        var alphaColor = function (color, alpha) {\r\n            color = color.replace('#', '');\r\n            var r = parseInt(color.substring(0, color.length / 3), 16);\r\n            var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\r\n            var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\r\n            return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\r\n        };\r\n        // index refers groupOrder\r\n        var color = this.parent.resourceBase.getResourceColor(data, index);\r\n        if (color) {\r\n            // tslint:disable-next-line:no-any\r\n            element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\r\n        }\r\n    };\r\n    EventBase.prototype.createBlockAppointmentElement = function (record, resIndex) {\r\n        var eventSubject = (record[this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default);\r\n        var appointmentWrapper = createElement('div', {\r\n            className: cls.BLOCK_APPOINTMENT_CLASS,\r\n            attrs: {\r\n                'data-id': 'Appointment_' + record[this.parent.eventFields.id],\r\n                'aria-readonly': 'true', 'aria-selected': 'false'\r\n            }\r\n        });\r\n        var templateElement;\r\n        if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\r\n            var scheduleId = this.parent.element.id + '_';\r\n            var viewName = this.parent.activeViewOptions.eventTemplateName;\r\n            var templateId = scheduleId + viewName + 'eventTemplate';\r\n            var templateArgs = util.addLocalOffsetToEvent(record, this.parent.eventFields);\r\n            templateElement = this.parent.getAppointmentTemplate()(templateArgs, this.parent, 'eventTemplate', templateId, false);\r\n        }\r\n        else {\r\n            var appointmentSubject = createElement('div', {\r\n                className: cls.SUBJECT_CLASS, innerHTML: eventSubject\r\n            });\r\n            templateElement = [appointmentSubject];\r\n        }\r\n        append(templateElement, appointmentWrapper);\r\n        this.setWrapperAttributes(appointmentWrapper, resIndex);\r\n        return appointmentWrapper;\r\n    };\r\n    EventBase.prototype.setWrapperAttributes = function (appointmentWrapper, resIndex) {\r\n        if (!isNullOrUndefined(this.cssClass)) {\r\n            addClass([appointmentWrapper], this.cssClass);\r\n        }\r\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\r\n            appointmentWrapper.setAttribute('data-group-index', resIndex.toString());\r\n        }\r\n    };\r\n    EventBase.prototype.getReadonlyAttribute = function (event) {\r\n        return (event[this.parent.eventFields.isReadonly] || this.parent.readonly).toString();\r\n    };\r\n    EventBase.prototype.isBlockRange = function (eventData) {\r\n        var eventCollection = (eventData instanceof Array) ? eventData : [eventData];\r\n        var isBlockAlert = false;\r\n        var fields = this.parent.eventFields;\r\n        for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\r\n            var event_5 = _a[_i];\r\n            var dataCol = [];\r\n            if (!isNullOrUndefined(event_5[fields.recurrenceRule]) &&\r\n                (isNullOrUndefined(event_5[fields.recurrenceID]) || event_5[fields.id] === event_5[fields.recurrenceID])) {\r\n                dataCol = this.generateOccurrence(event_5);\r\n            }\r\n            else {\r\n                dataCol.push(event_5);\r\n            }\r\n            for (var _b = 0, dataCol_1 = dataCol; _b < dataCol_1.length; _b++) {\r\n                var data = dataCol_1[_b];\r\n                var filterBlockEvents = this.filterBlockEvents(data);\r\n                if (filterBlockEvents.length > 0) {\r\n                    isBlockAlert = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        this.parent.uiStateValues.isBlock = isBlockAlert;\r\n        return isBlockAlert;\r\n    };\r\n    EventBase.prototype.getFilterEventsList = function (dataSource, query) {\r\n        return new DataManager(dataSource).executeLocal(new Query().where(query));\r\n    };\r\n    EventBase.prototype.getSeriesEvents = function (parentEvent, startTime) {\r\n        var fields = this.parent.eventFields;\r\n        startTime = isNullOrUndefined(startTime) ? parentEvent[fields.startTime] : startTime;\r\n        var deleteFutureEditEvents;\r\n        var futureEvents;\r\n        var deleteFutureEditEventList = [];\r\n        var delId = parentEvent[fields.id];\r\n        var followingId = parentEvent[fields.followingID];\r\n        var deleteFutureEvent;\r\n        var startTimeQuery = this.parent.currentAction === 'EditSeries' ? 'greaterthan' : 'greaterthanorequal';\r\n        do {\r\n            deleteFutureEvent = ((new Predicate(fields.followingID, 'equal', delId))).\r\n                and(new Predicate(fields.startTime, startTimeQuery, startTime));\r\n            futureEvents = this.getFilterEventsList(this.parent.eventsData, deleteFutureEvent);\r\n            deleteFutureEditEvents = futureEvents.slice(-1)[0];\r\n            if (!isNullOrUndefined(deleteFutureEditEvents) && deleteFutureEditEvents[fields.id] !== followingId) {\r\n                deleteFutureEditEventList.push(deleteFutureEditEvents);\r\n                delId = deleteFutureEditEvents[fields.id];\r\n                followingId = deleteFutureEditEvents[fields.followingID];\r\n            }\r\n            else {\r\n                followingId = null;\r\n            }\r\n        } while (futureEvents.length === 1 && !isNullOrUndefined(deleteFutureEditEvents[fields.followingID]));\r\n        return deleteFutureEditEventList;\r\n    };\r\n    EventBase.prototype.getEditedOccurrences = function (deleteFutureEditEventList, startTime) {\r\n        var fields = this.parent.eventFields;\r\n        var deleteRecurrenceEventList = [];\r\n        var delEditedEvents;\r\n        for (var _i = 0, deleteFutureEditEventList_1 = deleteFutureEditEventList; _i < deleteFutureEditEventList_1.length; _i++) {\r\n            var event_6 = deleteFutureEditEventList_1[_i];\r\n            var delEventQuery = new Predicate(fields.recurrenceID, 'equal', event_6[fields.id]).\r\n                or(new Predicate(fields.recurrenceID, 'equal', event_6[fields.followingID]).\r\n                and(new Predicate(fields.recurrenceID, 'notequal', undefined)).\r\n                and(new Predicate(fields.recurrenceID, 'notequal', null)));\r\n            if (this.parent.currentAction === 'EditFollowingEvents' || this.parent.currentAction === 'DeleteFollowingEvents') {\r\n                delEventQuery = delEventQuery.and(new Predicate(fields.startTime, 'greaterthanorequal', startTime));\r\n            }\r\n            delEditedEvents = this.getFilterEventsList(this.parent.eventsData, delEventQuery);\r\n            deleteRecurrenceEventList = deleteRecurrenceEventList.concat(delEditedEvents);\r\n        }\r\n        return deleteRecurrenceEventList;\r\n    };\r\n    EventBase.prototype.getRenderedDates = function (dateRender) {\r\n        var firstDate = 0;\r\n        var lastDate = dateRender.length;\r\n        var filteredDates;\r\n        if (dateRender[0] < this.parent.minDate && dateRender[dateRender.length - 1] > this.parent.maxDate) {\r\n            for (var i = 0; i < dateRender.length; i++) {\r\n                if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.minDate)).getTime()) {\r\n                    firstDate = i;\r\n                }\r\n                if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.maxDate)).getTime()) {\r\n                    lastDate = i;\r\n                }\r\n            }\r\n            filteredDates = dateRender.filter(function (date) { return date >= dateRender[firstDate] && date <= dateRender[lastDate]; });\r\n        }\r\n        return filteredDates;\r\n    };\r\n    EventBase.prototype.isValidEvent = function (eventObj, start, end, schedule) {\r\n        var isHourRange = end.getTime() > schedule.startHour.getTime() && start.getTime() < schedule.endHour.getTime();\r\n        var isSameRange = schedule.startHour.getTime() <= start.getTime() &&\r\n            eventObj[this.parent.eventFields.startTime].getTime() >= schedule.startHour.getTime() &&\r\n            eventObj[this.parent.eventFields.endTime].getTime() < schedule.endHour.getTime() && start.getTime() === end.getTime();\r\n        return isHourRange || isSameRange;\r\n    };\r\n    return EventBase;\r\n}());\r\nexport { EventBase };\r\n"]},"metadata":{},"sourceType":"module"}